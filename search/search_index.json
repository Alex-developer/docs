{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"index.html","title":"Home","text":"<p>Allsky transforms a camera into a tireless, intelligent observer of the night sky \u2014 an automated system that watches, records, and analyses everything that happens above you.</p> <p>Using a high-sensitivity camera, powerful Raspberry Pi-based software, and modular extensions, Allsky captures meteors, satellites, aurora, and passing cloud, 24 hours a day. Each frame is processed in real time to reveal events invisible to the naked eye \u2014 and every night becomes its own story told through data, images, and motion.</p> <p>But Allsky is more than just a camera \u2014 it\u2019s an ecosystem. The web-based interface lets you monitor your system live, review captured events, design custom overlays, visualise sensor data, and automate your setup with a flexible module system. From temperature and dew heater control to star detection and meteor analytics, every feature works together in a single, polished dashboard.</p> <p>Built by enthusiasts for enthusiasts, Allsky is open, extensible, and endlessly curious \u2014 a fusion of astrophotography, automation, and discovery.</p> <p>The Allsky Camera software was originally created by Thomas Jacquin, a developer and astrophotography  enthusiast based in Canada.</p> <p>Thomas released the first version of Allsky around 2018, designed to run on a Raspberry Pi with a ZWO ASI or Raspberry Pi HQ camera to capture images of the entire sky \u2014 automatically creating timelapses, keograms, and detecting meteors.</p> <p>Since then, the project has grown into a large open-source community effort on GitHub under the Allsky Team\ufffc organisation, with contributions from many developers and users:</p> <p>Thomas continues to be recognised as the founder and original author, while the Allsky Team now maintains and evolves the software collaboratively.</p> <p>The current maintainers are - Eric Claeys - @EricClaeys - Alex Greenland - @Alex-developer </p> <p>There are Three sections to the documentation</p> <ul> <li>Allsky Guide Information for installing, configuring, and running the Allsky software, including describing what various features like overlays and keograms are, and how to troubleshoot and fix problems.</li> <li>Developer Guide Information for developers on howto extend Allsky by creating custom modules</li> <li>SDK Reference Information for developers on the available libraries within Allsky</li> </ul>"},{"location":"index.html#questions-and-feature-requests","title":"Questions and Feature Requests","text":"<p>If you have a QUESTION or want to REQUEST A NEW FEATURE create a new Discussion by clicking on the Discussions link on any Allsky GitHub page. Please do NOT create an Issue.</p>"},{"location":"index.html#issues","title":"Issues","text":"<p>If you have a problem first look in the \"Documentation -&gt; Troubleshooting\" pages for a solution - most known problems are listed there. If you can't find a similar problem look in the Discussions (it may be a closed discussion). If you still can't find your problem, read the Reporting Problems page and then create a new Issue.</p>"},{"location":"index.html#contributing","title":"Contributing","text":"<p>If you would like to contribute code to Allsky then please see the Contributing Guide</p> <p>Thanks - the Allsky Team</p>"},{"location":"allsky_api.html","title":"Allsky Server API","text":""},{"location":"allsky_api.html#allsky-server-api","title":"Allsky Server API","text":"<p>The Allsky Server is a separate process that runs alongside Allsky its primary job is to handle longer running processes and to manage GPIO Coontrol. Its core functions are</p> <ul> <li>The Allsky dashboard whcich displays information about Allsky - currently under development</li> <li>The Allsky focuser which allows a camera with a focus motor to be focused - currently under development</li> <li>The Pi's GPIO pins, both digital and PWM</li> </ul>"},{"location":"allsky_api.html#authentication","title":"Authentication","text":"<p>The API requires authentication under the following circumstances</p> <ul> <li>You are unsing the inbuilt Dashboard, in this case the authentication will be via a login screen using the same login and password as Allaky</li> <li>You are using the api from an external machine. In this case you will need to request a JWT token from the API</li> </ul> <p>If you are using the API from the local machine then no authentication is required for any API</p>"},{"location":"allsky_api.html#requesting-a-jwt-token","title":"Requesting a JWT token","text":"<p>To get a JWT token use the following API endpoint</p> <p>POST /login</p> <p>This expects a username and password and returns a JWT token</p> <p>TODO: Add Hoppscotch examples TODO: Creating users</p>"},{"location":"allsky_api.html#the-available-apis","title":"The Available API's","text":""},{"location":"allsky_api.html#modules.allsky","title":"<code>allsky</code>","text":""},{"location":"allsky_api.html#modules.allsky.allsky_status","title":"<code>allsky_status()</code>","text":"<p>GET /allsky/status</p> <p>Retrieve the current Allsky system status.</p> <p>This endpoint queries backend logic (get_allsky_status) and returns a full status dictionary, plus a rendered HTML fragment used by the web frontend.</p> Authentication <p>Requires: <code>api_auth_required(\"allsky\", \"read\")</code></p> <p>Returns:</p> Name Type Description <code>dict</code> <p>A JSON object containing: - All fields provided by <code>get_allsky_status()</code> - <code>status_html</code>: Rendered HTML snippet for UI display</p> Source code in <code>server/modules/allsky/__init__.py</code> <pre><code>@allsky_bp.route('/status', methods=['GET'])\n@api_auth_required(\"allsky\", \"read\")\ndef allsky_status():\n    \"\"\"\n    GET /allsky/status\n\n    Retrieve the current Allsky system status.\n\n    This endpoint queries backend logic (get_allsky_status) and returns a full\n    status dictionary, plus a rendered HTML fragment used by the web frontend.\n\n    Authentication:\n        Requires: ``api_auth_required(\"allsky\", \"read\")``\n\n    Returns:\n        dict: A JSON object containing:\n            - All fields provided by ``get_allsky_status()``\n            - ``status_html``: Rendered HTML snippet for UI display\n    \"\"\"\n    status = get_allsky_status()\n    status_html = render_template(\"_partials/_allskyStatus.html\", status=status)\n    status['status_html'] = status_html\n    return status\n</code></pre>"},{"location":"allsky_api.html#modules.allsky.restart_allsky","title":"<code>restart_allsky()</code>","text":"<p>GET /allsky/restart</p> <p>Restart the Allsky service.</p> Authentication <p>Requires: <code>api_auth_required(\"allsky\", \"update\")</code></p> <p>Returns:</p> Name Type Description <code>JSON</code> <p><code>{\"status\": \"Allsky started\"}</code></p> Source code in <code>server/modules/allsky/__init__.py</code> <pre><code>@allsky_bp.route('/restart', methods=['GET'])\n@api_auth_required(\"allsky\", \"update\")\ndef restart_allsky():\n    \"\"\"\n    GET /allsky/restart\n\n    Restart the Allsky service.\n\n    Authentication:\n        Requires: ``api_auth_required(\"allsky\", \"update\")``\n\n    Returns:\n        JSON: ``{\"status\": \"Allsky started\"}``\n    \"\"\"\n    subprocess.run(['sudo', 'systemctl', 'restart', 'allsky'])\n    return jsonify({'status': 'Allsky started'})\n</code></pre>"},{"location":"allsky_api.html#modules.allsky.start_allsky","title":"<code>start_allsky()</code>","text":"<p>GET /allsky/start</p> <p>Start the Allsky service.</p> Authentication <p>Requires: <code>api_auth_required(\"allsky\", \"update\")</code></p> <p>Returns:</p> Name Type Description <code>JSON</code> <p><code>{\"status\": \"Allsky started\"}</code></p> Source code in <code>server/modules/allsky/__init__.py</code> <pre><code>@allsky_bp.route('/start', methods=['GET'])\n@api_auth_required(\"allsky\", \"update\")\ndef start_allsky():\n    \"\"\"\n    GET /allsky/start\n\n    Start the Allsky service.\n\n    Authentication:\n        Requires: ``api_auth_required(\"allsky\", \"update\")``\n\n    Returns:\n        JSON: ``{\"status\": \"Allsky started\"}``\n    \"\"\"\n    subprocess.run(['sudo', 'systemctl', 'start', 'allsky'])\n    return jsonify({'status': 'Allsky started'})\n</code></pre>"},{"location":"allsky_api.html#modules.allsky.stop_allsky","title":"<code>stop_allsky()</code>","text":"<p>GET /allsky/stopallsky</p> <p>Stop the Allsky service and immediately start the AllskyServer service.</p> <p>This is commonly used during debugging or maintenance when the capture component needs to be restarted but the web interface should remain active.</p> Authentication <p>Requires: <code>api_auth_required(\"allsky\", \"update\")</code></p> <p>Returns:</p> Name Type Description <code>JSON</code> <p><code>{\"status\": \"Allsky stopped\"}</code></p> Source code in <code>server/modules/allsky/__init__.py</code> <pre><code>@allsky_bp.route('/stopallsky', methods=['GET'])\n@api_auth_required(\"allsky\", \"update\")\ndef stop_allsky():\n    \"\"\"\n    GET /allsky/stopallsky\n\n    Stop the Allsky service and immediately start the AllskyServer service.\n\n    This is commonly used during debugging or maintenance when the capture\n    component needs to be restarted but the web interface should remain active.\n\n    Authentication:\n        Requires: ``api_auth_required(\"allsky\", \"update\")``\n\n    Returns:\n        JSON: ``{\"status\": \"Allsky stopped\"}``\n    \"\"\"\n    subprocess.run(['sudo', 'systemctl', 'stop', 'allsky'])\n    subprocess.run(['sudo', 'systemctl', 'start', 'allskyserver'])\n    return jsonify({'status': 'Allsky stopped'})\n</code></pre>"},{"location":"allsky_api.html#modules.allsky.stop_allsky_all","title":"<code>stop_allsky_all()</code>","text":"<p>GET /allsky/stopall</p> <p>Stop the Allsky service.</p> <p>This fully stops the \"allsky\" systemd service.</p> Authentication <p>Requires: <code>api_auth_required(\"allsky\", \"update\")</code></p> <p>Returns:</p> Name Type Description <code>JSON</code> <p><code>{\"status\": \"Allsky stopped\"}</code></p> Source code in <code>server/modules/allsky/__init__.py</code> <pre><code>@allsky_bp.route('/stopall', methods=['GET'])\n@api_auth_required(\"allsky\", \"update\")\ndef stop_allsky_all():\n    \"\"\"\n    GET /allsky/stopall\n\n    Stop the Allsky service.\n\n    This fully stops the \"allsky\" systemd service.\n\n    Authentication:\n        Requires: ``api_auth_required(\"allsky\", \"update\")``\n\n    Returns:\n        JSON: ``{\"status\": \"Allsky stopped\"}``\n    \"\"\"\n    subprocess.run(['sudo', 'systemctl', 'stop', 'allsky'])\n    return jsonify({'status': 'Allsky stopped'})\n</code></pre>"},{"location":"allsky_api.html#modules.gpio","title":"<code>gpio</code>","text":""},{"location":"allsky_api.html#modules.gpio.all_gpio_status","title":"<code>all_gpio_status()</code>","text":"<p>GET /gpio/all</p> <p>Return the status of every board GPIO pin.</p> Authentication <p>Requires @api_auth_required(\"gpio\", \"update\")</p> <p>Returns:</p> Name Type Description <code>JSON</code> <code>Response</code> <p>A dictionary of all pins (D0, D1, D2...) with details on   whether they are unused, digital I/O, or PWM.</p> Source code in <code>server/modules/gpio/__init__.py</code> <pre><code>@gpio_bp.route(\"/all\", methods=[\"GET\"])\n@api_auth_required(\"gpio\", \"update\")\ndef all_gpio_status() -&gt; Response:\n    \"\"\"\n    GET /gpio/all\n\n    Return the status of every board GPIO pin.\n\n    Authentication:\n        Requires @api_auth_required(\"gpio\", \"update\")\n\n    Returns:\n        JSON: A dictionary of all pins (D0, D1, D2...) with details on\n              whether they are unused, digital I/O, or PWM.\n    \"\"\"\n    try:\n        with gpio_lock:\n            all_status = get_gpio_status()\n\n        return jsonify(all_status)\n\n    except Exception as e:\n        return (\n            jsonify({\n                \"error\": \"Failed to retrieve all GPIO status\",\n                \"type\": type(e).__name__,\n                \"message\": str(e),\n            }),\n            500,\n        )\n</code></pre>"},{"location":"allsky_api.html#modules.gpio.get_board_pin","title":"<code>get_board_pin(gpio_str)</code>","text":"<p>Convert a GPIO pin number into a board-specific pin object.</p> <p>Parameters:</p> Name Type Description Default <code>gpio_str</code> <code>str | int</code> <p>Pin number, e.g. \"18\".</p> required <p>Returns:</p> Type Description <p>object | None: board.Dxx pin object, or None if invalid.</p> Source code in <code>server/modules/gpio/__init__.py</code> <pre><code>def get_board_pin(gpio_str):\n    \"\"\"\n    Convert a GPIO pin number into a board-specific pin object.\n\n    Args:\n        gpio_str (str | int): Pin number, e.g. \"18\".\n\n    Returns:\n        object | None: board.Dxx pin object, or None if invalid.\n    \"\"\"\n    try:\n        return getattr(board, f\"D{int(gpio_str)}\")\n    except (AttributeError, ValueError):\n        return None\n</code></pre>"},{"location":"allsky_api.html#modules.gpio.get_gpio_status","title":"<code>get_gpio_status()</code>","text":"<p>Inspect all available board pins and return their current usage.</p> This includes <ul> <li>Unused pins</li> <li>Digital pins (input/output, on/off)</li> <li>PWM pins (frequency, duty cycle)</li> </ul> <p>Returns:</p> Name Type Description <code>dict</code> <code>dict</code> <p>Status for each Dxx pin on the board.</p> Source code in <code>server/modules/gpio/__init__.py</code> <pre><code>def get_gpio_status() -&gt; dict:\n    \"\"\"\n    Inspect all available board pins and return their current usage.\n\n    This includes:\n      - Unused pins\n      - Digital pins (input/output, on/off)\n      - PWM pins (frequency, duty cycle)\n\n    Returns:\n        dict: Status for each Dxx pin on the board.\n    \"\"\"\n    all_status = {}\n    for attr in dir(board):\n        if not attr.startswith(\"D\"):\n            continue\n\n        hr_pin = attr        # e.g. \"D18\"\n        pin_num = hr_pin[1:] # e.g. \"18\"\n        board_pin = getattr(board, attr)\n\n        status = {\"mode\": \"unused\"}\n\n        if pin_num in digital_pins:\n            dio = digital_pins[pin_num]\n            direction = (\n                \"output\" if dio.direction == digitalio.Direction.OUTPUT else \"input\"\n            )\n            status[\"mode\"] = f\"digital-{direction}\"\n            status[\"value\"] = \"on\" if dio.value else \"off\"\n\n        elif pin_num in pwm_pins:\n            pwm = pwm_pins[pin_num]\n            status[\"mode\"] = \"pwm\"\n            status[\"frequency\"] = pwm.frequency\n            status[\"duty\"] = pwm.duty_cycle\n\n        all_status[hr_pin] = status\n\n    return all_status\n</code></pre>"},{"location":"allsky_api.html#modules.gpio.read_digital","title":"<code>read_digital(pin)</code>","text":"<p>GET /gpio/digital/</p> <p>Read a digital GPIO pin.</p> <p>If the pin has not previously been configured, the API automatically initialises it as a digital input.</p> <p>Parameters:</p> Name Type Description Default <code>pin</code> <code>str</code> <p>Pin number, e.g. \"18\".</p> required Authentication <p>Requires @api_auth_required(\"gpio\", \"update\")</p> <p>Returns:</p> Name Type Description <code>JSON</code> <code>Response</code> <p>{ \"pin\": \"\", \"value\": \"on\" | \"off\" }</p> Source code in <code>server/modules/gpio/__init__.py</code> <pre><code>@gpio_bp.route(\"/digital/&lt;pin&gt;\", methods=[\"GET\"])\n@api_auth_required(\"gpio\", \"update\")\ndef read_digital(pin) -&gt; Response:\n    \"\"\"\n    GET /gpio/digital/&lt;pin&gt;\n\n    Read a digital GPIO pin.\n\n    If the pin has not previously been configured, the API automatically\n    initialises it as a digital input.\n\n    Args:\n        pin (str): Pin number, e.g. \"18\".\n\n    Authentication:\n        Requires @api_auth_required(\"gpio\", \"update\")\n\n    Returns:\n        JSON: { \"pin\": \"&lt;number&gt;\", \"value\": \"on\" | \"off\" }\n    \"\"\"\n    pin = str(pin).strip()\n    board_pin = get_board_pin(pin)\n\n    if board_pin is None:\n        return jsonify({\"error\": f\"Invalid GPIO pin {pin}\"}), 400\n\n    try:\n        with gpio_lock:\n            if pin in digital_pins:\n                digital_io = digital_pins[pin]\n            else:\n                digital_io = digitalio.DigitalInOut(board_pin)\n                digital_io.direction = digitalio.Direction.INPUT\n                digital_pins[pin] = digital_io\n\n            value = digital_io.value\n\n        return jsonify({\"pin\": pin, \"value\": \"on\" if value else \"off\"})\n\n    except Exception as e:\n        return (\n            jsonify({\n                \"error\": \"Failed to read digital pin\",\n                \"type\": type(e).__name__,\n                \"message\": str(e),\n            }),\n            500,\n        )\n</code></pre>"},{"location":"allsky_api.html#modules.gpio.set_digital","title":"<code>set_digital()</code>","text":"<p>POST /gpio/digital</p> <p>Set a digital GPIO pin ON or OFF.</p> JSON Body <p>pin   (str/int): GPIO pin number. state (str):     \"on\" or \"off\". Defaults to \"off\".</p> Behaviour <p>\u2022 If the pin is currently configured for PWM, PWM is deinitialised. \u2022 Pin is configured as a digital output if not already.</p> Authentication <p>Requires @api_auth_required(\"gpio\", \"update\")</p> <p>Returns:</p> Name Type Description <code>JSON</code> <code>Response</code> <p>{ \"pin\": , \"state\": \"on\" | \"off\" }</p> Source code in <code>server/modules/gpio/__init__.py</code> <pre><code>@gpio_bp.route(\"/digital\", methods=[\"POST\"])\n@api_auth_required(\"gpio\", \"update\")\ndef set_digital() -&gt; Response:\n    \"\"\"\n    POST /gpio/digital\n\n    Set a digital GPIO pin ON or OFF.\n\n    JSON Body:\n        pin   (str/int): GPIO pin number.\n        state (str):     \"on\" or \"off\". Defaults to \"off\".\n\n    Behaviour:\n        \u2022 If the pin is currently configured for PWM, PWM is deinitialised.\n        \u2022 Pin is configured as a digital output if not already.\n\n    Authentication:\n        Requires @api_auth_required(\"gpio\", \"update\")\n\n    Returns:\n        JSON: { \"pin\": &lt;pin&gt;, \"state\": \"on\" | \"off\" }\n    \"\"\"\n    try:\n        pin = str(request.json.get(\"pin\")).strip()\n        state = str(request.json.get(\"state\", \"off\")).lower()\n\n        board_pin = get_board_pin(pin)\n        if board_pin is None:\n            return jsonify({\"error\": f\"Invalid GPIO pin {pin}\"}), 400\n\n        with gpio_lock:\n            if pin in pwm_pins:\n                pwm_pins[pin].deinit()\n                del pwm_pins[pin]\n\n            if pin not in digital_pins:\n                digital_io = digitalio.DigitalInOut(board_pin)\n                digital_io.direction = digitalio.Direction.OUTPUT\n                digital_pins[pin] = digital_io\n\n            digital_pins[pin].value = state == \"on\"\n\n        return jsonify({\"pin\": pin, \"state\": \"on\" if digital_pins[pin].value else \"off\"})\n\n    except Exception as e:\n        return (\n            jsonify({\n                \"error\": \"Failed to set digital pin\",\n                \"type\": type(e).__name__,\n                \"message\": str(e),\n            }),\n            500,\n        )\n</code></pre>"},{"location":"allsky_api.html#modules.gpio.set_pwm","title":"<code>set_pwm()</code>","text":"<p>POST /gpio/pwm</p> <p>Configure or update PWM on a GPIO pin.</p> JSON Body <p>pin        (str/int): GPIO number. frequency  (int):     PWM frequency in Hz. Defaults to 1000. duty       (int):     Duty cycle 0\u201365535. Defaults to 0.</p> Behaviour <p>\u2022 If the pin was digital, digital mode is removed. \u2022 Creates PWMOut if necessary, otherwise updates existing PWMOut.</p> Authentication <p>Requires @api_auth_required(\"gpio\", \"update\")</p> <p>Returns:</p> Name Type Description <code>JSON</code> <code>Response</code> <p>{ \"pin\": , \"frequency\": , \"duty\": , \"duty_percent\": &lt;0-100&gt;,</p> <code>Response</code> <p>}</p> Source code in <code>server/modules/gpio/__init__.py</code> <pre><code>@gpio_bp.route(\"/pwm\", methods=[\"POST\"])\n@api_auth_required(\"gpio\", \"update\")\ndef set_pwm() -&gt; Response:\n    \"\"\"\n    POST /gpio/pwm\n\n    Configure or update PWM on a GPIO pin.\n\n    JSON Body:\n        pin        (str/int): GPIO number.\n        frequency  (int):     PWM frequency in Hz. Defaults to 1000.\n        duty       (int):     Duty cycle 0\u201365535. Defaults to 0.\n\n    Behaviour:\n        \u2022 If the pin was digital, digital mode is removed.\n        \u2022 Creates PWMOut if necessary, otherwise updates existing PWMOut.\n\n    Authentication:\n        Requires @api_auth_required(\"gpio\", \"update\")\n\n    Returns:\n        JSON: {\n            \"pin\": &lt;pin&gt;,\n            \"frequency\": &lt;hz&gt;,\n            \"duty\": &lt;value&gt;,\n            \"duty_percent\": &lt;0-100&gt;,\n        }\n    \"\"\"\n    try:\n        pin = str(request.json.get(\"pin\")).strip()\n        frequency = int(request.json.get(\"frequency\", 1000))\n        duty = int(request.json.get(\"duty\", 0))\n\n        if not (0 &lt;= duty &lt;= 65535):\n            return jsonify({\"error\": \"Duty must be between 0 and 65535\"}), 400\n\n        board_pin = get_board_pin(pin)\n        if board_pin is None:\n            return jsonify({\"error\": f\"Invalid GPIO pin {pin}\"}), 400\n\n        with gpio_lock:\n            if pin in digital_pins:\n                digital_pins[pin].deinit()\n                del digital_pins[pin]\n\n            if pin not in pwm_pins:\n                pwm = pwmio.PWMOut(board_pin, frequency=frequency, duty_cycle=duty)\n                pwm_pins[pin] = pwm\n            else:\n                pwm = pwm_pins[pin]\n                pwm.frequency = frequency\n                pwm.duty_cycle = duty\n\n        return jsonify({\n            \"pin\": pin,\n            \"frequency\": frequency,\n            \"duty\": duty,\n            \"duty_percent\": round((duty / 65535) * 100, 2),\n        })\n\n    except Exception as e:\n        return (\n            jsonify({\n                \"error\": \"Failed to set PWM\",\n                \"type\": type(e).__name__,\n                \"message\": str(e),\n            }),\n            500,\n        )\n</code></pre>"},{"location":"allsky_api.html#modules.gpio.status","title":"<code>status()</code>","text":"<p>GET /gpio/status</p> <p>Return a compact summary of active digital and PWM pins.</p> <p>Unlike <code>/gpio/all</code>, this endpoint only reports pins currently in use.</p> Authentication <p>Requires @api_auth_required(\"gpio\", \"update\")</p> <p>Returns:</p> Name Type Description <code>JSON</code> <code>Response</code> <p>{ \"digital\": { pin: \"on\" | \"off\" }, \"pwm\": { pin: { frequency, duty } }</p> <code>Response</code> <p>}</p> Source code in <code>server/modules/gpio/__init__.py</code> <pre><code>@gpio_bp.route(\"/status\", methods=[\"GET\"])\n@api_auth_required(\"gpio\", \"update\")\ndef status() -&gt; Response:\n    \"\"\"\n    GET /gpio/status\n\n    Return a compact summary of active digital and PWM pins.\n\n    Unlike `/gpio/all`, this endpoint only reports pins currently in use.\n\n    Authentication:\n        Requires @api_auth_required(\"gpio\", \"update\")\n\n    Returns:\n        JSON: {\n            \"digital\": { pin: \"on\" | \"off\" },\n            \"pwm\": { pin: { frequency, duty } }\n        }\n    \"\"\"\n    try:\n        with gpio_lock:\n            digital_status = {\n                pin: \"on\" if dio.value else \"off\"\n                for pin, dio in digital_pins.items()\n            }\n            pwm_status = {\n                pin: {\"frequency\": pwm.frequency, \"duty\": pwm.duty_cycle}\n                for pin, pwm in pwm_pins.items()\n            }\n\n        return jsonify({\"digital\": digital_status, \"pwm\": pwm_status})\n\n    except Exception as e:\n        return (\n            jsonify({\n                \"error\": \"Failed to retrieve status\",\n                \"type\": type(e).__name__,\n                \"message\": str(e),\n            }),\n            500,\n        )\n</code></pre>"},{"location":"allsky_base.html","title":"base","text":""},{"location":"allsky_base.html#scripts.modules.allsky_base","title":"<code>allsky_base</code>","text":""},{"location":"allsky_base.html#scripts.modules.allsky_base.ALLSKYMODULEBASE","title":"<code>ALLSKYMODULEBASE(params, event)</code>","text":"<p>Base class for Allsky processing modules.</p> <p>This class provides a common interface and helper methods that Allsky modules can inherit from. It handles:</p> <ul> <li>Storing the raw <code>params</code> dictionary passed in from the flow.</li> <li>Storing the <code>event</code> that triggered the module (e.g. postcapture, periodic).</li> <li>A simple debug mode that prints directly to stdout instead of using the   shared logger.</li> <li>Unified parameter retrieval via :meth:<code>get_param</code>, including support for   \"secret\" parameters stored in <code>env.json</code> (rather than in plain text   module configuration).</li> <li>A small compatibility layer around the historical <code>metaData</code> global,   via the <code>meta_data</code> instance attribute.</li> </ul> <p>Initialize the module base with parameters and the triggering event.</p> <p>Parameters:</p> Name Type Description Default <code>params</code> <code>dict</code> <p>Dictionary of parameters passed to the module from the flow configuration. Typically this comes from the JSON module config.</p> required <code>event</code> <code>str</code> <p>Name of the event that triggered this module (for example, <code>\"postcapture\"</code>, <code>\"daynight\"</code>, <code>\"periodic\"</code> etc.).</p> required Side Effects <ul> <li>Sets <code>self.params</code> and <code>self.event</code> from the arguments.</li> <li>Sets <code>self.debugmode</code> / <code>self.debug_mode</code> based on the   <code>ALLSKYTESTMODE</code> parameter. When True, messages are printed   directly rather than sent to the Allsky logger.</li> <li>Provides a compatibility bridge from the legacy global   <code>metaData</code> to the instance attribute <code>meta_data</code> if the   latter has not been set on the subclass.</li> </ul> Notes <p>Subclasses are expected to define a <code>meta_data</code> attribute that describes the module (arguments, defaults, secrets etc.). If that is not present, this initializer will attempt to fall back to an older global variable named <code>metaData</code> if it exists.</p> Source code in <code>scripts/modules/allsky_base.py</code> <pre><code>def __init__(self, params, event):\n\t\"\"\"\n\tInitialize the module base with parameters and the triggering event.\n\n\tArgs:\n\t\tparams (dict):\n\t\t\tDictionary of parameters passed to the module from the flow\n\t\t\tconfiguration. Typically this comes from the JSON module config.\n\t\tevent (str):\n\t\t\tName of the event that triggered this module (for example,\n\t\t\t``\"postcapture\"``, ``\"daynight\"``, ``\"periodic\"`` etc.).\n\n\tSide Effects:\n\t\t- Sets ``self.params`` and ``self.event`` from the arguments.\n\t\t- Sets ``self.debugmode`` / ``self.debug_mode`` based on the\n\t\t  ``ALLSKYTESTMODE`` parameter. When True, messages are printed\n\t\t  directly rather than sent to the Allsky logger.\n\t\t- Provides a compatibility bridge from the legacy global\n\t\t  ``metaData`` to the instance attribute ``meta_data`` if the\n\t\t  latter has not been set on the subclass.\n\n\tNotes:\n\t\tSubclasses are expected to define a ``meta_data`` attribute that\n\t\tdescribes the module (arguments, defaults, secrets etc.). If that\n\t\tis not present, this initializer will attempt to fall back to an\n\t\tolder global variable named ``metaData`` if it exists.\n\t\"\"\"\n\tself.params = params\n\tself.event = event\n\tself.debugmode = self.get_param('ALLSKYTESTMODE', False, bool)\n\tself.debug_mode = self.debugmode\n\n\t'''\n\tOriginally metaData was a global variable but has since been replaced by meta_data as \n\ta class variable. This code will set hte class variable if its not been defined from\n\tthe global variable if it is defined.\n\t'''\n\tif not hasattr(self, 'meta_data'):\n\t\tif 'metaData' in globals():\n\t\t\tself.meta_data = globals('metaData')\n</code></pre>"},{"location":"allsky_base.html#scripts.modules.allsky_base.ALLSKYMODULEBASE.debug_mode","title":"<code>debug_mode = self.debugmode</code>  <code>instance-attribute</code>","text":"<p>Originally metaData was a global variable but has since been replaced by meta_data as  a class variable. This code will set hte class variable if its not been defined from the global variable if it is defined.</p>"},{"location":"allsky_base.html#scripts.modules.allsky_base.ALLSKYMODULEBASE.debug_log","title":"<code>debug_log(message)</code>","text":"<p>Write a debug message only when debug mode is enabled.</p> <p>This helper is intended for very chatty or development-only messages that should never reach the normal Allsky logging system. It simply prints the message to stdout if <code>self.debug_mode</code> is True.</p> <p>Parameters:</p> Name Type Description Default <code>message</code> <code>str</code> <p>Message to print when debug mode is active.</p> required <p>Returns:</p> Type Description <p>None</p> Source code in <code>scripts/modules/allsky_base.py</code> <pre><code>def debug_log(self, message):\n\t\"\"\"\n\tWrite a debug message only when debug mode is enabled.\n\n\tThis helper is intended for very chatty or development-only messages\n\tthat should never reach the normal Allsky logging system. It simply\n\tprints the message to stdout if ``self.debug_mode`` is True.\n\n\tArgs:\n\t\tmessage (str):\n\t\t\tMessage to print when debug mode is active.\n\n\tReturns:\n\t\tNone\n\t\"\"\"\n\tif self.debug_mode:\n\t\tprint(message)\n</code></pre>"},{"location":"allsky_base.html#scripts.modules.allsky_base.ALLSKYMODULEBASE.get_database_config","title":"<code>get_database_config()</code>","text":"<p>Return the resolved database configuration for the current Allsky setup.</p> <p>This is a convenience wrapper around :func:<code>allsky_shared.get_database_config</code>, which merges secrets from <code>env.json</code> with settings from the Allsky configuration file.</p> <p>Returns:</p> Name Type Description <code>dict</code> <p>A dictionary containing at least:</p> <ul> <li><code>databasehost</code> (str)</li> <li><code>databaseuser</code> (str)</li> <li><code>databasepassword</code> (str)</li> <li><code>databasedatabase</code> (str)</li> <li><code>databasetype</code> (str) - e.g. <code>\"mysql\"</code> or <code>\"sqlite\"</code></li> <li><code>databaseenabled</code> (bool or truthy value)</li> </ul> Notes <p>This method does not open any connections itself; it only reads configuration that can be passed on to the database manager.</p> Source code in <code>scripts/modules/allsky_base.py</code> <pre><code>def get_database_config(self):\n\t\"\"\"\n\tReturn the resolved database configuration for the current Allsky setup.\n\n\tThis is a convenience wrapper around\n\t:func:`allsky_shared.get_database_config`, which merges secrets from\n\t``env.json`` with settings from the Allsky configuration file.\n\n\tReturns:\n\t\tdict:\n\t\t\tA dictionary containing at least:\n\n\t\t\t- ``databasehost`` (str)\n\t\t\t- ``databaseuser`` (str)\n\t\t\t- ``databasepassword`` (str)\n\t\t\t- ``databasedatabase`` (str)\n\t\t\t- ``databasetype`` (str) - e.g. ``\"mysql\"`` or ``\"sqlite\"``\n\t\t\t- ``databaseenabled`` (bool or truthy value)\n\n\tNotes:\n\t\tThis method does not open any connections itself; it only reads\n\t\tconfiguration that can be passed on to the database manager.\n\t\"\"\"\n\tdatabase_config = allsky_shared.get_database_config()\n\n\treturn database_config\n</code></pre>"},{"location":"allsky_base.html#scripts.modules.allsky_base.ALLSKYMODULEBASE.get_param","title":"<code>get_param(param, default, target_type=str, use_default_if_blank=False)</code>","text":"<p>Retrieve a module parameter with optional type conversion and secret handling.</p> <p>This method is the preferred way for modules to read configuration values. It looks up the parameter in <code>self.params</code>, optionally overrides it from <code>env.json</code> if the parameter is marked as a secret, and then attempts to cast it to the requested type.</p> <p>Parameters:</p> Name Type Description Default <code>param</code> <code>str</code> <p>The parameter name to look up.</p> required <code>default</code> <code>Any</code> <p>Default value to return if the parameter is missing or cannot be cast to <code>target_type</code>.</p> required <code>target_type</code> <code>type</code> <p>Type to cast the parameter value to (for example <code>str</code>, <code>int</code>, <code>float</code>, <code>bool</code>). Defaults to <code>str</code>.</p> <code>str</code> <code>use_default_if_blank</code> <code>bool</code> <p>If True and the target type is <code>str</code>, an empty string will be treated as \"no value\" and the default will be returned instead. Defaults to False.</p> <code>False</code> Secret handling <p>If the module defines <code>self.meta_data</code> and it contains an <code>\"argumentdetails\"</code> section, any parameter marked with <code>\"secret\": true</code> will be read from Allsky's <code>env.json</code> using the key <code>&lt;MODULE&gt;_&lt;PARAM&gt;</code> (both upper-cased). If the key is not found in the env file, an error is logged via <code>allsky_shared.log</code>.</p> <p>Returns:</p> Name Type Description <code>Any</code> <p>The parameter value converted to <code>target_type</code> if possible, or the supplied <code>default</code> if the lookup fails, casting fails, or the value is considered blank and <code>use_default_if_blank</code> is True.</p> Notes <ul> <li>No exception is raised if casting fails; the default is silently   used instead.</li> <li>This helper is designed to be resilient and safe to call from   within modules without needing try/except at every call site.</li> </ul> Source code in <code>scripts/modules/allsky_base.py</code> <pre><code>def get_param(self, param, default, target_type=str, use_default_if_blank=False):\n\t\"\"\"\n\tRetrieve a module parameter with optional type conversion and secret handling.\n\n\tThis method is the preferred way for modules to read configuration\n\tvalues. It looks up the parameter in ``self.params``, optionally\n\toverrides it from ``env.json`` if the parameter is marked as a secret,\n\tand then attempts to cast it to the requested type.\n\n\tArgs:\n\t\tparam (str):\n\t\t\tThe parameter name to look up.\n\t\tdefault (Any):\n\t\t\tDefault value to return if the parameter is missing or cannot\n\t\t\tbe cast to ``target_type``.\n\t\ttarget_type (type, optional):\n\t\t\tType to cast the parameter value to (for example ``str``,\n\t\t\t``int``, ``float``, ``bool``). Defaults to ``str``.\n\t\tuse_default_if_blank (bool, optional):\n\t\t\tIf True and the target type is ``str``, an empty string will\n\t\t\tbe treated as \"no value\" and the default will be returned\n\t\t\tinstead. Defaults to False.\n\n\tSecret handling:\n\t\tIf the module defines ``self.meta_data`` and it contains an\n\t\t``\"argumentdetails\"`` section, any parameter marked with\n\t\t``\"secret\": true`` will be read from Allsky's ``env.json`` using\n\t\tthe key ``&lt;MODULE&gt;_&lt;PARAM&gt;`` (both upper-cased). If the key is not\n\t\tfound in the env file, an error is logged via ``allsky_shared.log``.\n\n\tReturns:\n\t\tAny:\n\t\t\tThe parameter value converted to ``target_type`` if possible,\n\t\t\tor the supplied ``default`` if the lookup fails, casting\n\t\t\tfails, or the value is considered blank and\n\t\t\t``use_default_if_blank`` is True.\n\n\tNotes:\n\t\t- No exception is raised if casting fails; the default is silently\n\t\t  used instead.\n\t\t- This helper is designed to be resilient and safe to call from\n\t\t  within modules without needing try/except at every call site.\n\t\"\"\"\n\tresult = default\n\n\ttry:\n\t\tresult = self.params[param]\n\texcept (ValueError, KeyError):\n\t\tpass\n\n\tif hasattr(self, 'meta_data'):\n\t\tif 'argumentdetails' in self.meta_data:\n\t\t\tif param in self.meta_data['argumentdetails']:\n\t\t\t\tif 'secret' in self.meta_data['argumentdetails'][param]:\n\t\t\t\t\tenv_file = os.path.join(allsky_shared.ALLSKYPATH, 'env.json')\n\t\t\t\t\twith open(env_file, 'r', encoding='utf-8') as file:\n\t\t\t\t\t\tenv_data = json.load(file)\n\t\t\t\t\t\tenv_key = f\"{self.meta_data['module'].upper()}_{param.upper()}\"\n\t\t\t\t\t\tif env_key in env_data:\n\t\t\t\t\t\t\tresult = env_data[env_key]\n\t\t\t\t\t\telse:\n\t\t\t\t\t\t\tallsky_shared.log(0, f'ERROR: Variable {param} not found in env file. Tried key {env_key}')\n\n\ttry:\n\t\tresult = target_type(result)\n\texcept (ValueError, TypeError):\n\t\t#have_debug_mode = hasattr(allsky_shared, 'LOGLEVEL')\n\t\t#if have_debug_mode and allsky_shared.LOGLEVEL == 4:\n\t\t#\tallsky_shared.log(4, f'INFO: Cannot cast \"{param}\" to {target_type.__name__}, value [{result}]. Using default \"{default}\"')\n\t\tresult = default\n\n\tif target_type == str and use_default_if_blank:\n\t\tif result == '':\n\t\t\tresult = default\n\n\treturn result\n</code></pre>"},{"location":"allsky_base.html#scripts.modules.allsky_base.ALLSKYMODULEBASE.log","title":"<code>log(level, message, preventNewline=False, exitCode=None, sendToAllsky=False)</code>","text":"<p>Log a message via the shared Allsky logger or print in debug mode.</p> <p>This is a thin wrapper around :func:<code>allsky_shared.log</code> that respects the module's debug mode:</p> <ul> <li>If <code>self.debug_mode</code> is True, the message is printed directly to   stdout.</li> <li>Otherwise, the call is forwarded to <code>allsky_shared.log</code> with the   same arguments.</li> </ul> <p>Parameters:</p> Name Type Description Default <code>level</code> <code>int</code> <p>Log level as used by the Allsky logging system (for example, 0 for errors, higher numbers for more verbose output).</p> required <code>message</code> <code>str</code> <p>The message to log.</p> required <code>preventNewline</code> <code>bool</code> <p>If True, do not end the log line with a newline. Defaults to False.</p> <code>False</code> <code>exitCode</code> <code>int | None</code> <p>If not None, the underlying logger may terminate the process with this exit code. Defaults to None.</p> <code>None</code> <code>sendToAllsky</code> <code>bool</code> <p>When True, forwards the message into Allsky's Web UI message system as well as standard output, depending on logging level. Defaults to False.</p> <code>False</code> <p>Returns:</p> Type Description <p>None</p> Source code in <code>scripts/modules/allsky_base.py</code> <pre><code>def log(self, level, message, preventNewline = False, exitCode=None, sendToAllsky=False):\n\t\"\"\"\n\tLog a message via the shared Allsky logger or print in debug mode.\n\n\tThis is a thin wrapper around :func:`allsky_shared.log` that respects\n\tthe module's debug mode:\n\n\t- If ``self.debug_mode`` is True, the message is printed directly to\n\t  stdout.\n\t- Otherwise, the call is forwarded to ``allsky_shared.log`` with the\n\t  same arguments.\n\n\tArgs:\n\t\tlevel (int):\n\t\t\tLog level as used by the Allsky logging system (for example,\n\t\t\t0 for errors, higher numbers for more verbose output).\n\t\tmessage (str):\n\t\t\tThe message to log.\n\t\tpreventNewline (bool, optional):\n\t\t\tIf True, do not end the log line with a newline. Defaults to False.\n\t\texitCode (int | None, optional):\n\t\t\tIf not None, the underlying logger may terminate the process\n\t\t\twith this exit code. Defaults to None.\n\t\tsendToAllsky (bool, optional):\n\t\t\tWhen True, forwards the message into Allsky's Web UI message\n\t\t\tsystem as well as standard output, depending on logging level.\n\t\t\tDefaults to False.\n\n\tReturns:\n\t\tNone\n\t\"\"\"\n\tif self.debug_mode:\n\t\tprint(message)\n\telse:\n\t\tallsky_shared.log(level, message, preventNewline = preventNewline, exitCode=exitCode, sendToAllsky=sendToAllsky)\n</code></pre>"},{"location":"allsky_shared.html","title":"shared","text":""},{"location":"allsky_shared.html#scripts.modules.allsky_shared","title":"<code>allsky_shared</code>","text":"<p>allsky_shared.py</p> <p>Part of allsky postprocess.py modules. https://github.com/AllskyTeam/allsky</p> <p>This module is a common dumping ground for shared variables and functions used by various Allsky components.</p> <p>It provides helpers for:</p> <ul> <li>Reading environment variables and Allsky configuration</li> <li>Managing small on-disk \"databases\" used as debug stores</li> <li>Filesystem utilities (paths, permissions, extra-data files)</li> <li>Database connection helpers and automatic purge routines</li> <li>Overlay \"extra data\" JSON formatting and persistence</li> </ul>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.convert_lat_lon","title":"<code>convert_lat_lon(input)</code>","text":"<p>Helper for converting latitude/longitude strings.</p> <p>This wrapper calls the legacy :func:<code>convertLatLon</code>. New code should use this snake_case name; the camelCase function is kept so existing callers continue to work.</p> <p>See :func:<code>convertLatLon</code> for details.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def convert_lat_lon(input):\n    \"\"\"\n    Helper for converting latitude/longitude strings.\n\n    This wrapper calls the legacy :func:`convertLatLon`. New code should\n    use this snake_case name; the camelCase function is kept so existing\n    callers continue to work.\n\n    See :func:`convertLatLon` for details.\n    \"\"\"\n    return convertLatLon(input)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.count_starts_in_image","title":"<code>count_starts_in_image(image, mask_file_name=None)</code>","text":"<p>Detect stars in an image using Photutils' DAOStarFinder.</p> <p>The image is converted to grayscale if needed, optionally masked with :func:<code>mask_image</code>, and then processed with sigma-clipped statistics and DAOStarFinder to locate star centroids.</p> <p>Parameters:</p> Name Type Description Default <code>image</code> <code>ndarray</code> <p>Input image (grayscale or BGR).</p> required <code>mask_file_name</code> <code>str | None</code> <p>Optional mask file name to apply before detection.</p> <code>None</code> <p>Returns:</p> Type Description <p>tuple[list[tuple[float, float]], numpy.ndarray]: A tuple containing:</p> <ul> <li>A list of <code>(x, y)</code> star coordinates.</li> <li>The (possibly masked) image used for detection.</li> </ul> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def count_starts_in_image(image, mask_file_name=None):\n    \"\"\"\n    Detect stars in an image using Photutils' DAOStarFinder.\n\n    The image is converted to grayscale if needed, optionally masked with\n    :func:`mask_image`, and then processed with sigma-clipped statistics\n    and DAOStarFinder to locate star centroids.\n\n    Args:\n        image (numpy.ndarray):\n            Input image (grayscale or BGR).\n        mask_file_name (str | None, optional):\n            Optional mask file name to apply before detection.\n\n    Returns:\n        tuple[list[tuple[float, float]], numpy.ndarray]:\n            A tuple containing:\n\n              * A list of ``(x, y)`` star coordinates.\n              * The (possibly masked) image used for detection.\n    \"\"\"\n    from photutils.detection import DAOStarFinder\n    from astropy.stats import sigma_clipped_stats\n    import cv2\n\n    # Convert to grayscale if it's RGB\n    if image.ndim == 3:\n        gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)\n    else:\n        gray = image\n\n    if mask_file_name is not None and mask_file_name != '':\n        gray = mask_image(gray, mask_file_name)\n\n    # Convert to float for processing\n    image_data = gray.astype(float)\n\n    # Estimate background stats\n    mean, median, std = sigma_clipped_stats(image_data, sigma=3.0)\n\n    # Detect stars\n    daofind = DAOStarFinder(fwhm=3.0, threshold=5.0 * std)\n    sources = daofind(image_data - median)\n\n    # Convert to list of (x, y) tuples if sources were found\n    coords = []\n    if sources is not None and len(sources) &gt; 0:\n        x = sources['xcentroid'].tolist()\n        y = sources['ycentroid'].tolist()\n        coords = list(zip(x, y))\n\n    return coords, image\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.create_cardinal","title":"<code>create_cardinal(degrees)</code>","text":"<p>Convert a wind direction in degrees into a cardinal point.</p> <p>Parameters:</p> Name Type Description Default <code>degrees</code> <p>Direction in degrees (0\u2013360). North is 0\u00b0/360\u00b0, east is 90\u00b0, and so on.</p> required <p>Returns:</p> Type Description <p>A string containing one of the 16-point compass directions</p> <p>(e.g., <code>'N'</code>, <code>'NE'</code>, <code>'SW'</code>), or <code>'N/A'</code> if the input</p> <p>cannot be interpreted.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def create_cardinal(degrees):\n    \"\"\"\n    Convert a wind direction in degrees into a cardinal point.\n\n    Args:\n        degrees: Direction in degrees (0\u2013360). North is 0\u00b0/360\u00b0, east is\n            90\u00b0, and so on.\n\n    Returns:\n        A string containing one of the 16-point compass directions\n        (e.g., ``'N'``, ``'NE'``, ``'SW'``), or ``'N/A'`` if the input\n        cannot be interpreted.\n    \"\"\"\n    try:\n        cardinals = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW','W', 'WNW', 'NW', 'NNW', 'N']\n        cardinal = cardinals[round(degrees / 22.5)]\n    except Exception:\n        cardinal = 'N/A'\n\n    return cardinal\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.create_device","title":"<code>create_device(import_name, class_name, bus_number, i2c_address='')</code>","text":"<p>Instantiate an I2C device class on a given bus.</p> <p>The device class is imported dynamically and initialised with an Adafruit Blinka <code>busio.I2C</code> object constructed from a known set of SCL/SDA pins for the requested bus number.</p> <p>Parameters:</p> Name Type Description Default <code>import_name</code> <code>str</code> <p>Module path to import (e.g. <code>\"adafruit_bme280\"</code>).</p> required <code>class_name</code> <code>str</code> <p>Name of the device class in that module.</p> required <code>bus_number</code> <code>int</code> <p>I2C bus number (e.g. 1, 3, 4, 5, 6).</p> required <code>i2c_address</code> <code>str</code> <p>Optional I2C address string (e.g. <code>\"0x76\"</code>). If omitted, the device class is constructed without an explicit address.</p> <code>''</code> <p>Returns:</p> Name Type Description <code>Any</code> <p>An instance of the requested device class.</p> <p>Raises:</p> Type Description <code>ImportError</code> <p>If the module or class cannot be imported.</p> <code>ValueError</code> <p>If no pin mapping exists for the given bus number.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def create_device(import_name: str, class_name: str, bus_number: int, i2c_address: str = \"\"):\n    \"\"\"\n    Instantiate an I2C device class on a given bus.\n\n    The device class is imported dynamically and initialised with an\n    Adafruit Blinka ``busio.I2C`` object constructed from a known set of\n    SCL/SDA pins for the requested bus number.\n\n    Args:\n        import_name (str):\n            Module path to import (e.g. ``\"adafruit_bme280\"``).\n        class_name (str):\n            Name of the device class in that module.\n        bus_number (int):\n            I2C bus number (e.g. 1, 3, 4, 5, 6).\n        i2c_address (str, optional):\n            Optional I2C address string (e.g. ``\"0x76\"``). If omitted, the\n            device class is constructed without an explicit address.\n\n    Returns:\n        Any:\n            An instance of the requested device class.\n\n    Raises:\n        ImportError:\n            If the module or class cannot be imported.\n        ValueError:\n            If no pin mapping exists for the given bus number.\n    \"\"\"\n    bus_number = int(bus_number)\n\n    # Define SCL/SDA pins for each bus\n    I2C_BUS_PINS = {\n        1: (board.SCL, board.SDA),\n        3: (board.D5, board.D4),\n        4: (board.D9, board.D8),\n        5: (board.D13, board.D12),\n        6: (board.D23, board.D22)\n    }\n\n    # Dynamically import the module and get the class\n    try:\n        module = importlib.import_module(import_name)\n        cls = getattr(module, class_name)\n    except (ImportError, AttributeError) as e:\n        raise ImportError(f\"Could not import '{class_name}' from '{import_name}': {e}\")\n\n    try:\n        scl, sda = I2C_BUS_PINS[bus_number]\n    except KeyError:\n        raise ValueError(f\"No pin mapping defined for I2C bus {bus_number}\")\n\n    i2c = busio.I2C(scl, sda)\n\n    # Instantiate device\n    if i2c_address:\n        return cls(i2c, int(i2c_address, 0))\n    else:\n        return cls(i2c)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.delete_extra_data","title":"<code>delete_extra_data(fileName)</code>","text":"<p>Preferred wrapper for removing extra data files.</p> <p>This is the underscore version and should be used in new code. It simply delegates to :func:<code>deleteExtraData</code>, which contains the legacy implementation.</p> <p>Parameters:</p> Name Type Description Default <code>fileName</code> <code>str</code> <p>File name to remove from all configured extra data directories.</p> required Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def delete_extra_data(fileName):\n    \"\"\"\n    Preferred wrapper for removing extra data files.\n\n    This is the underscore version and should be used in new code. It simply\n    delegates to :func:`deleteExtraData`, which contains the legacy\n    implementation.\n\n    Args:\n        fileName (str):\n            File name to remove from all configured extra data directories.\n    \"\"\"\n    deleteExtraData(fileName)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_all_allsky_variables","title":"<code>get_all_allsky_variables(show_empty=True, module='', indexed=False, raw=False)</code>","text":"<p>Retrieve all known Allsky variables via the ALLSKYVARIABLES helper.</p> <p>Parameters:</p> Name Type Description Default <code>show_empty</code> <code>bool</code> <p>Whether to include variables that have no value. Defaults to True.</p> <code>True</code> <code>module</code> <code>str</code> <p>Optional module filter, depending on the ALLSKYVARIABLES implementation.</p> <code>''</code> <code>indexed</code> <code>bool</code> <p>If True, variables may be returned in an indexed form.</p> <code>False</code> <code>raw</code> <code>bool</code> <p>If True, return raw data structures from ALLSKYVARIABLES.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>Any</code> <p>Whatever is returned by <code>ALLSKYVARIABLES().get_variables(...)</code>.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_all_allsky_variables(show_empty=True, module='', indexed=False, raw=False):\n    \"\"\"\n    Retrieve all known Allsky variables via the ALLSKYVARIABLES helper.\n\n    Args:\n        show_empty (bool, optional):\n            Whether to include variables that have no value. Defaults to True.\n        module (str, optional):\n            Optional module filter, depending on the ALLSKYVARIABLES\n            implementation.\n        indexed (bool, optional):\n            If True, variables may be returned in an indexed form.\n        raw (bool, optional):\n            If True, return raw data structures from ALLSKYVARIABLES.\n\n    Returns:\n        Any:\n            Whatever is returned by ``ALLSKYVARIABLES().get_variables(...)``.\n    \"\"\"\n    allskyvariables = ALLSKYVARIABLES()\n    return allskyvariables.get_variables(show_empty, module, indexed, raw)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_allsky_variable","title":"<code>get_allsky_variable(variable)</code>","text":"<p>Look up a single Allsky variable from environment or extra-data files.</p> <p>The lookup order is:</p> <ol> <li>Environment via :func:<code>getEnvironmentVariable</code>.</li> <li>JSON extra-data files in all extra-data directories.</li> <li>Text extra-data files in all extra-data directories.</li> </ol> <p>Parameters:</p> Name Type Description Default <code>variable</code> <code>str</code> <p>The variable name to retrieve.</p> required <p>Returns:</p> Name Type Description <code>Any</code> <p>The variable value if found, otherwise None.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_allsky_variable(variable):\n    \"\"\"\n    Look up a single Allsky variable from environment or extra-data files.\n\n    The lookup order is:\n\n      1. Environment via :func:`getEnvironmentVariable`.\n      2. JSON extra-data files in all extra-data directories.\n      3. Text extra-data files in all extra-data directories.\n\n    Args:\n        variable (str):\n            The variable name to retrieve.\n\n    Returns:\n        Any:\n            The variable value if found, otherwise None.\n    \"\"\"\n    result = getEnvironmentVariable(variable)\n    if result is None:\n\n        extra_data_paths = get_extra_dir()\n        for extra_data_path in extra_data_paths:\n            directory = Path(extra_data_path)\n\n            for file_path in directory.iterdir():\n                if file_path.is_file() and isFileReadable(file_path):\n\n                    file_extension = Path(file_path).suffix\n\n                    if file_extension == '.json':\n                        result = _get_value_from_json_file(file_path, variable)\n\n                    if file_extension == '.txt':\n                        result = _get_value_from_text_file(file_path, variable)\n\n                if result is not None:\n                    break\n\n    return result\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_allsky_version","title":"<code>get_allsky_version()</code>","text":"<p>Convenience helper to retrieve and parse the Allsky version.</p> <p>The version file path is taken from the <code>ALLSKY_VERSION_FILE</code> environment variable and passed to :func:<code>parse_version</code>.</p> <p>Returns:</p> Name Type Description <code>dict</code> <p>Parsed version info as returned by :func:<code>parse_version</code>.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_allsky_version():\n    \"\"\"\n    Convenience helper to retrieve and parse the Allsky version.\n\n    The version file path is taken from the ``ALLSKY_VERSION_FILE``\n    environment variable and passed to :func:`parse_version`.\n\n    Returns:\n        dict:\n            Parsed version info as returned by :func:`parse_version`.\n    \"\"\"\n    version_file = os.environ['ALLSKY_VERSION_FILE']\n    version_info = parse_version(version_file)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_api_url","title":"<code>get_api_url()</code>","text":"<p>Resolve the Allsky API base URL from the environment.</p> <p>If <code>ALLSKY_API_URL</code> is not present in the current environment, this helper calls :func:<code>setupForCommandLine</code> to load variables from the usual <code>variables.json</code> file, and then re-reads the environment.</p> <p>Returns:</p> Name Type Description <code>str</code> <p>The API base URL from <code>ALLSKY_API_URL</code>.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_api_url():\n    \"\"\"\n    Resolve the Allsky API base URL from the environment.\n\n    If ``ALLSKY_API_URL`` is not present in the current environment, this\n    helper calls :func:`setupForCommandLine` to load variables from the\n    usual ``variables.json`` file, and then re-reads the environment.\n\n    Returns:\n        str:\n            The API base URL from ``ALLSKY_API_URL``.\n    \"\"\"\n    try:\n        api_url = os.environ['ALLSKY_API_URL']\n    except KeyError:\n        setupForCommandLine()\n        api_url = os.environ['ALLSKY_API_URL']\n\n    return api_url\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_camera_gain","title":"<code>get_camera_gain()</code>","text":"<p>Get the current camera gain.</p> <p>For Raspberry Pi cameras, this reads the <code>AnalogueGain</code> value from the Pi metadata. For other camera types it uses the <code>AS_GAIN</code> environment variable.</p> <p>If no gain can be determined, 0.0 is returned.</p> <p>Returns:</p> Name Type Description <code>float</code> <p>Camera gain value.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_camera_gain():\n    \"\"\"\n    Get the current camera gain.\n\n    For Raspberry Pi cameras, this reads the ``AnalogueGain`` value from the\n    Pi metadata. For other camera types it uses the ``AS_GAIN`` environment\n    variable.\n\n    If no gain can be determined, 0.0 is returned.\n\n    Returns:\n        float:\n            Camera gain value.\n    \"\"\"\n    gain = 0\n    camera_type = get_camera_type()\n\n    if camera_type == 'rpi':\n        gain = get_rpi_meta_value('AnalogueGain')\n    else:\n        gain = get_environment_variable('AS_GAIN')\n\n    if gain == None:\n        gain = 0\n\n    return float(gain)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_camera_type","title":"<code>get_camera_type()</code>","text":"<p>Get the configured camera type from the environment.</p> <p>Returns:</p> Name Type Description <code>str</code> <p>Lowercase camera type string (e.g. <code>\"rpi\"</code>).</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_camera_type():\n    \"\"\"\n    Get the configured camera type from the environment.\n\n    Returns:\n        str:\n            Lowercase camera type string (e.g. ``\"rpi\"``).\n    \"\"\"\n    camera_type = get_environment_variable('CAMERA_TYPE')\n    return camera_type.lower()\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_ecowitt_data","title":"<code>get_ecowitt_data(api_key, app_key, mac_address, temp_unitid=1, pressure_unitid=3)</code>","text":"<p>Fetch live weather data from the remote Ecowitt cloud API.</p> <p>If all of the required credentials are non-empty, the function builds an API URL and attempts to parse a range of fields such as outdoor and indoor temperatures, humidity, rainfall, wind, pressure, and lightning.</p> <p>All fields are returned in a nested dict with sensible defaults of None.</p> <p>Parameters:</p> Name Type Description Default <code>api_key</code> <code>str</code> <p>Ecowitt API key.</p> required <code>app_key</code> <code>str</code> <p>Ecowitt application key.</p> required <code>mac_address</code> <code>str</code> <p>Device MAC address registered with Ecowitt.</p> required <code>temp_unitid</code> <code>int</code> <p>Temperature unit ID expected by the API. Defaults to 1.</p> <code>1</code> <code>pressure_unitid</code> <code>int</code> <p>Pressure unit ID expected by the API. Defaults to 3.</p> <code>3</code> <p>Returns:</p> Type Description <p>dict | str: On success, a nested dictionary of parsed values. On HTTP error, a descriptive error string may be returned instead.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_ecowitt_data(api_key, app_key, mac_address, temp_unitid=1, pressure_unitid=3):\n    \"\"\"\n    Fetch live weather data from the remote Ecowitt cloud API.\n\n    If all of the required credentials are non-empty, the function builds\n    an API URL and attempts to parse a range of fields such as outdoor and\n    indoor temperatures, humidity, rainfall, wind, pressure, and lightning.\n\n    All fields are returned in a nested dict with sensible defaults of None.\n\n    Args:\n        api_key (str):\n            Ecowitt API key.\n        app_key (str):\n            Ecowitt application key.\n        mac_address (str):\n            Device MAC address registered with Ecowitt.\n        temp_unitid (int, optional):\n            Temperature unit ID expected by the API. Defaults to 1.\n        pressure_unitid (int, optional):\n            Pressure unit ID expected by the API. Defaults to 3.\n\n    Returns:\n        dict | str:\n            On success, a nested dictionary of parsed values. On HTTP error,\n            a descriptive error string may be returned instead.\n    \"\"\"\n    result = {\n        'outdoor': {\n            'temperature': None,\n            'feels_like': None,\n            'humidity': None,\n            'app_temp': None,\n            'dew_point': None\n        },\n        'indoor': {\n            'temperature': None,\n            'humidity': None\n        },\n        'solar_and_uvi': {\n            'solar': None,\n            'uvi': None\n        },\n        'rainfall': {\n            'rain_rate': None,\n            'daily': None,\n            'event': None,\n            'hourly': None,\n            'weekly': None,\n            'monthly': None,\n            'yearly': None\n        },\n        'wind': {\n            'wind_speed': None,\n            'wind_gust': None,\n            'wind_direction': None\n        },\n        'pressure': {\n            'relative': None,\n            'absolute': None\n        },\n        'lightning': {\n            'distance': None,\n            'count': None\n        }\n    }\n    if all(var.strip() for var in (app_key, api_key, mac_address)):\n        ECOWITT_API_URL = f'https://api.ecowitt.net/api/v3/device/real_time?application_key={app_key}&amp;api_key={api_key}&amp;mac={mac_address}&amp;call_back=all&amp;temp_unitid={temp_unitid}&amp;pressure_unitid={pressure_unitid}'\n\n        log(4, f\"INFO: Reading Ecowitt API from - {ECOWITT_API_URL}\")\n        try:\n            response = requests.get(ECOWITT_API_URL)\n            if response.status_code == 200:\n                raw_data = response.json()\n\n                result['outdoor']['temperature'] = _get_nested_value(raw_data, 'data.outdoor.temperature.value', float)\n                result['outdoor']['feels_like'] = _get_nested_value(raw_data, 'data.outdoor.feels_like.value', float)\n                result['outdoor']['humidity'] = _get_nested_value(raw_data, 'data.outdoor.humidity.value', float)\n                result['outdoor']['app_temp'] = _get_nested_value(raw_data, 'data.outdoor.app_temp.value', float)\n                result['outdoor']['dew_point'] = _get_nested_value(raw_data, 'data.outdoor.dew_point.value', float)\n\n                result['indoor']['temperature'] = _get_nested_value(raw_data, 'data.indoor.temperature.value', float)\n                result['indoor']['humidity'] = _get_nested_value(raw_data, 'data.indoor.humidity.value', float)\n\n                result['solar_and_uvi']['solar'] = _get_nested_value(raw_data, 'data.solar_and_uvi.solar.value', float)\n                result['solar_and_uvi']['uvi'] = _get_nested_value(raw_data, 'data.solar_and_uvi.uvi.value', float)\n\n                result['rainfall']['rain_rate'] = _get_nested_value(raw_data, 'data.rainfall.rain_rate.value', float)\n                result['rainfall']['daily'] = _get_nested_value(raw_data, 'data.rainfall.daily.value', float)\n                result['rainfall']['event'] = _get_nested_value(raw_data, 'data.rainfall.event.value', float)\n                result['rainfall']['hourly'] = _get_nested_value(raw_data, 'data.rainfall.hourly.value', float)\n                result['rainfall']['weekly'] = _get_nested_value(raw_data, 'data.rainfall.weekly.value', float)\n                result['rainfall']['monthly'] = _get_nested_value(raw_data, 'data.rainfall.monthly.value', float)\n                result['rainfall']['yearly'] = _get_nested_value(raw_data, 'data.rainfall.yearly.value', float)\n\n                result['wind']['wind_speed'] = _get_nested_value(raw_data, 'data.wind.wind_speed.value', float)\n                result['wind']['wind_gust'] = _get_nested_value(raw_data, 'data.wind.wind_gust.value', float)\n                result['wind']['wind_direction'] = _get_nested_value(raw_data, 'data.wind.wind_direction.value', int)\n\n                result['pressure']['relative'] = _get_nested_value(raw_data, 'data.pressure.relative.value', float)\n                result['pressure']['absolute'] = _get_nested_value(raw_data, 'data.pressure.absolute.value', float)\n\n                result['lightning']['distance'] = _get_nested_value(raw_data, 'data.lightning.distance.value', float)\n                result['lightning']['count'] = _get_nested_value(raw_data, 'data.lightning.count.value', int)\n\n                log(1, f'INFO: Data read from Ecowitt API')\n            else:\n                result = f'Got error from the Ecowitt API. Response code {response.status_code}'\n                log(0, f'ERROR: {result}')\n        except Exception as e:\n            me = os.path.basename(__file__)\n            eType, eObject, eTraceback = sys.exc_info()\n            log(0, f'ERROR: Failed to read data from Ecowitt on line {eTraceback.tb_lineno} in {me} - {e}')\n    else:\n        log(0, 'ERROR: Missing Ecowitt Application Key, API Key or MAC Address')\n\n    return result\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_ecowitt_local_data","title":"<code>get_ecowitt_local_data(address, password=None)</code>","text":"<p>Fetch live weather data directly from a local Ecowitt gateway.</p> <p>This variant talks to the gateway's local HTTP API and parses a variety of metrics such as temperatures, humidity, rainfall, wind, pressure and lightning. Values are returned in a nested dict with None defaults.</p> <p>Units are parsed from the API response and temperature values are converted to Celsius when needed.</p> <p>Parameters:</p> Name Type Description Default <code>address</code> <code>str</code> <p>Base URL or IP address of the Ecowitt gateway.</p> required <code>password</code> <code>str</code> <p>Reserved for password-protected gateways (currently unused).</p> <code>None</code> <p>Returns:</p> Name Type Description <code>dict</code> <p>Nested dictionary of parsed values.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_ecowitt_local_data(address, password=None):\n    \"\"\"\n    Fetch live weather data directly from a local Ecowitt gateway.\n\n    This variant talks to the gateway's local HTTP API and parses a variety\n    of metrics such as temperatures, humidity, rainfall, wind, pressure and\n    lightning. Values are returned in a nested dict with None defaults.\n\n    Units are parsed from the API response and temperature values are\n    converted to Celsius when needed.\n\n    Args:\n        address (str):\n            Base URL or IP address of the Ecowitt gateway.\n        password (str, optional):\n            Reserved for password-protected gateways (currently unused).\n\n    Returns:\n        dict:\n            Nested dictionary of parsed values.\n    \"\"\"\n    '''\n    Temp 0 - C, 1 - F\n    Pressure 0 - hPA, 1 - inHg, 2 - mmHg\n    Wind 0 - m/s, 1 - km/h, 2 - mph, 3 - knots, 5 - Beaufort\n    Rain 0 - mm, 1 - in\n    Irradiance 0 - Klux, 1 - W/m2, 2 - Kfc\n    Capacity 0 - L, 1 - m3, 2 - Gal\n    '''\n\n    result = {\n        'outdoor': {\n            'temperature': None,\n            'feels_like': None,\n            'humidity': None,\n            'app_temp': None,\n            'dew_point': None\n        },\n        'indoor': {\n            'temperature': None,\n            'humidity': None\n        },\n        'solar_and_uvi': {\n            'solar': None,\n            'uvi': None\n        },\n        'rainfall': {\n            'rain_rate': None,\n            'daily': None,\n            'event': None,\n            'hourly': None,\n            'weekly': None,\n            'monthly': None,\n            'yearly': None\n        },\n        'wind': {\n            'wind_speed': None,\n            'wind_gust': None,\n            'wind_direction': None\n        },\n        'pressure': {\n            'relative': None,\n            'absolute': None\n        },\n        'lightning': {\n            'distance': None,\n            'count': None\n        }\n    }\n\n    def parse_val(val, as_type=float, unit=None):\n        \"\"\"\n        Extract numeric part from a value string and optionally convert \u00b0F to \u00b0C.\n\n        Args:\n            val (Any):\n                Raw value from the Ecowitt JSON (may contain unit text).\n            as_type (callable):\n                Type to cast the numeric part to (e.g. float, int).\n            unit (str | None):\n                Optional unit string; when reported as Fahrenheit, values are\n                converted to Celsius.\n\n        Returns:\n            Any | None:\n                Parsed and optionally converted value, or None on failure.\n        \"\"\"\n        if val is None:\n            return None\n        try:\n            num_str = str(val).strip().split()[0].strip('%')\n            value = as_type(num_str)\n            if unit:\n                unit = unit.lower()\n                if unit in ['f', '\u00c2\u00b0f']:\n                    value = round((value - 32) * 5 / 9, 2)\n            return value\n        except (ValueError, TypeError):\n            return None\n\n    def get_val_and_unit(data_list, target_id):\n        \"\"\"\n        Helper to locate a record in an Ecowitt list and extract (value, unit).\n\n        Args:\n            data_list (list[dict]):\n                List of readings as returned by the Ecowitt gateway.\n            target_id (str):\n                Identifier to match in each dict's ``\"id\"`` field.\n\n        Returns:\n            tuple:\n                ``(value, unit)`` where both may be None if the ID is not found.\n        \"\"\"\n        for item in data_list:\n            if item.get(\"id\") == target_id:\n                return item.get(\"val\"), item.get(\"unit\", None)\n        return None, None\n\n    LIVE_URL = f'{address}/get_livedata_info?'\n\n    try:\n        response = requests.get(LIVE_URL)\n        if response.status_code == 200:\n            live_data = response.json()\n\n            common = live_data.get(\"common_list\", [])\n            val, unit = get_val_and_unit(common, \"0x02\")\n            result['outdoor']['temperature'] = parse_val(val, float, unit)\n\n            val, unit = get_val_and_unit(common, \"0x07\")\n            result['outdoor']['humidity'] = parse_val(val, int, unit)\n\n            val, unit = get_val_and_unit(common, \"3\")\n            result['outdoor']['feels_like'] = parse_val(val, float, unit)\n\n            val, unit = get_val_and_unit(common, \"0x03\")\n            result['outdoor']['dew_point'] = parse_val(val, float, unit)\n\n            val, unit = get_val_and_unit(common, \"0x0B\")\n            result['wind']['wind_speed'] = parse_val(val, float, unit)\n\n            val, unit = get_val_and_unit(common, \"0x0C\")\n            result['wind']['wind_gust'] = parse_val(val, float, unit)\n\n            val, unit = get_val_and_unit(common, \"0x0A\")\n            result['wind']['wind_direction'] = parse_val(val, int, unit)\n\n            val, unit = get_val_and_unit(common, \"0x15\")\n            result['solar_and_uvi']['solar'] = parse_val(val, float, unit)\n\n            val, unit = get_val_and_unit(common, \"0x17\")\n            result['solar_and_uvi']['uvi'] = parse_val(val, int, unit)\n\n            # --- Rain ---\n            rain = live_data.get(\"rain\", [])\n            for rid, key in {\n                \"0x0D\": \"event\",\n                \"0x0E\": \"rain_rate\",\n                \"0x10\": \"hourly\",\n                \"0x11\": \"daily\",\n                \"0x12\": \"weekly\",\n                \"0x13\": \"yearly\"\n            }.items():\n                val, unit = get_val_and_unit(rain, rid)\n                result['rainfall'][key] = parse_val(val, float, unit)\n\n            # --- WH25 Indoor Sensor ---\n            wh25 = live_data.get(\"wh25\", [{}])[0]\n            result['indoor']['temperature'] = parse_val(wh25.get(\"intemp\"), float, wh25.get(\"unit\"))\n            result['indoor']['humidity'] = parse_val(wh25.get(\"inhumi\"), int)\n\n            result['pressure']['absolute'] = parse_val(wh25.get(\"abs\"), float)\n            result['pressure']['relative'] = parse_val(wh25.get(\"rel\"), float)\n\n            # --- Lightning ---\n            lightning = live_data.get(\"lightning\", [{}])[0]\n            result['lightning']['distance'] = parse_val(lightning.get(\"distance\"), float)\n            result['lightning']['count'] = parse_val(lightning.get(\"count\"), int)\n\n    except Exception as e:\n        me = os.path.basename(__file__)\n        eType, eObject, eTraceback = sys.exc_info()\n        log(0, f'ERROR: Failed to read live data from the local Ecowitt gateway on line {eTraceback.tb_lineno} in {me} - {e}')\n\n    return result\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_environment_variable","title":"<code>get_environment_variable(name, fatal=False, debug=False, try_allsky_debug_file=False)</code>","text":"<p>Helper for reading an environment variable.</p> <p>This is the modern, snake_case wrapper around the legacy :func:<code>getEnvironmentVariable</code> implementation. New code should call this function rather than the camelCase version.</p> <p>Parameters:</p> Name Type Description Default <code>name</code> <p>Name of the environment variable to read.</p> required <code>fatal</code> <p>If True and the variable cannot be resolved, the process will terminate with an error.</p> <code>False</code> <code>debug</code> <p>If True, values are read from the debug database instead of the real environment.</p> <code>False</code> <code>try_allsky_debug_file</code> <p>When False (default), the function will fall back to loading variables from <code>variables.json</code>. When True, it will instead try to look up the value in the overlay debug data file.</p> <code>False</code> <p>Returns:</p> Type Description <p>The resolved value as a string, or None if not found (and <code>fatal</code></p> <p>is False).</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_environment_variable(name, fatal=False, debug=False, try_allsky_debug_file=False):\n    \"\"\"\n    Helper for reading an environment variable.\n\n    This is the modern, snake_case wrapper around the legacy\n    :func:`getEnvironmentVariable` implementation. New code should call this\n    function rather than the camelCase version.\n\n    Args:\n        name: Name of the environment variable to read.\n        fatal: If True and the variable cannot be resolved, the process will\n            terminate with an error.\n        debug: If True, values are read from the debug database instead of\n            the real environment.\n        try_allsky_debug_file: When False (default), the function will fall\n            back to loading variables from ``variables.json``. When True,\n            it will instead try to look up the value in the overlay debug\n            data file.\n\n    Returns:\n        The resolved value as a string, or None if not found (and ``fatal``\n        is False).\n    \"\"\"\n    return getEnvironmentVariable(name, fatal, debug)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_extra_dir","title":"<code>get_extra_dir(current_only=False)</code>","text":"<p>Helper to get the \"extra data\" directory or directories.</p> <p>This simply calls :func:<code>getExtraDir</code>. New code should use this snake_case name.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_extra_dir(current_only:bool = False) -&gt; list[str] | str:\n    \"\"\"\n    Helper to get the \"extra data\" directory or directories.\n\n    This simply calls :func:`getExtraDir`. New code should use this\n    snake_case name.\n    \"\"\"\n    return getExtraDir(current_only)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_flows_with_module","title":"<code>get_flows_with_module(module_name)</code>","text":"<p>Scan module flow files and return those containing a given module.</p> <p>Only <code>postprocessing_*.json</code> files that are not debug variants are considered. Files that fail to parse are quietly ignored.</p> <p>Parameters:</p> Name Type Description Default <code>module_name</code> <code>str</code> <p>Name of the module to search for in the flow definitions.</p> required <p>Returns:</p> Name Type Description <code>dict</code> <p>Mapping of filename to parsed JSON content for flows that contain the given module.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_flows_with_module(module_name):\n    \"\"\"\n    Scan module flow files and return those containing a given module.\n\n    Only ``postprocessing_*.json`` files that are not debug variants are\n    considered. Files that fail to parse are quietly ignored.\n\n    Args:\n        module_name (str):\n            Name of the module to search for in the flow definitions.\n\n    Returns:\n        dict:\n            Mapping of filename to parsed JSON content for flows that contain\n            the given module.\n    \"\"\"\n    folder = Path(ALLSKY_MODULES)\n    found: Dict[str, Any] = {}\n\n    for file in folder.glob(\"*.json\"):\n        if not file.name.endswith(\"-debug.json\"):\n            if file.name.startswith(\"postprocessing_\"):\n                try:\n                    with file.open(\"r\", encoding=\"utf-8\") as f:\n                        data = json.load(f)\n\n                    if module_name in data:\n                        found[file.name] = data\n\n                except (json.JSONDecodeError, OSError) as e:\n                    pass\n\n    return found\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_gpio_pin","title":"<code>get_gpio_pin(gpio_pin, pi=None, show_errors=False)</code>","text":"<p>Read the logical state of a GPIO pin via the Allsky API (legacy alias).</p> <p>This definition simply calls :func:<code>read_gpio_pin</code>. It is kept for backward compatibility with existing code that expects <code>get_gpio_pin</code> to return a pin value rather than a board pin object.</p> <p>Parameters:</p> Name Type Description Default <code>gpio_pin</code> <code>int | str</code> <p>Pin identifier understood by the Allsky API.</p> required <code>pi</code> <code>Any</code> <p>Unused placeholder kept for interface compatibility.</p> <code>None</code> <code>show_errors</code> <code>bool</code> <p>Currently unused; kept for interface compatibility.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>bool</code> <p>True if the GPIO is reported as <code>\"on\"</code>, False otherwise.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_gpio_pin(gpio_pin, pi=None, show_errors=False):\n    \"\"\"\n    Read the logical state of a GPIO pin via the Allsky API (legacy alias).\n\n    This definition simply calls :func:`read_gpio_pin`. It is kept for\n    backward compatibility with existing code that expects ``get_gpio_pin``\n    to return a pin value rather than a board pin object.\n\n    Args:\n        gpio_pin (int | str):\n            Pin identifier understood by the Allsky API.\n        pi (Any, optional):\n            Unused placeholder kept for interface compatibility.\n        show_errors (bool, optional):\n            Currently unused; kept for interface compatibility.\n\n    Returns:\n        bool:\n            True if the GPIO is reported as ``\"on\"``, False otherwise.\n    \"\"\"\n    return read_gpio_pin(gpio_pin, pi=None, show_errors=False)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_gpio_pin_details","title":"<code>get_gpio_pin_details(pin)</code>","text":"<p>Get the CircuitPython <code>board</code> pin object for a given numeric pin.</p> <p>This is a convenience wrapper around :func:<code>getGPIOPin</code> and should be used by new code.</p> <p>Parameters:</p> Name Type Description Default <code>pin</code> <code>int</code> <p>Numeric pin index (0\u201327) corresponding to a board pin.</p> required <p>Returns:</p> Name Type Description <code>Any</code> <p>The matching <code>board.Dx</code> constant, or None if the pin is unknown.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_gpio_pin_details(pin):\n    \"\"\"\n    Get the CircuitPython ``board`` pin object for a given numeric pin.\n\n    This is a convenience wrapper around :func:`getGPIOPin` and should be\n    used by new code.\n\n    Args:\n        pin (int):\n            Numeric pin index (0\u201327) corresponding to a board pin.\n\n    Returns:\n        Any:\n            The matching ``board.Dx`` constant, or None if the pin is unknown.\n    \"\"\"\n    return getGPIOPin(pin)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_hass_sensor_value","title":"<code>get_hass_sensor_value(ha_url, ha_ltt, ha_sensor)</code>","text":"<p>Query a Home Assistant sensor and return its numeric state.</p> <p>A GET request is sent to the Home Assistant REST API using the supplied long-lived token. The sensor's state is parsed as a float on success.</p> <p>Parameters:</p> Name Type Description Default <code>ha_url</code> <code>str</code> <p>Base URL of the Home Assistant instance (e.g. <code>\"http://host:8123\"</code>).</p> required <code>ha_ltt</code> <code>str</code> <p>Long-lived access token for Home Assistant.</p> required <code>ha_sensor</code> <code>str</code> <p>Entity ID of the sensor (e.g. <code>\"sensor.outdoor_temp\"</code>).</p> required <p>Returns:</p> Type Description <p>float | None: The sensor state as a float, or None if the sensor cannot be read.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_hass_sensor_value(ha_url, ha_ltt, ha_sensor):\n    \"\"\"\n    Query a Home Assistant sensor and return its numeric state.\n\n    A GET request is sent to the Home Assistant REST API using the supplied\n    long-lived token. The sensor's state is parsed as a float on success.\n\n    Args:\n        ha_url (str):\n            Base URL of the Home Assistant instance (e.g. ``\"http://host:8123\"``).\n        ha_ltt (str):\n            Long-lived access token for Home Assistant.\n        ha_sensor (str):\n            Entity ID of the sensor (e.g. ``\"sensor.outdoor_temp\"``).\n\n    Returns:\n        float | None:\n            The sensor state as a float, or None if the sensor cannot be read.\n    \"\"\"\n    result = None\n\n    headers = {\n        'Authorization': f'Bearer {ha_ltt}',\n        'Content-Type': 'application/json',\n    }\n\n    try:\n        response = requests.get(f'{ha_url}/api/states/{ha_sensor}', headers=headers)\n\n        if response.status_code == 200:\n            result = float(response.json().get('state'))\n        else:\n            if response.status_code == 404:\n                log(0, f'ERROR: Unable to read {ha_sensor} from {ha_url}. homeassistant reports the sensor does not exist')\n            else:\n                if response.status_code == 401:\n                    log(0, f'ERROR: Unable to read {ha_sensor} from {ha_url}. homeassistant reports the token is unauthorised')\n                else:\n                    log(0, f'ERROR: Unable to read {ha_sensor} from {ha_url}. Error code {response.status_code}')\n\n    except Exception as e:\n        me = os.path.basename(__file__)\n        eType, eObject, eTraceback = sys.exc_info()\n        log(0, f'ERROR: Failed to read data from Homeassistant {eTraceback.tb_lineno} in {me} - {e}')\n        result = None\n\n    return result\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_lat_lon","title":"<code>get_lat_lon()</code>","text":"<p>Read latitude and longitude from settings and return them as floats.</p> <p>The settings <code>latitude</code> and <code>longitude</code> may be stored in a variety of formats supported by :func:<code>convert_lat_lon</code> (for example, <code>51.5N</code> or <code>-0.13</code>). If a value is empty, the corresponding return value is <code>None</code>.</p> <p>Returns:</p> Type Description <p>Tuple of <code>(lat, lon)</code> where each element is either a float or</p> <p>None if not defined.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_lat_lon():\n    \"\"\"\n    Read latitude and longitude from settings and return them as floats.\n\n    The settings ``latitude`` and ``longitude`` may be stored in a variety\n    of formats supported by :func:`convert_lat_lon` (for example,\n    ``51.5N`` or ``-0.13``). If a value is empty, the corresponding\n    return value is ``None``.\n\n    Returns:\n        Tuple of ``(lat, lon)`` where each element is either a float or\n        None if not defined.\n    \"\"\"\n    lat = None\n    lon = None\n\n    temp_lat = get_setting('latitude')\n    if temp_lat != '':\n        lat = convert_lat_lon(temp_lat)\n    temp_lon = get_setting('longitude')\n    if temp_lon != '':\n        lon = convert_lat_lon(temp_lon)\n\n    return lat, lon\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_pi_info","title":"<code>get_pi_info(info)</code>","text":"<p>Query simple hardware details about the Raspberry Pi.</p> <p>Parameters:</p> Name Type Description Default <code>info</code> <p>One of the predefined constants:</p> <ul> <li><code>PI_INFO_MODEL</code> \u2013 return the board model string.</li> <li><code>Pi_INFO_CPU_TEMPERATURE</code> \u2013 return the CPU temperature in \u00b0C.</li> </ul> required <p>Returns:</p> Type Description <p>The requested value, or None if <code>info</code> does not match a</p> <p>supported constant.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_pi_info(info):\n    \"\"\"\n    Query simple hardware details about the Raspberry Pi.\n\n    Args:\n        info:\n            One of the predefined constants:\n\n            - ``PI_INFO_MODEL`` \u2013 return the board model string.\n            - ``Pi_INFO_CPU_TEMPERATURE`` \u2013 return the CPU temperature in \u00b0C.\n\n    Returns:\n        The requested value, or None if ``info`` does not match a\n        supported constant.\n    \"\"\"\n    from gpiozero import Device, CPUTemperature\n    resukt = None\n\n    if info == PI_INFO_MODEL:\n        Device.ensure_pin_factory()\n        pi_info = Device.pin_factory.board_info\n        result = pi_info.model\n\n    if info == Pi_INFO_CPU_TEMPERATURE:\n        result = CPUTemperature().temperature\n\n    return result\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_rpi_meta_value","title":"<code>get_rpi_meta_value(key)</code>","text":"<p>Read a single value from the Raspberry Pi camera metadata file.</p> <p>The metadata file format can be either JSON or simple <code>key=value</code> text. This helper tries JSON first and falls back to line-based parsing.</p> <p>Parameters:</p> Name Type Description Default <code>key</code> <code>str</code> <p>Metadata key to retrieve.</p> required <p>Returns:</p> Name Type Description <code>Any</code> <p>The value if found, or 0 if the file is missing, unreadable, or the key is not present.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_rpi_meta_value(key):\n    \"\"\"\n    Read a single value from the Raspberry Pi camera metadata file.\n\n    The metadata file format can be either JSON or simple ``key=value`` text.\n    This helper tries JSON first and falls back to line-based parsing.\n\n    Args:\n        key (str):\n            Metadata key to retrieve.\n\n    Returns:\n        Any:\n            The value if found, or 0 if the file is missing, unreadable, or the\n            key is not present.\n    \"\"\"\n    result = None\n    metadata_path = get_rpi_metadata()\n\n    if metadata_path is not None:\n        try:\n            with open(metadata_path, 'r') as file:\n                metadata = json.load(file)\n                if key in metadata:\n                    result = metadata[key]\n        except json.JSONDecodeError as e:\n            with open(metadata_path, 'r') as f:\n                for line in f:\n                    if line.startswith(key + \"=\"):\n                        result = line.split(\"=\", 1)[1].strip()\n        except FileNotFoundError as e:\n            result = 0\n        except Exception as e:\n            result = 0\n\n    return result\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_rpi_metadata","title":"<code>get_rpi_metadata()</code>","text":"<p>Determine the path to the Raspberry Pi camera metadata file.</p> <p>The metadata path is extracted from the <code>extraargs</code> in the main settings file if a <code>--metadata</code> argument is present. If no explicit path is found, a default of <code>metadata.txt</code> in the current directory is used.</p> <p>Returns:</p> Name Type Description <code>str</code> <p>Path to the metadata file.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_rpi_metadata():\n    \"\"\"\n    Determine the path to the Raspberry Pi camera metadata file.\n\n    The metadata path is extracted from the ``extraargs`` in the main\n    settings file if a ``--metadata`` argument is present. If no explicit\n    path is found, a default of ``metadata.txt`` in the current directory\n    is used.\n\n    Returns:\n        str:\n            Path to the metadata file.\n    \"\"\"\n    with open(ALLSKY_SETTINGS_FILE) as file:\n        config = json.load(file)\n\n    extraargs = config.get('extraargs', '')\n    args = shlex.split(extraargs)\n\n    metadata_path = None\n    for i, arg in enumerate(args):\n        if arg == '--metadata' and i + 1 &lt; len(args):\n            metadata_path = args[i + 1]\n            break\n    if metadata_path is None:\n        metadata_path = os.path.join(ALLSKY_CURRENT_DIR, 'metadata.txt')\n\n    return metadata_path\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_secrets","title":"<code>get_secrets(keys)</code>","text":"<p>Load one or more secrets from <code>env.json</code> in <code>ALLSKYPATH</code>.</p> <p>The file is expected to contain a flat JSON object mapping key names to secret values. Only the requested keys are returned; missing keys are silently ignored.</p> <p>Parameters:</p> Name Type Description Default <code>keys</code> <code>Union[str, List[str]]</code> <p>Either a single key (string) or a list of key names to fetch.</p> required <p>Returns:</p> Type Description <code>Union[str, Dict[str, str], None]</code> <p>If a single key was requested, the value as a string (or None if</p> <code>Union[str, Dict[str, str], None]</code> <p>it is not present).</p> <code>Union[str, Dict[str, str], None]</code> <p>If multiple keys were requested, a <code>dict</code> mapping each key to</p> <code>Union[str, Dict[str, str], None]</code> <p>its value. Keys that are not found are omitted from the mapping.</p> <code>Union[str, Dict[str, str], None]</code> <p>If the file cannot be read or parsed, returns None (single key) or</p> <code>Union[str, Dict[str, str], None]</code> <p>an empty dict (multiple keys).</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_secrets(keys: Union[str, List[str]]) -&gt; Union[str, Dict[str, str], None]:\n    \"\"\"\n    Load one or more secrets from ``env.json`` in ``ALLSKYPATH``.\n\n    The file is expected to contain a flat JSON object mapping key names\n    to secret values. Only the requested keys are returned; missing keys\n    are silently ignored.\n\n    Args:\n        keys:\n            Either a single key (string) or a list of key names to fetch.\n\n    Returns:\n        If a single key was requested, the value as a string (or None if\n        it is not present).\n\n        If multiple keys were requested, a ``dict`` mapping each key to\n        its value. Keys that are not found are omitted from the mapping.\n\n        If the file cannot be read or parsed, returns None (single key) or\n        an empty dict (multiple keys).\n    \"\"\"\n    single = isinstance(keys, str)\n    if single:\n        keys = [keys]\n\n    try:\n        file_path = os.path.join(ALLSKYPATH, 'env.json')\n        with open(file_path, 'r') as f:\n            secrets = json.load(f)\n\n        results = {k: secrets[k] for k in keys if k in secrets}\n\n        if single:\n            return results.get(keys[0])\n        return results\n\n    except (IOError, json.JSONDecodeError) as e:\n        print(f\"Error reading secrets file: {e}\")\n        return None if single else {}\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_sensor_temperature","title":"<code>get_sensor_temperature()</code>","text":"<p>Get the current sensor temperature for the active camera.</p> <p>For Raspberry Pi cameras, this reads the <code>SensorTemperature</code> value from the Pi metadata. For other camera types it uses the <code>AS_TEMPERATURE_C</code> environment variable.</p> <p>If no temperature can be determined, 0.0 is returned.</p> <p>Returns:</p> Name Type Description <code>float</code> <p>Sensor temperature in \u00b0C.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_sensor_temperature():\n    \"\"\"\n    Get the current sensor temperature for the active camera.\n\n    For Raspberry Pi cameras, this reads the ``SensorTemperature`` value\n    from the Pi metadata. For other camera types it uses the\n    ``AS_TEMPERATURE_C`` environment variable.\n\n    If no temperature can be determined, 0.0 is returned.\n\n    Returns:\n        float:\n            Sensor temperature in \u00b0C.\n    \"\"\"\n    temperature = 0\n    camera_type = get_camera_type()\n\n    if camera_type == 'rpi':\n        temperature = get_rpi_meta_value('SensorTemperature')\n    else:\n        temperature = get_environment_variable('AS_TEMPERATURE_C')\n\n    if temperature == None:\n        temperature = 0\n\n    return float(temperature)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_setting","title":"<code>get_setting(settingName)</code>","text":"<p>Helper for reading a setting from the loaded settings JSON.</p> <p>This wraps the legacy :func:<code>getSetting</code> and should be used in new code. See :func:<code>getSetting</code> for details.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_setting(settingName):\n    \"\"\"\n    Helper for reading a setting from the loaded settings JSON.\n\n    This wraps the legacy :func:`getSetting` and should be used in new\n    code. See :func:`getSetting` for details.\n    \"\"\"\n    return getSetting(settingName)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_value_from_debug_data","title":"<code>get_value_from_debug_data(key)</code>","text":"<p>Look up a key in the overlay debug file.</p> <p>This function is used when running in debug mode to retrieve values that would normally be supplied via environment variables.</p> <p>Parameters:</p> Name Type Description Default <code>key</code> <code>str</code> <p>Name of the value to retrieve.</p> required <p>Returns:</p> Type Description <code>str | None</code> <p>The corresponding value as a string with whitespace removed, or</p> <code>str | None</code> <p>None if the file does not exist, cannot be read, or the key is</p> <code>str | None</code> <p>not present.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_value_from_debug_data(key: str) -&gt; str | None:\n    \"\"\"\n    Look up a key in the overlay debug file.\n\n    This function is used when running in debug mode to retrieve values\n    that would normally be supplied via environment variables.\n\n    Args:\n        key: Name of the value to retrieve.\n\n    Returns:\n        The corresponding value as a string with whitespace removed, or\n        None if the file does not exist, cannot be read, or the key is\n        not present.\n    \"\"\"\n    setup_for_command_line()\n\n    try:\n        allsky_tmp = os.environ[\"ALLSKY_TMP\"]\n        file_path = os.path.join(allsky_tmp, \"overlaydebug.txt\")\n\n        try:\n            with open(file_path, \"r\", encoding=\"utf-8\") as f:\n                for line in f:\n                    if not line.strip() or line.strip().startswith(\"#\"):\n                        continue\n\n                    parts = line.split(maxsplit=1)\n                    if len(parts) == 2 and parts[0] == key:\n                        return \"\".join(parts[1].split())\n        except FileNotFoundError:\n            return None\n    except:\n        return None\n    return None\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.load_extra_data_file","title":"<code>load_extra_data_file(file_name, type='')</code>","text":"<p>Load an extra data file from one or more ALLSKY_EXTRA directories.</p> <p>This helper looks for the given file name in all configured extra-data directories (via :func:<code>get_extra_dir</code>). If it finds a readable file, it will attempt to parse it according to its extension.</p> <p>Currently only JSON files are parsed. Text files are recognised but not yet processed (the block is a placeholder).</p> <p>Parameters:</p> Name Type Description Default <code>file_name</code> <code>str</code> <p>Name of the extra data file to load (e.g. <code>\"extra.json\"</code>).</p> required <code>type</code> <code>str</code> <p>Force the file type. If set to <code>\"json\"</code>, the file is parsed as JSON regardless of its extension.</p> <code>''</code> <p>Returns:</p> Name Type Description <code>dict</code> <p>Parsed JSON data if successful; otherwise an empty dict.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def load_extra_data_file(file_name, type=''):\n    \"\"\"\n    Load an extra data file from one or more ALLSKY_EXTRA directories.\n\n    This helper looks for the given file name in all configured extra-data\n    directories (via :func:`get_extra_dir`). If it finds a readable file,\n    it will attempt to parse it according to its extension.\n\n    Currently only JSON files are parsed. Text files are recognised but\n    not yet processed (the block is a placeholder).\n\n    Args:\n        file_name (str):\n            Name of the extra data file to load (e.g. ``\"extra.json\"``).\n        type (str, optional):\n            Force the file type. If set to ``\"json\"``, the file is parsed\n            as JSON regardless of its extension.\n\n    Returns:\n        dict:\n            Parsed JSON data if successful; otherwise an empty dict.\n    \"\"\"\n    result = {}\n    extra_data_paths = get_extra_dir()\n    for extra_data_path in extra_data_paths:\n        if extra_data_path is not None:               # it should never be None\n            extra_data_filename = os.path.join(extra_data_path, file_name)\n            file_path = Path(extra_data_filename)\n            if file_path.is_file() and isFileReadable(file_path):\n                file_extension = Path(file_path).suffix\n\n                if file_extension == '.json' or type == 'json':\n                    try:\n                        with open(extra_data_filename, 'r') as file:\n                            result = json.load(file)\n                    except json.JSONDecodeError:\n                        log(0, f'ERROR: cannot read {extra_data_filename}.')\n\n                if file_extension == '.txt':\n                    pass\n\n    return result\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.load_json_file","title":"<code>load_json_file(path)</code>","text":"<p>Load a JSON file and return its parsed contents.</p> <p>Parameters:</p> Name Type Description Default <code>path</code> <code>str | Path</code> <p>Path to the JSON file.</p> required <p>Returns:</p> Type Description <p>The parsed JSON data (dict or list). If the file does not exist,</p> <p>cannot be read, or contains invalid JSON, an empty dict is</p> <p>returned.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def load_json_file(path: str | Path):\n    \"\"\"\n    Load a JSON file and return its parsed contents.\n\n    Args:\n        path: Path to the JSON file.\n\n    Returns:\n        The parsed JSON data (dict or list). If the file does not exist,\n        cannot be read, or contains invalid JSON, an empty dict is\n        returned.\n    \"\"\"\n    try:\n        file_path = Path(path)\n        if not file_path.is_file():\n            return {}\n\n        with file_path.open(\"r\", encoding=\"utf-8\") as file:\n            return json.load(file)\n\n    except (OSError, json.JSONDecodeError):\n        return {}\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.load_mask","title":"<code>load_mask(mask_file_name, target_image)</code>","text":"<p>Load a grayscale mask image and resize it to match a target image.</p> <p>The mask is loaded from <code>ALLSKY_OVERLAY/images/&lt;mask_file_name&gt;</code> and converted to a float mask in the range [0, 1]. If the mask dimensions do not match the target image, it is resized accordingly.</p> <p>Parameters:</p> Name Type Description Default <code>mask_file_name</code> <code>str</code> <p>Name of the mask file to load.</p> required <code>target_image</code> <code>ndarray</code> <p>Target image whose shape is used for resizing.</p> required <p>Returns:</p> Type Description <p>numpy.ndarray | None: Float mask array in the range [0, 1], or None if the mask could not be loaded.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def load_mask(mask_file_name, target_image):\n    \"\"\"\n    Load a grayscale mask image and resize it to match a target image.\n\n    The mask is loaded from ``ALLSKY_OVERLAY/images/&lt;mask_file_name&gt;`` and\n    converted to a float mask in the range [0, 1]. If the mask dimensions do\n    not match the target image, it is resized accordingly.\n\n    Args:\n        mask_file_name (str):\n            Name of the mask file to load.\n        target_image (numpy.ndarray):\n            Target image whose shape is used for resizing.\n\n    Returns:\n        numpy.ndarray | None:\n            Float mask array in the range [0, 1], or None if the mask could\n            not be loaded.\n    \"\"\"\n    import cv2\n    mask = None\n\n    mask_path = os.path.join(ALLSKY_OVERLAY, 'images', mask_file_name)\n    target_shape = target_image.shape[:2]\n\n    mask = cv2.imread(mask_path, cv2.IMREAD_GRAYSCALE)\n    if mask is not None:\n        if (mask.shape[0] != target_shape[0]) or (mask.shape[1] != target_shape[1]):\n            mask = cv2.resize(mask, (target_shape[1], target_shape[0]))\n        mask = mask.astype(np.float32) / 255.0\n\n    return mask\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.load_secrets_file","title":"<code>load_secrets_file()</code>","text":"<p>Load environment-style secrets from <code>env.json</code> in the Allsky home directory.</p> <p>Any JSON decoding errors are treated as an empty file.</p> <p>Returns:</p> Name Type Description <code>dict</code> <code>Dict[str, Any]</code> <p>Parsed secrets dictionary, or an empty dict if missing/invalid.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def load_secrets_file() -&gt; Dict[str, Any]:\n    \"\"\"\n    Load environment-style secrets from ``env.json`` in the Allsky home directory.\n\n    Any JSON decoding errors are treated as an empty file.\n\n    Returns:\n        dict:\n            Parsed secrets dictionary, or an empty dict if missing/invalid.\n    \"\"\"\n    file_path = Path(os.path.join(ALLSKYPATH, 'env.json'))\n    env_data: Dict[str, Any] = {}\n    if file_path.is_file():\n        with file_path.open(\"r\", encoding=\"utf-8\") as f:\n            try:\n                env_data = json.load(f) or {}\n            except json.JSONDecodeError:\n                env_data = {}\n\n    return env_data\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.log","title":"<code>log(level, text, preventNewline=False, exitCode=None, sendToAllsky=False)</code>","text":"<p>Very simple method to log data if in verbose mode</p> <p>Log a message to stdout (depending on log level) and optionally forward it to the Allsky WebUI.</p> <p>Parameters:</p> Name Type Description Default <code>level</code> <p>Numeric log level. The message is printed if the global <code>LOGLEVEL</code> is greater than or equal to this value. Level 0 is treated as an error.</p> required <code>text</code> <p>The message to log.</p> required <code>preventNewline</code> <p>If True, the message is printed without a trailing newline.</p> <code>False</code> <code>exitCode</code> <p>If not None, the process exits with this code after logging the message.</p> <code>None</code> <code>sendToAllsky</code> <p>If True, the message is also passed to the Allsky WebUI via <code>addMessage.sh</code>. Level 0 messages are always sent as errors.</p> <code>False</code> Notes <p>The function does not raise exceptions. If the WebUI message script fails, the error is silently ignored.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def log(level, text, preventNewline = False, exitCode=None, sendToAllsky=False):\n    \"\"\" Very simple method to log data if in verbose mode\n\n    Log a message to stdout (depending on log level) and optionally\n    forward it to the Allsky WebUI.\n\n    Args:\n        level:\n            Numeric log level. The message is printed if the global\n            ``LOGLEVEL`` is greater than or equal to this value. Level 0\n            is treated as an error.\n        text:\n            The message to log.\n        preventNewline:\n            If True, the message is printed without a trailing newline.\n        exitCode:\n            If not None, the process exits with this code after logging\n            the message.\n        sendToAllsky:\n            If True, the message is also passed to the Allsky WebUI via\n            ``addMessage.sh``. Level 0 messages are always sent as\n            errors.\n\n    Notes:\n        The function does not raise exceptions. If the WebUI message\n        script fails, the error is silently ignored.\n    \"\"\"\n    global LOGLEVEL, ALLSKY_SCRIPTS\n\n    if LOGLEVEL &gt;= level:\n        if preventNewline:\n            print(text, end=\"\")\n        else:\n            print(text)\n\n    if sendToAllsky or level == 0:\n        if level == 0:\n            type = \"error\"\n        else:\n            type = \"warning\"\n        # Need to escape single quotes in {text}.\n        doubleQuote = '\"'\n        text = text.replace(\"'\", f\"'{doubleQuote}'{doubleQuote}'\")\n        command = os.path.join(ALLSKY_SCRIPTS, f\"addMessage.sh --type {type} --msg '{text}'\")\n        os.system(command)\n\n    if exitCode is not None:\n        sys.exit(exitCode)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.mask_image","title":"<code>mask_image(image, mask_file_name='', log_info=False)</code>","text":"<p>Apply a mask to an image, returning a masked copy.</p> <p>The mask is loaded via :func:<code>load_mask</code> and applied either directly (for grayscale images) or per-channel (for colour images). The result is clipped and converted back to <code>uint8</code>.</p> <p>Parameters:</p> Name Type Description Default <code>image</code> <code>ndarray</code> <p>Input image (grayscale or BGR).</p> required <code>mask_file_name</code> <code>str</code> <p>Name of the mask image file. If empty, no masking is performed and None is returned.</p> <code>''</code> <code>log_info</code> <code>bool</code> <p>If True, log a message at level 4 when a mask is applied.</p> <code>False</code> <p>Returns:</p> Type Description <p>numpy.ndarray | None: Masked image, or None if no mask is applied or an error occurs.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def mask_image(image, mask_file_name='', log_info=False):\n    \"\"\"\n    Apply a mask to an image, returning a masked copy.\n\n    The mask is loaded via :func:`load_mask` and applied either directly\n    (for grayscale images) or per-channel (for colour images). The result\n    is clipped and converted back to ``uint8``.\n\n    Args:\n        image (numpy.ndarray):\n            Input image (grayscale or BGR).\n        mask_file_name (str, optional):\n            Name of the mask image file. If empty, no masking is performed\n            and None is returned.\n        log_info (bool, optional):\n            If True, log a message at level 4 when a mask is applied.\n\n    Returns:\n        numpy.ndarray | None:\n            Masked image, or None if no mask is applied or an error occurs.\n    \"\"\"\n    output = None\n    try:\n        if mask_file_name != '':\n            mask = load_mask(mask_file_name, image)\n            if len(image.shape) == 2:\n                image = image.astype(np.float32)\n                output = image * mask\n            else:\n                image = image.astype(np.float32)\n                if mask.ndim == 2:\n                    mask = mask[..., np.newaxis]\n                output = image * mask\n\n            output = np.clip(output, 0, 255).astype(np.uint8)\n\n            if log_info:\n                log(4, f'INFO: Mask {mask_file_name} applied')\n\n    except Exception as e:\n        me = os.path.basename(__file__)\n        eType, eObject, eTraceback = sys.exc_info()\n        log(0, f'ERROR: mask_image failed on line {eTraceback.tb_lineno} in {me} - {e}')\n\n    return output\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.normalise_on_off","title":"<code>normalise_on_off(value)</code>","text":"<p>Normalise an on/off style value to the strings <code>\"on\"</code> or <code>\"off\"</code>.</p> <p>Parameters:</p> Name Type Description Default <code>value</code> <code>Any</code> <p>Raw value (e.g. <code>\"on\"</code>, <code>\"1\"</code>, <code>\"off\"</code>, <code>0</code>).</p> required <p>Returns:</p> Name Type Description <code>str</code> <p><code>\"on\"</code> if the input looks like an enabled value, otherwise <code>\"off\"</code>.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def normalise_on_off(value):\n    \"\"\"\n    Normalise an on/off style value to the strings ``\"on\"`` or ``\"off\"``.\n\n    Args:\n        value (Any):\n            Raw value (e.g. ``\"on\"``, ``\"1\"``, ``\"off\"``, ``0``).\n\n    Returns:\n        str:\n            ``\"on\"`` if the input looks like an enabled value, otherwise ``\"off\"``.\n    \"\"\"\n    if str(value).strip().lower() == 'on' or str(value).strip() == '1':\n        return 'on'\n    return 'off'\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.obfuscate_password","title":"<code>obfuscate_password(password)</code>","text":"<p>Obfuscate a password, leaving the first and last characters visible.</p> <p>This is used when logging configuration without exposing full credentials.</p> <p>Parameters:</p> Name Type Description Default <code>password</code> <code>str</code> <p>Original password string.</p> required <p>Returns:</p> Type Description <code>str</code> <p>Obfuscated password. Very short passwords are completely masked.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def obfuscate_password(password: str) -&gt; str:\n    \"\"\"\n    Obfuscate a password, leaving the first and last characters visible.\n\n    This is used when logging configuration without exposing full\n    credentials.\n\n    Args:\n        password: Original password string.\n\n    Returns:\n        Obfuscated password. Very short passwords are completely masked.\n    \"\"\"\n    if not password:\n        return \"\"\n    if len(password) &lt;= 2:\n        return \"*\" * len(password)\n    return password[0] + \"*\" * (len(password) - 2) + password[-1]\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.read_environment_variable","title":"<code>read_environment_variable(name)</code>","text":"<p>Read an environment variable without any Allsky-specific fallback.</p> <p>This is a very thin wrapper around <code>os.environ</code> access and does not attempt to pull values from <code>variables.json</code> or any debug store.</p> <p>Parameters:</p> Name Type Description Default <code>name</code> <p>Environment variable name.</p> required <p>Returns:</p> Type Description <p>The value as a string, or None if the variable is not defined.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def read_environment_variable(name):\n    \"\"\"\n    Read an environment variable without any Allsky-specific fallback.\n\n    This is a very thin wrapper around ``os.environ`` access and does not\n    attempt to pull values from ``variables.json`` or any debug store.\n\n    Args:\n        name: Environment variable name.\n\n    Returns:\n        The value as a string, or None if the variable is not defined.\n    \"\"\"\n    result = None\n    try:\n        result = os.environ[name]\n    except KeyError:\n        result = None        \n\n    return result\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.read_gpio_pin","title":"<code>read_gpio_pin(gpio_pin, pi=None, show_errors=False)</code>","text":"<p>Read the logical state of a GPIO pin via the Allsky HTTP API.</p> <p>A GET request is sent to the Allsky API, and the returned JSON is expected to contain a <code>\"value\"</code> field with the string <code>\"on\"</code> or <code>\"off\"</code>.</p> <p>Parameters:</p> Name Type Description Default <code>gpio_pin</code> <code>int | str</code> <p>Pin identifier understood by the Allsky API.</p> required <code>pi</code> <code>Any</code> <p>Unused placeholder for compatibility with other GPIO interfaces.</p> <code>None</code> <code>show_errors</code> <code>bool</code> <p>Currently unused; errors are propagated via exceptions.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>bool</code> <p>True if the GPIO value is <code>\"on\"</code>, False otherwise.</p> <p>Raises:</p> Type Description <code>HTTPError</code> <p>If the HTTP request fails (via <code>raise_for_status</code>).</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def read_gpio_pin(gpio_pin, pi=None, show_errors=False):\n    \"\"\"\n    Read the logical state of a GPIO pin via the Allsky HTTP API.\n\n    A GET request is sent to the Allsky API, and the returned JSON is\n    expected to contain a ``\"value\"`` field with the string ``\"on\"`` or\n    ``\"off\"``.\n\n    Args:\n        gpio_pin (int | str):\n            Pin identifier understood by the Allsky API.\n        pi (Any, optional):\n            Unused placeholder for compatibility with other GPIO interfaces.\n        show_errors (bool, optional):\n            Currently unused; errors are propagated via exceptions.\n\n    Returns:\n        bool:\n            True if the GPIO value is ``\"on\"``, False otherwise.\n\n    Raises:\n        requests.HTTPError:\n            If the HTTP request fails (via ``raise_for_status``).\n    \"\"\"\n    api_url = get_api_url()\n    response = requests.get(\n        f'{api_url}/gpio/digital/{gpio_pin}',\n        timeout=2\n    )\n    response.raise_for_status()\n    data = response.json()\n\n    return data.get('value') == 'on'\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.run_python_script","title":"<code>run_python_script(script, args=None, cwd=None)</code>","text":"<p>Run a Python script using the same interpreter as the current process (e.g., inside a venv).</p> <p>This function ensures the target script is executed with the current Python interpreter (<code>sys.executable</code>), so that packages installed in the active virtual environment are available.</p> <p>Parameters:</p> Name Type Description Default <code>script</code> <code>str</code> <p>Path to the Python script to execute.</p> required <code>args</code> <code>Optional[List[str]]</code> <p>Additional arguments to pass to the script. Defaults to None.</p> <code>None</code> <code>cwd</code> <code>Optional[str]</code> <p>Working directory in which to run the script. If None, uses the current directory.</p> <code>None</code> <p>Returns:</p> Type Description <code>Tuple[int, str]</code> <p>Tuple[int, str]: A tuple containing: - return code (int): The process's exit code, or 127 if the script is not found. - output (str): Combined standard output and standard error from the script, stripped of trailing whitespace.</p> Example <p>code, output = run_python_script(\"myscript.py\", [\"--option\", \"value\"]) print(code, output) 0 Script ran successfully</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def run_python_script(script: str, args: Optional[List[str]] = None, cwd: Optional[str] = None) -&gt; Tuple[int, str]:\n    \"\"\"\n    Run a Python script using the same interpreter as the current process (e.g., inside a venv).\n\n    This function ensures the target script is executed with the current Python interpreter\n    (`sys.executable`), so that packages installed in the active virtual environment are available.\n\n    Args:\n        script (str): Path to the Python script to execute.\n        args (Optional[List[str]]): Additional arguments to pass to the script. Defaults to None.\n        cwd (Optional[str]): Working directory in which to run the script. If None, uses the current directory.\n\n    Returns:\n        Tuple[int, str]: A tuple containing:\n            - return code (int): The process's exit code, or 127 if the script is not found.\n            - output (str): Combined standard output and standard error from the script, stripped of trailing whitespace.\n\n    Example:\n        &gt;&gt;&gt; code, output = run_python_script(\"myscript.py\", [\"--option\", \"value\"])\n        &gt;&gt;&gt; print(code, output)\n        0 Script ran successfully\n    \"\"\"\n    args = args or []\n    try:\n        proc = subprocess.run(\n            [sys.executable, script, *args],\n            capture_output=True,\n            text=True,\n            check=False,\n            cwd=cwd,\n        )\n        output = (proc.stdout or \"\") + (proc.stderr or \"\")\n        return proc.returncode, output.strip()\n    except FileNotFoundError:\n        return 127, f\"Script not found: {script}\"\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.run_script","title":"<code>run_script(script)</code>","text":"<p>Run an arbitrary executable script and capture its output.</p> <p>Parameters:</p> Name Type Description Default <code>script</code> <code>str</code> <p>Path to the script or binary to execute.</p> required <p>Returns:</p> Type Description <code>int</code> <p>Tuple <code>(returncode, output)</code> where:</p> <code>str</code> <ul> <li><code>returncode</code> is the process exit code, or 127 if the script was not found.</li> </ul> <code>Tuple[int, str]</code> <ul> <li><code>output</code> is the combined stdout and stderr as a single string.</li> </ul> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def run_script(script: str) -&gt; Tuple[int, str]:\n    \"\"\"\n    Run an arbitrary executable script and capture its output.\n\n    Args:\n        script: Path to the script or binary to execute.\n\n    Returns:\n        Tuple ``(returncode, output)`` where:\n\n        - ``returncode`` is the process exit code, or 127 if the script\n          was not found.\n        - ``output`` is the combined stdout and stderr as a single\n          string.\n    \"\"\"\n    try:\n        result = subprocess.run(\n            [script],\n            capture_output=True,\n            text=True,\n            check=False\n        )\n        output = result.stdout + result.stderr\n        return result.returncode, output.strip()\n    except FileNotFoundError:\n        return 127, f\"Script not found: {script}\"\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.save_extra_data","title":"<code>save_extra_data(file_name='', extra_data={}, source='', structure={}, custom_fields={}, event='postcapture')</code>","text":"<p>Persist \"extra data\" for use by Allsky overlay modules.</p> <p>This function writes the provided data to a file inside the current ALLSKY_EXTRA directory (resolved via <code>get_extra_dir(True)</code>), using a temporary file in ALLSKY_TMP and an atomic move to avoid partial writes. It ensures the destination directory exists and is web-server accessible, applies final permissions, and (optionally) updates a database when the <code>structure</code> indicates one is in use.</p> Behavior <p>1) Ensure extra data directory exists (<code>checkAndCreateDirectory</code>) and    enable web access (<code>create_file_web_server_access</code>). 2) If the target filename ends with <code>.json</code>, normalize/shape the payload    via <code>format_extra_data_json(extra_data, structure, source)</code>. 3) Merge any <code>custom_fields</code> into the payload (overrides existing keys). 4) Serialize to JSON (pretty-printed) and write to a temp file created in    <code>ALLSKY_TMP</code>, then atomically move it to the final path. 5) Set mode 0o770 and call <code>set_permissions()</code> for owner/group alignment. 6) If <code>structure</code> contains a <code>\"database\"</code> key, call <code>update_database()</code>.</p> <p>Parameters:</p> Name Type Description Default <code>file_name</code> <code>str</code> <p>File name (with extension) to write into the extra data directory.</p> <code>''</code> <code>extra_data</code> <code>Any</code> <p>Data to persist. If <code>file_name</code> ends with <code>.json</code>, this should be JSON-serializable. Non-JSON targets are written as the JSON string.</p> <code>{}</code> <code>source</code> <code>str</code> <p>Context or origin tag passed to the JSON formatter. Default: ''.</p> <code>''</code> <code>structure</code> <code>dict</code> <p>Schema/metadata guiding JSON formatting and optional DB updates. If it contains <code>\"database\"</code>, <code>update_database()</code> will be invoked. Default: {}.</p> <code>{}</code> <code>custom_fields</code> <code>dict</code> <p>Extra key/values to inject into the payload before serialization. Keys here override the same keys in <code>extra_data</code>. Default: {}.</p> <code>{}</code> <code>event</code> <code>str</code> <p>Event type (e.g. <code>'postcapture'</code>, <code>'periodic'</code>) used when deciding if database updates should occur.</p> <code>'postcapture'</code> <p>Returns:</p> Type Description <p>None</p> Side Effects <ul> <li>Creates/updates a file in ALLSKY_EXTRA.</li> <li>Applies filesystem permissions to the output file.</li> <li>May perform a database update if requested by <code>structure</code>.</li> </ul> Error Handling <p>Any exception is (currently) allowed to propagate only into the surrounding code; earlier versions logged and swallowed errors.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def save_extra_data(file_name: str = '', extra_data: dict = {}, source: str = '', structure: dict = {}, custom_fields: dict = {}, event: str = 'postcapture'):\n    \"\"\"\n    Persist \"extra data\" for use by Allsky overlay modules.\n\n    This function writes the provided data to a file inside the current\n    ALLSKY_EXTRA directory (resolved via `get_extra_dir(True)`), using a\n    temporary file in ALLSKY_TMP and an atomic move to avoid partial writes.\n    It ensures the destination directory exists and is web-server accessible,\n    applies final permissions, and (optionally) updates a database when the\n    `structure` indicates one is in use.\n\n    Behavior:\n      1) Ensure extra data directory exists (`checkAndCreateDirectory`) and\n         enable web access (`create_file_web_server_access`).\n      2) If the target filename ends with `.json`, normalize/shape the payload\n         via `format_extra_data_json(extra_data, structure, source)`.\n      3) Merge any `custom_fields` into the payload (overrides existing keys).\n      4) Serialize to JSON (pretty-printed) and write to a temp file created in\n         `ALLSKY_TMP`, then atomically move it to the final path.\n      5) Set mode 0o770 and call `set_permissions()` for owner/group alignment.\n      6) If `structure` contains a `\"database\"` key, call `update_database()`.\n\n    Args:\n        file_name (str):\n            File name (with extension) to write into the extra data directory.\n        extra_data (Any):\n            Data to persist. If `file_name` ends with `.json`, this should be\n            JSON-serializable. Non-JSON targets are written as the JSON string.\n        source (str, optional):\n            Context or origin tag passed to the JSON formatter. Default: ''.\n        structure (dict, optional):\n            Schema/metadata guiding JSON formatting and optional DB updates.\n            If it contains `\"database\"`, `update_database()` will be invoked.\n            Default: {}.\n        custom_fields (dict, optional):\n            Extra key/values to inject into the payload before serialization.\n            Keys here override the same keys in `extra_data`. Default: {}.\n        event (str, optional):\n            Event type (e.g. ``'postcapture'``, ``'periodic'``) used when\n            deciding if database updates should occur.\n\n    Returns:\n        None\n\n    Side Effects:\n        - Creates/updates a file in ALLSKY_EXTRA.\n        - Applies filesystem permissions to the output file.\n        - May perform a database update if requested by `structure`.\n\n    Error Handling:\n        Any exception is (currently) allowed to propagate only into the\n        surrounding code; earlier versions logged and swallowed errors.\n    \"\"\"\n    saveExtraData(file_name, extra_data, source, structure, custom_fields, event)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.save_json_file","title":"<code>save_json_file(data, filename)</code>","text":"<p>Save a dictionary to a JSON file with pretty formatting.</p> <p>Parameters:</p> Name Type Description Default <code>data</code> <code>dict</code> <p>Dictionary to save. Must be JSON-serializable.</p> required <code>filename</code> <code>Union[str, Path]</code> <p>Path or string of the file to write.</p> required <p>Returns:</p> Type Description <code>None</code> <p>True if the file could be written successfully, False otherwise.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def save_json_file(data: dict, filename: Union[str, Path]) -&gt; None:\n    \"\"\"\n    Save a dictionary to a JSON file with pretty formatting.\n\n    Args:\n        data: Dictionary to save. Must be JSON-serializable.\n        filename: Path or string of the file to write.\n\n    Returns:\n        True if the file could be written successfully, False otherwise.\n    \"\"\"\n    file_path = Path(filename)\n\n    try:\n        with file_path.open('w', encoding='utf-8') as file:\n            json.dump(data, file, ensure_ascii=False, indent=4)\n    except:\n        return False\n\n    return True\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.set_gpio_pin","title":"<code>set_gpio_pin(gpio_pin, state, pi=None, show_errors=False)</code>","text":"<p>Set the logical state of a GPIO pin via the Allsky HTTP API.</p> <p>Parameters:</p> Name Type Description Default <code>gpio_pin</code> <code>int | str</code> <p>Pin identifier understood by the Allsky API.</p> required <code>state</code> <code>Any</code> <p>Desired state; normalised using :func:<code>normalise_on_off</code> to <code>\"on\"</code> or <code>\"off\"</code>.</p> required <code>pi</code> <code>Any</code> <p>Unused placeholder for compatibility with other GPIO interfaces.</p> <code>None</code> <code>show_errors</code> <code>bool</code> <p>Currently unused; errors are propagated via exceptions.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>dict</code> <p>Parsed JSON response from the API.</p> <p>Raises:</p> Type Description <code>HTTPError</code> <p>If the HTTP request fails (via <code>raise_for_status</code>).</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def set_gpio_pin(gpio_pin, state, pi=None, show_errors=False):\n    \"\"\"\n    Set the logical state of a GPIO pin via the Allsky HTTP API.\n\n    Args:\n        gpio_pin (int | str):\n            Pin identifier understood by the Allsky API.\n        state (Any):\n            Desired state; normalised using :func:`normalise_on_off` to\n            ``\"on\"`` or ``\"off\"``.\n        pi (Any, optional):\n            Unused placeholder for compatibility with other GPIO interfaces.\n        show_errors (bool, optional):\n            Currently unused; errors are propagated via exceptions.\n\n    Returns:\n        dict:\n            Parsed JSON response from the API.\n\n    Raises:\n        requests.HTTPError:\n            If the HTTP request fails (via ``raise_for_status``).\n    \"\"\"\n    api_url = get_api_url()\n    state = normalise_on_off(state)\n    response = requests.post(\n        f'{api_url}/gpio/digital',\n        json={\n            'pin': str(gpio_pin),\n            'state': state.lower()\n        },\n        timeout=2\n    )\n    response.raise_for_status()\n    return response.json()\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.set_last_run","title":"<code>set_last_run(module)</code>","text":"<p>Helper to record that a module has just run.</p> <p>This function simply calls the legacy :func:<code>setLastRun</code>. New code should use this name; the camelCase variant is kept for older code.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def set_last_run(module):\n    \"\"\"\n    Helper to record that a module has just run.\n\n    This function simply calls the legacy :func:`setLastRun`. New code\n    should use this name; the camelCase variant is kept for older code.\n    \"\"\"\n    setLastRun(module)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.set_pwm","title":"<code>set_pwm(gpio_pin, duty_cycle, pi=None, show_errors=False)</code>","text":"<p>Set PWM output on a GPIO pin via the Allsky HTTP API.</p> <p>This helper posts the requested duty cycle (and a fixed frequency of 1000Hz) to the API.</p> <p>Parameters:</p> Name Type Description Default <code>gpio_pin</code> <code>int | str</code> <p>Pin identifier understood by the Allsky API.</p> required <code>duty_cycle</code> <code>int | float</code> <p>Duty cycle value; interpreted by the remote API.</p> required <code>pi</code> <code>Any</code> <p>Unused placeholder for compatibility with other GPIO interfaces.</p> <code>None</code> <code>show_errors</code> <code>bool</code> <p>Currently unused; errors are propagated via exceptions.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>dict</code> <p>Parsed JSON response from the API.</p> <p>Raises:</p> Type Description <code>HTTPError</code> <p>If the HTTP request fails (via <code>raise_for_status</code>).</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def set_pwm(gpio_pin, duty_cycle, pi=None, show_errors=False):\n    \"\"\"\n    Set PWM output on a GPIO pin via the Allsky HTTP API.\n\n    This helper posts the requested duty cycle (and a fixed frequency of\n    1000Hz) to the API.\n\n    Args:\n        gpio_pin (int | str):\n            Pin identifier understood by the Allsky API.\n        duty_cycle (int | float):\n            Duty cycle value; interpreted by the remote API.\n        pi (Any, optional):\n            Unused placeholder for compatibility with other GPIO interfaces.\n        show_errors (bool, optional):\n            Currently unused; errors are propagated via exceptions.\n\n    Returns:\n        dict:\n            Parsed JSON response from the API.\n\n    Raises:\n        requests.HTTPError:\n            If the HTTP request fails (via ``raise_for_status``).\n    \"\"\"\n    api_url = get_api_url()\n    frequency = 1000\n    response = requests.post(\n        f'{api_url}/gpio/pwm',\n        json={\n            'pin': str(gpio_pin),\n            'duty': duty_cycle,\n            'frequency': frequency\n        },\n        timeout=2\n    )\n    response.raise_for_status()\n    return response.json()\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.should_run","title":"<code>should_run(module, period)</code>","text":"<p>Helper to check whether a module should run again.</p> <p>This wrapper simply calls the legacy :func:<code>shouldRun</code>. New code should use this snake_case name; the camelCase version is retained for backwards compatibility.</p> <p>See :func:<code>shouldRun</code> for details.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def should_run(module, period):\n    \"\"\"\n    Helper to check whether a module should run again.\n\n    This wrapper simply calls the legacy :func:`shouldRun`. New code\n    should use this snake_case name; the camelCase version is retained\n    for backwards compatibility.\n\n    See :func:`shouldRun` for details.\n    \"\"\"\n    return shouldRun(module, period)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.stop_pwm","title":"<code>stop_pwm(gpio_pin)</code>","text":"<p>Stop PWM output on a GPIO pin via the Allsky HTTP API.</p> <p>This is implemented by sending a PWM request with 0% duty cycle.</p> <p>Parameters:</p> Name Type Description Default <code>gpio_pin</code> <code>int | str</code> <p>Pin identifier understood by the Allsky API.</p> required <p>Returns:</p> Name Type Description <code>dict</code> <p>Parsed JSON response from the API.</p> <p>Raises:</p> Type Description <code>HTTPError</code> <p>If the HTTP request fails (via <code>raise_for_status</code>).</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def stop_pwm(gpio_pin):\n    \"\"\"\n    Stop PWM output on a GPIO pin via the Allsky HTTP API.\n\n    This is implemented by sending a PWM request with 0% duty cycle.\n\n    Args:\n        gpio_pin (int | str):\n            Pin identifier understood by the Allsky API.\n\n    Returns:\n        dict:\n            Parsed JSON response from the API.\n\n    Raises:\n        requests.HTTPError:\n            If the HTTP request fails (via ``raise_for_status``).\n    \"\"\"\n    api_url = get_api_url()\n    frequency = 1000\n    duty_cycle = 0\n    response = requests.post(\n        f'{api_url}/gpio/pwm',\n        json={\n            'pin': str(gpio_pin),\n            'duty': duty_cycle,\n            'frequency': frequency\n        },\n        timeout=2\n    )\n    response.raise_for_status()\n    return response.json()\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.to_bool","title":"<code>to_bool(v)</code>","text":"<p>Normalise a value to a boolean, supporting several truthy strings.</p> <p>This version differs slightly from the earlier :func:<code>to_bool</code> in this file: it treats <code>\"true\"</code>, <code>\"1\"</code>, <code>\"yes\"</code> and <code>\"y\"</code> (case- insensitive) as True, and everything else as False. It is used when normalising configuration dictionaries.</p> <p>Parameters:</p> Name Type Description Default <code>v</code> <code>bool | str | None</code> <p>Input value.</p> required <p>Returns:</p> Name Type Description <code>bool</code> <code>bool</code> <p>Normalised boolean value.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def to_bool(v: bool | str) -&gt; bool:\n    \"\"\"\n    Normalise a value to a boolean, supporting several truthy strings.\n\n    This version differs slightly from the earlier :func:`to_bool` in this\n    file: it treats ``\"true\"``, ``\"1\"``, ``\"yes\"`` and ``\"y\"`` (case-\n    insensitive) as True, and everything else as False. It is used when\n    normalising configuration dictionaries.\n\n    Args:\n        v (bool | str | None):\n            Input value.\n\n    Returns:\n        bool:\n            Normalised boolean value.\n    \"\"\"\n    if isinstance(v, bool):\n        return v\n    if v is None:\n        return False\n    return str(v).strip().lower() in (\"true\", \"1\", \"yes\", \"y\")\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.update_setting","title":"<code>update_setting(values)</code>","text":"<p>Helper to update one or more settings.</p> <p>This wraps the legacy :func:<code>updateSetting</code>. New code should use this snake_case name.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def update_setting(values):\n    \"\"\"\n    Helper to update one or more settings.\n\n    This wraps the legacy :func:`updateSetting`. New code should use\n    this snake_case name.\n    \"\"\"\n    updateSetting(values)\n</code></pre>"},{"location":"allsky_guide/allsky.html","title":"Allsky","text":"<p>Before you install</p> <p>Your camera must be connected to the Pi prior to installation. If you have an RPi camera, run the following to make sure the camera can be seen by Allsky:</p> <p><code>rpicam-still --list-cameras</code></p> <p>If camera number 0 (the first camera) is in the list, you're good to go. Note that some non-Raspberry Pi brand cameras may need special software installed and/or operating system configuration changes - read the camera manual.</p>"},{"location":"allsky_guide/allsky.html#before-installing","title":"Before installing","text":"<p>The following needs to be done prior to installing Allsky the first time on your Pi:</p> <ul> <li>If this is a new Pi, you'll need to install the Raspberry Pi Operating System (OS)   on it. We recommend installing the Desktop version of Pi OS.</li> <li>Make sure your Pi has a working Internet connection  . Use a wired LAN connection if possible - it's faster and more reliable than a Wi-Fi connection. If you use Power over Ethernet (PoE)   you can run a single ethernet cable to your Pi.</li> <li>Ensure git is installed: <code>sudo apt-get install git</code></li> </ul>"},{"location":"allsky_guide/allsky.html#if-allsky-is-installed","title":"If Allsky is installed","text":"<p>If Allsky already exists on your Pi, stop it:</p> <pre><code>sudo systemctl stop allsky\ncd\n</code></pre> <p>then perform one of these steps:</p> <ul> <li> <p>To upgrade the old version and keep its settings: <code>mv  allsky  allsky-OLD</code>   During installation you will be asked if you want to use the settings from allsky-OLD. Nothing is lost with this option.</p> </li> <li> <p>To archive the old version but not use it: <code>mv  allsky  allsky-SAVED</code> Nothing is lost with this option but after installation you'll need to re-enter all your settings and the new version won't have any of your prior images, timelapses, etc. At some point you'll want to delete the allsky-SAVED directory to free up its disk space.</p> </li> <li> <p>To delete the old version - only select this option if you're sure you don't want any saved images, darks, and configuration settings: <code>rm  -fr  allsky</code> Everything is lost with this option so after installation you'll need to re-enter all your settings.</p> </li> </ul>"},{"location":"allsky_guide/allsky.html#installing-allsky","title":"Installing Allsky","text":"<p>Get the Allsky software and put it in ~/allsky. Except for some system files, all Allsky-related files reside in this directory.</p> <pre><code>cd\ngit clone  --depth=1  --recursive  https://github.com/AllskyTeam/allsky.git\n</code></pre> <p>This may take a minute and should produce output similar to what's below. The new allsky directory is approximately 150 MB after download.</p> <pre><code>Cloning into 'allsky'...\nremote: Enumerating objects: 891, done.\n...  more commands here\nReceiving objects: 100% (891/891), 46.25 MiB | 17.82 MiB/s, done.\nResolving deltas: 100% (100/100), done.\nSubmodule 'src/sunwait-src' (https://github.com/risacher/sunwait) registered for ...\nCloning into '/home/pi/allsky/src/sunwait-src'...\nremote: Enumerating objects: 119, done.\n...  more commands here\nSubmodule path 'src/sunwait-src': checked out '151d8340a748a4dac7752ebcd38983b2887f5f0c'\n</code></pre> <p>Now install Allsky:</p> <p><code>cd allsky ./install.sh</code></p> <p>The installation may prompt for several items (accepting the defaults is recommended). Upgrades produce fewer prompts.</p> <ul> <li>If the host name has never been changed you are asked to enter a new name - the default is <code>allsky</code>. If you have more than one Pi on the same network they must all have unique names. For example, if you have a test Pi you may want to call it allsky-test.</li> <li>The Locale to use. This determines what the decimal separator is in log output (period or comma). Note that the default locale is <code>en_GB.UTF-8</code> where the Pi is developed.</li> <li>Adding swap space if needed. This effectively increases the amount of memory your Pi has. Insufficient swap space is one of the leading causes of timelapse video creations problems.</li> <li>Putting the ~/allsky/tmp directory in memory instead of on the disk. This directory holds temporary Allsky files and is where most Allsky files are initially written to. Putting the directory in memory significantly reduces the number of writes to the SD card, which increases its life.</li> <li>New installations will prompt for the Latitude and Longitude to use. In most cases values based on your network's location will be displayed as defaults.</li> <li>If a reboot is needed you are asked if the Pi should be rebooted when installation completes. If you answer \"no\", note that Allsky will not start until the Pi is rebooted. The installation will notify you of any actions you need to take when the installation completes. If there are any such actions, the WebUI will display a message reminding you of those actions. Clear the message(s) when done performing the actions.</li> </ul> <p>Instalation time</p> <p>The installation may take up to an hour, depending on how many package you already have installed and the speed of your Pi. Subsequent installations of Allsky will be significantly faster.</p>"},{"location":"allsky_guide/allsky.html#post-installation","title":"Post installation","text":"<p>After installation, reboot if told to, then perform any actions the identified during installation. Allsky will not begin until you do the following:</p> <ul> <li>Bring up the WebUI by entering <code>http://allsky.local</code> or <code>http://allsky.localhost</code> in a web browser. The default username is admin and the default password is secret.</li> </ul> <p>Remote Access</p> <p>If your Pi is accessible via the Internet, change the username and password via the Change Password link on the WebUI.</p> <ul> <li>Go to the <code>Allsky Settings</code> page.</li> <li>If there's a message saying you need to configure Allsky or review the settings, do that now.</li> <li>Click on the blue button. It may look like Save Changes, or Configuration Done; Start Allsky, or something similar. Allsky will start.</li> </ul>"},{"location":"allsky_guide/allsky.html#starting-and-stopping-allsky","title":"Starting and stopping Allsky","text":"<p>Allsky starts automatically when the Raspberry Pi boots up. To enable or disable this behavior, run:</p> <pre><code>sudo systemctl enable allsky     # starts Allsky when the Pi boots up\n</code></pre> <p>#   OR</p> <pre><code>sudo systemctl disable allsky    # does NOT automatically start Allsky\n</code></pre> <p>When you want to manually start, stop, or restart Allsky, or obtain status, use one of these commands:</p> <pre><code>sudo systemctl start allsky\nsudo systemctl stop allsky\nsudo systemctl restart allsky    # a restart is the same as a stop then start\nsudo systemctl status allsky\n</code></pre> <p>TIP</p> <p>Add lines like the following to ~/.bashrc to save typing: <code>alias start='sudo systemctl start allsky'</code> You then only need to type start to start Allsky. Do this for the other commands as well.</p>"},{"location":"allsky_guide/allsky.html#troubleshooting","title":"Troubleshooting","text":"<p>Starting Allsky from the terminal is a great way to track down issues as it provides debug information to the terminal window. To start Allsky manually, run:</p> <pre><code>sudo systemctl stop allsky\ncd ~/allsky\n./allsky.sh\n</code></pre> <p>If you are using a desktop environment (Pixel, Mate, LXDE, etc.) or using remote desktop or VNC, you can add the --preview argument to show the images the program is currently saving in a separate window:</p> <pre><code>./allsky.sh --preview\n</code></pre>"},{"location":"allsky_guide/server.html","title":"Server","text":"<p>This page describes how to prepare a remote server to accept uploads of the current Allsky image as well as startrails, keograms, and timelapse videos.</p> <p>Warning</p> <p>This page is for setting up a remote server, which typically does not run an Allsky Website. If you want to set up a remote Website, click here.</p>"},{"location":"allsky_guide/server.html#why-use-a-remote-server","title":"Why use a remote server?","text":"<p>Since this server does NOT run the Allsky Website software you may wonder why have a remote server. Let's say you have a web page for an observatory that has a description of your equipment as well as some astrophotographs you've taken. If you also want to include the current allsky image as well as last night's timelapse, you'd simply set up your observatory web server to accept pictures from Allsky, then update Allsky to upload the pictures.</p>"},{"location":"allsky_guide/server.html#preparing-the-remote-server","title":"Preparing the remote server","text":"<p>The exact commands you use will depend on your server and/or hosting solution, but at a high level the steps are:</p> <ul> <li>Create the following directories on the server, making sure their names are lowercase and spelled exactly as below:  </li> <li>allsky </li> <li>allsky/videos </li> <li>allsky/videos/thumbnails </li> <li>allsky/startrails </li> <li>allsky/startrails/thumbnails </li> <li>allsky/keograms </li> <li> <p>allsky/keograms/thumbnails </p> </li> <li> <p>Go to the Remote Server Settings section of the WebUI's Allsky Settings page and fill in the settings. See the Allsky Settings   page for a description of the settings.</p> </li> </ul> <p>After enabling the Use Remote Server setting a test file will be uploaded to the server to ensure it works. If there are any problems, visit the Troubleshooting -&gt; Uploads page for details on how to fix the problem.</p>"},{"location":"allsky_guide/website.html","title":"Website","text":"<p>This page describes how to install a new Allsky Website or upgrade an existing Website.</p> <p>An Allsky Website running on your Pi is called a local Website because it is local to your Pi. An Allsky Website running on anywhere else is called a remote Website.</p>"},{"location":"allsky_guide/website.html#local-website","title":"Local Website","text":"<p>The code for a local Website is already on your Pi so getting it to work is easy:</p>"},{"location":"allsky_guide/website.html#new-allsky-installations-or-upgrades-with-no-prior-local-website","title":"New Allsky installations or upgrades with no prior local Website","text":"<p>The new local Website needs to be enabled and configured before it can be used. If you go to the Website prior to that you'll get an error message telling you what to do.</p> <ul> <li>Enable the Website by going to the <code>Allsky Settings</code> page in the WebUI and enabling the Use Local Website setting in the Websites and Remote Server Settings section. This will create a default configuration file you'll use in the next step.</li> <li>Configure the Website in the <code>Editor page</code> in the WebUI by selecting <code>configuration.json (local Allsky Website)</code>. from the drop-down. You will see one or more XX_NEED_TO_UPDATE_XX entries that need changing. Set the remaining entries to your liking.</li> </ul> <p>See the Website Settings  page for a description of the settings.</p>"},{"location":"allsky_guide/website.html#allsky-upgrades-with-an-existing-local-website","title":"Allsky Upgrades with an existing local Website","text":"<p>The Allsky upgrade will use your prior local Website configuration and automatically enable the new Website. Any existing images and videos from the prior Website will be moved to to the new Website. You are done unless the prior Website was version v2022.03.01+ or earlier, in which case you need to:</p> <ul> <li>Manually copy your prior settings from /var/www/html/allsky/config.js to configuration.json by going to the <code>Editor</code> page in the WebUI and selecting <code>configuration.json (local Allsky Website)</code>. Note that there are more settings in the new configuration file, but it should be straightforward to map settings from the old file to the new file.</li> <li>After configuring the local Website, check in /var/www/html/allsky for any files you may have manually added and store them in ~/allsky/html/allsky/myFiles.</li> <li>Save config.js somewhere in case you need it later.</li> <li>Remove the old Website: <code>rm -fr /var/www/html/allsky</code></li> </ul>"},{"location":"allsky_guide/website.html#remote-website","title":"Remote Website","text":"<p>Most people have their Pi on a home network where it's not accessible from the Internet, so they install the Allsky Website on a different machine that is accessible on the Internet.</p> <p>Prior to installing a remote Website, make sure Allsky is working on your Pi. If you will also have a local Website, get it working to your liking before enabling the remote Website so you don't have to update settings in both places.</p> <p>Do the following:</p> <ul> <li>On the remote server:<ul> <li>Create an allsky directory to hold the Website. Keep track of where on your server you created the directory - you will need that information later when you tell Allsky where to upload the images.</li> </ul> </li> <li> <p>On the Pi:</p> <ul> <li>Go to the Websites and Remote Server Settings section in the WebUI's Allsky Settings page. Update the settings in the Remote Website subsection. Do NOT enable Use Remote Website yet, but update the other settings so Allsky knows how to upload a file to the Website. The Website will be automatically enabled in the next step.</li> <li>Run cd ~/allsky; ./remoteWebsiteInstall.sh to upload the Website code and create a default remote configuration file.<ul> <li>The installation will try to upload a file to the server; If that fails it should tell you why. If not, see the Troubleshooting uploads page on how to debug the problem.</li> <li>If you previously enabled the local Allsky Website, the remote configuration file will be identical to the local one with the exception of the imageName setting which will be configured for the remote Website.</li> <li>If you want the remote configuration to differ from the local one (for example, to add a background image to the remote Website), edit the remote configuration file - see the next step.</li> </ul> </li> <li> <p>Configure the remote Website:</p> <ul> <li>In the WebUI, click on the Editor link.</li> <li>In the drop-down at the bottom of the page, select remote_configuration.json (remote Allsky Website).</li> <li>See the Settings -&gt; Allsky Website   page for details on the settings.</li> <li>A copy of the remote Website configuration file will be uploaded to the server.</li> </ul> <p>Warning</p> <p>Whenever you update the remote Website's configuration you must do so via WebUI following the steps above. Do NOT edit the configuration file directly on the remote server.</p> </li> </ul> </li> <li> <p>Your remote server is now ready.</p> </li> <li>Give your family and friends the URL to your Allsky Website so they can enjoy your images!</li> </ul>"},{"location":"allsky_guide/website.html#remote-website-requirements","title":"Remote Website Requirements","text":"<p>The remote server needs to support the following: - PHP version 7 or newer. - The <code>imagecreatefromjpeg</code> function in PHP to create thumbnails of the startrails and keogram files. If that function does not exist (which is rare), you'll see a thumbnail that says \"No thumbnail\". Everything else will still work.  - Optionally, the ffmpeg command and exec function in PHP to create thumbnails of the timelapse videos.</p> <p>Warning</p> <p>Most hosting solutions don't support those commands for security reasons. In that case, make sure Upload Timelapse Thumbnail is enabled (and Upload Mini-Timelapse Thumbnail if you are creating mini timelapses). Failure to set those variables will result in \"No thumbnail\" messages when viewing videos. Everything else will still work.</p>"},{"location":"allsky_guide/website.html#post-installation","title":"Post installation","text":"<p>Change Allsky Website Settings as desired so the Website looks and behaves like you want. Changes to both local Websites and remote Websites are done via the WebUI.</p> <p>Warning</p> <p>If you have both a local and a remote Website, they each have their own configuration file which is accessible via the WebUI's Editor page. They are NOT automatically kept in sync so if you change something, for example, the lens, you'll need to change it in both files.</p>"},{"location":"allsky_guide/overlays/extra.html","title":"Extra Data","text":""},{"location":"allsky_guide/overlays/extra.html#extra-data","title":"Extra Data","text":"<p>This section explains how you can wite data that is available for use in the overlay from yoru own scripts outside of Allsky.</p> <p>This is an advanced topic that requires an understanding of the Linux file system and how to manage files within it. The Linux Basics page should provide the understanding you need.</p> <p>As an example, assume you want to add weather data to your images. You first need to create or obtain a program that gathers that data and writes it to a file. How you obtain that file is outside the scope of this documentation, but the program needs to write the data in a specific format in a file called ``~/allsky/tmp/extra/xxxxx``` (replace the xxxxx with an appropriate name).</p> <p>The \"extra\" file can be either a simple .txt file or preferably a .json file since it provides much more flexibility. You can have multiple \"extra\" files with different names; this can be useful if you want to add different types of data to the overlay, and each type has its own program to gather the data. A typical example is weather data and dew heater status.</p> <p>Dates</p> <p>When adding dates to any extra data files please ensure that the date is formatted in the same format as the Time Format setting in WebUI</p>"},{"location":"allsky_guide/overlays/extra.html#text-files","title":"Text Files","text":"<p>Text files must end with a .txt extension. The format is a simple name=value pair structure, with anything after the = being the value, as shown below:</p> Line in File Resulting Variable AG_TEMP=14.3 ${AG_TEMP} AG_LOCATION=South Pole ${AG_LOCATION} AG_HUMIDITY=67.2 ${AG_HUMIDITY} <p>The data in these files could become old if the application creating them fails or is not running. To have Allsky detect this you tell it to ignore \"extra\" files when they are over a certain age. For .txt files there is a single value which is specified in the Overlay Editor settings dialog box. See the next section for how to specify the expiration time for .json files.</p>"},{"location":"allsky_guide/overlays/extra.html#json-files","title":"JSON Files","text":"<p>.json files are more complex in their structure but provide a lot more flexibility to add your own variables and even control the attributes of a field.</p> <p>The .json file below will produce exactly the same variables as the .txt file described above. The data will expire as defined in the Overlay Editor settings dialog box.</p> <pre><code>{\n  \"AG_TEMP\": {\n    \"value\": \"14.3\"\n  },\n  \"AG_LOCATION\": {\n    \"value\": \"South Pole\",\n  },\n  \"AG_HUMIDITY\": {\n    \"value\": \"67.2\",\n  }\n}\n</code></pre> <p>This .json file includes an expiry time (in seconds) for the temperature and humidity, which change often, so those times will be used. The location doesn't specify an expiry time since the location never changes, so the one in the Overlay Editor dialog expiry setting will be used.</p> <pre><code>{\n  \"AG_TEMP\": {\n    \"value\": \"14.3\",\n    \"expires\": 600\n  },\n  \"AG_LOCATION\": {\n    \"value\": \"South Pole\",\n  },\n  \"AG_HUMIDITY\": {\n    \"value\": \"67.2\",\n    \"expires\": 600,\n  }\n}\n</code></pre> <p>A note on the expires field:</p> <ul> <li> <p>Instead of specifying an expiry time on two variables and not the third one as shown above, you could instead specify a value for the third field and use the Overlay Editor default expiry setting for the other two. This works well if you only have one \"extra\" file.</p> </li> <li> <p>If you have multiple \"extra\" files it's probably best to specify an expiry time for ALL fields in all files, rather than using the Overlay Editor default expiry setting for fields that don't explicity set one. If a field shouldn't have an expiry time, use \"expires\": 0, which disables its expiry time.</p> </li> </ul> <p>This .json file, which has been truncated for brevity, includes all of the attributes that a field can set. It also adds an image.</p> <pre><code>{\n  \"AG_TEMP\": {\n    \"value\": \"14.3\",\n    \"format\": \"{:.0f}\",\n    \"x\": 800,\n    \"y\": 200,\n    \"fill\": \"#333333\",\n    \"font\": \"ledsled\",\n    \"fontsize\": 40,\n    \"opacity\": 0.2,\n    \"stroke\": \"#000000\",\n    \"strokewidth\": 1\n  },\n  \"AG_SCOPE\": {\n    \"image\": \"crosshair.png\",\n    \"x\": 300,\n    \"y\": 400,\n    \"scale\": 0.1,\n    \"expires\": 6000,\n    \"opacity\": 0.5\n  }\n}\n</code></pre> <p>This example demonstrates some important points:</p> <ul> <li> <p>The attributes of a variable can be used to control how the variable appears, so for example if the temperature is close to the dew point then some text could be displayed in a highlighted colour. Note that this makes the variable a 'Field' and can only be used where a single variable is used within a field.</p> </li> <li> <p>Images can by dynamically added to the captured image. So if you wanted to control when an image is added or not added, the program that creates the \"extra\" file can simply add the image's json code, or not add it, to the file.</p> </li> </ul> <p>The \"extra\" files must be created by an application you provide and there are a few things to consider when creating these files:</p> <ul> <li> <p>Variable names must be prefixed with a string that's unique to you, e.g., your initials, to avoid conflicting with the names of Allsky variables. The variables in the examples above are prefixed with <code>AG_</code>. You can use anything except <code>AS_</code> and <code>ALLSKY_</code>.</p> </li> <li> <p>Variable values should generally not include units of measure. For example <code>${DOME_TEMPERATURE}</code> should be <code>20.72</code>, not <code>20.72\u00b0 C</code> because <code>20.72</code> is a \"Numeric\" variable that can be formated (e.g., to <code>20.7</code>) whereas <code>20.72\u00b0 C</code> is a \"Text\" string that can't be formatted. If you want <code>\u00b0 C</code> to appear on the overlay, add it in the field itself: <code>Dome temperature: ${DOME_TEMPERATURE}&amp;deg; C</code>. Note that \u00b0 adds the degree symbol \u00b0. Or use the formatting system within the overlay editor to set the format</p> </li> <li> <p>Permissions You must ensure that the \"extra\" files can be read by the web server. Adding <code>chmod 644 file</code> ... to the programs that create the files should suffice. The Overlay Module will silently ignore any files it cannot read.</p> </li> </ul>"},{"location":"allsky_guide/overlays/fieldsandvariables.html","title":"Fields And Variables","text":""},{"location":"allsky_guide/overlays/fieldsandvariables.html#fields-and-variables","title":"Fields and Variables","text":"<p>Fields are the heart of the Overlay Editor. They are distinct items that are added to an overlay and each field has its own properties like color, size, rotation, etc. Most people have several fields on their overlays - date and time the image was taken, the exposure length, etc.</p> <p>Variables are parts of a field whose value is determined when an image is saved. A common variable is ${TIME} which is replaced by the time the image was taken and changes every image. Some variables rarely or never change, for example ${CAMERA_MODEL} displays the model of the camera used to take the image, like \"HQ\" or \"ASI290MM\". It only changes if you change cameras. See the Variable names section for details on variable names.</p> <p>There are two types of fields:</p> <ul> <li>Text fields contain text and/or variables, for example, Exposure: ${sEXPOSURE}, which adds the word Exposure: followed by the image's exposure time to the overlay.</li> <li>Image fields contain pictures, graphics, or any image you want and are often used are logos, weather graphs, and compasses.</li> </ul>"},{"location":"allsky_guide/overlays/fieldsandvariables.html#variable-names","title":"Variable Names","text":"<ul> <li>Must begin with a letter a - z or A - Z.  </li> <li>The remaining characters may contain any number of letters, number 0 - 9, or the underscore character _.  </li> <li>Should be prefixed with a string that's unique to you like your initials, to avoid conflicting with the names of Allsky system variables. This prefix can be anything except AS_ and ALLSKY_, which are reserved for the Allsky development team.  </li> <li>Should make sense to you. You are more likely to remember what ${MY_AMBIENT_TEMP} means than ${MY_AT}.  </li> <li>By convention are UPPERCASE, but you can mix case, however, variable names are case-sensitive, so ${MY_ABIENT_TEMP} and ${MY_ABIENT_temp} are different variables.  </li> </ul> <p>If you see a variable displayed on the overlay as ??? it usually means the variable is undefined - either it's not in the Variable Manager at all (could be a typo), or is only in the All Variables tab. The variable needs to be defined and copied to the Allsky Variables tab. Undefined variables will have a line in <code>/var/log/allsky.log</code> like: <code>ERROR: ${T2} has no variable type.</code></p> <p>If a variable is displayed as ?? it usually means the variable's formatting is incorrect, for example, you tried to display a number as a date. Make sure the formatting is valid for the type of variable - click on the [?] icon to see valid formats for each type of variable. Incorrectly formatted variables will have a line in <code>/var/log/allsky.log</code> like: ERROR: Cannot use format '%a' on Number variables like ${GAIN}.</p>"},{"location":"allsky_guide/overlays/fieldsandvariables.html#example-text-fields","title":"Example text fields","text":"Field Example Output Description ${DATE} 24/10/2025 Displays the date from the DATE system variable. The date can be formatted in a variety of ways. This example field contains only a variable. Date: ${DATE} Date: 24/10/2025 Displays the text \"Date: \" then the date the image was taken from the DATE system variable. As above, the date can be formatted in a variety of ways. This field contains text and a variable. Date: ${DATE} ${TIME} Date: 24/10/2025 23:12:34 Displays the date and time the image was taken from the DATE and TIME system variables, respectively. Both variables can be formatted in a variety of ways.This field contains text and two variables. You can have any number of variables you want. Date: DATE TIME Date: DATE TIME Because this field doesn't have any variables, it simply displays \"Date: DATE TIME\". This field contains only text. <p>Variables come from a variety of sources:</p> <p>Allsky - The main Allsky application generates many variables. Modules - Any module can create variables. Extra Data - Typically created by an application external to Allsky.  </p>"},{"location":"allsky_guide/overlays/fieldsandvariables.html#allsky-variables","title":"Allsky Variables","text":"<p>The table below shows the most commonly used Allsky variables; a complete list can be found in the Variable Manager.</p> Variable Example Data Description ${DATE} 20250228 The date the image was taken. ${TIME} 221623 The time the image was taken. ${GAIN} 4.692540 The gain used for the image. If auto-gain was disabled, this value will be what you set in the Gain setting in the WebUI, otherwise it's the value the auto-gain algorithm used. ${AUTOGAIN} 1 1 if auto-gain was enabled, 0 if disabled. Taken from the Auto-Gain WebUI setting. ${sAUTOGAIN} (auto) A string containing either (auto) if auto-gain was enabled, or blank. Useful to put after the gain, e.g., Gain: ${GAIN} ${sAUTOGAIN}. ${EXPOSURE_US} 218000 The exposure of the image in micro seconds. If auto-exposure was disabled, this value will be what you set in the Manual Exposure setting in the WebUI, otherwise it's the ${sEXPOSURE} 218 ms (0.2 sec) The exposure of the image in a human readable format. The format changes depending on the exposure time, for example, very short exposures may be 218.48 ms (0.2 sec) whereas a long exposure may be 45.3 sec. ${AUTOEXPOSURE} 1 1 if auto-exposure was enabled, 0 if auto-exposure was disabled. Taken from the Auto-Exposure WebUI setting. ${sAUTOEXPOSURE} (auto) A string containing either (auto) or blank - similar to ${sAUTOGAIN}. ${TEMPERATURE_C} and ${TEMPERATURE_F} 36 The temperature of the camera sensor, if available. This does NOT include the C or F for Centigrade or Fahrenheit so you'll need to add them yourself, e.g., Sensor Temp: ${TEMPERATURE_C} C. ${MEAN} 0.108564 The mean brightness value for the image, from 0.0 (pure black) to 1.0 (pure white)."},{"location":"allsky_guide/overlays/fieldsandvariables.html#module-variables","title":"Module Variables","text":"<p>Any module can create variables for use in the Overlay Module. For this reason it's important that the Overlay Module runs as late as possible within the module flow. As an example, the Star Count Module creates a variable called ${STARCOUNT} and passes it to the next module.</p> <p>Please refer to the documentation on each module for the variables they make available.</p>"},{"location":"allsky_guide/overlays/formatting.html","title":"Formatting Variables","text":""},{"location":"allsky_guide/overlays/formatting.html#formatting-fields","title":"Formatting Fields","text":"<p>All data within Allsky is stored in consistent internal formats, so for example ALL temeopratures are stored in Degreed Centigrade. Yo will therfore probably want to format data to improve its visual appearance, typicall formatting options are</p> <ul> <li>Changing Unit i.e. Degreed Centigrade to Degrees Farenhite</li> <li>Setting the number of decimal places</li> <li>Converting an internal format, i.e. decimal degrees to DDD MM SS</li> </ul> <p>Each variable within Allsky has a default format but you can override this. To overide a variables format double click on the field containing the variable then click on the ? button at the end of the format field</p> <p></p> <p>The Variable Format Dialog</p> <p>In this example we have double clicked the 'AS-SUN_DAWN' field and then clicked on the ? (1). The resultignm dialog displays all of the formatting options available for the variable, in this case data formats.</p> <p>Simply select the format you required and save the overlay.</p>"},{"location":"allsky_guide/overlays/formatting.html#common-formats","title":"Common Formats","text":"<p>NOTE: Some formats will display legacy formatting options. These mUST NOT be used for formatting fields and are present for backwards compatibility only</p> <p>Please Note The lists below are not exhaustive and may change from release to release. Please refer to the Formatting Dialog for available options</p>"},{"location":"allsky_guide/overlays/formatting.html#date-formats","title":"Date Formats","text":"<p>This allows dates to be formatted in a number of ways. A custom date formatter is provided allowing you to format a date in any way you like</p> Format Description Example Default date Use default data attributes - see Sample --&gt; 25-12-23 23:20 %d-%m-%y %H:%M Short date/time (UK format) 25-12-23 23:20 %m-%d-%Y %I:%M %p Short date/time (US format) 12-25-2023 11:20 AM %d-%m-%y Short date (UK format) 25-12-23 %m-%d-%y Short date (US format) 12-25-23 %d-%m-%y %H:%m Short date and time (UK format) 25-12-23 23:10 %m-%d-%y %H:%m Short date and time (US format) 12-25-23 23:10 Custom date Custom date format N/A"},{"location":"allsky_guide/overlays/formatting.html#number-formats","title":"Number Formats","text":"<p>This allows numbers ot be formatted, setting decimal places etc</p> Format Description Example Custom number Displays the number format dialog N/A <p></p> <p>The Number Format Dialog</p>"},{"location":"allsky_guide/overlays/formatting.html#boolean-formats","title":"Boolean Formats","text":"<p>This allows boolean values to be displayed in a more Human Readable format</p> Format Description Example yesno Output 'Yes' if input is 1, or 'No' Yes, No onoff Output 'On' if input is 1, or 'Off' On, Off truefalse Output 'True' if input is 1, of 'False' True, False num Output '1' if input is 1, or '0' 1, 0"},{"location":"allsky_guide/overlays/formatting.html#elevation-formats","title":"Elevation Formats","text":"<p>This allows an elevation value to be displayed in a Human Readable format</p> Format Description Example Custom elevation Elevation with decimal places and degree symbol 52.12 \u00b0"},{"location":"allsky_guide/overlays/formatting.html#azimuth-formats","title":"Azimuth Formats","text":"<p>This allows an azimuth value to be displayed in a Human Readable format</p> Format Description Example Custom azimuth Azimuth with decimal places and degree symbol 52.12 dms Display azimuth with Degrees, Minutes, and Seconds 123"},{"location":"allsky_guide/overlays/formatting.html#filesize-formats","title":"Filesize Formats","text":"<p>This allows an filesize value to be displayed in a Human Readable format</p> Format Description Example Auto filesize The most appropriate unit will be displayed (GB, etc.) 12 GB Custom filesize Filesize with decimal places and units (GB, MB, etc.) 12 TB"},{"location":"allsky_guide/overlays/formatting.html#filesize-formats_1","title":"Filesize Formats","text":"<p>This allows an filesize value to be displayed in a Human Readable format, converting between units if required</p> Format Description Example Default temperature Use default temperature attributes - see Sample --&gt; 23.5\u00b0 C Custom temperature Customize variable attributes 23,54\u00b0 C"},{"location":"allsky_guide/overlays/formatting.html#gpio-formats","title":"GPIO Formats","text":"<p>This allows the state of a GPIO pin to be displayed in a more Human Readable format</p> Format Description Example onoff Show as On or Off On yesno Show as Yes or No Yes truefalse Show as True or False False num Show as 1 or 0 0"},{"location":"allsky_guide/overlays/formatting.html#string-formats","title":"String Formats","text":"<p>This allows strings to be formatted in a a variety of ways</p> Format Description Example none No change to the string N/A upper Convert string to UPPER CASE HELLO, WORLD! lower Convert string to lower case hello, world! camel Convert string to camelCase hello, World! capitalize Capitalize the string Hello, World! sentence Capitalize the string, removing leading and trailing spaces Hello, World!"},{"location":"allsky_guide/overlays/formatting.html#altitude-formats","title":"Altitude Formats","text":"<p>This converts an altitude to a Flight level</p> Format Description Example flightlevel Convert altitude in metres to flight level FL020"},{"location":"allsky_guide/overlays/formatting.html#distance-formats","title":"Distance Formats","text":"<p>Converts distance between Units</p> Format Description Allsky internal Allsky internal distance (miles) mtok Miles to Kilometres ktom Kilometres to Miles"},{"location":"allsky_guide/overlays/how.html","title":"How They Work","text":""},{"location":"allsky_guide/overlays/how.html#how-they-work","title":"How They Work","text":"<p>The Overlay Editor, which is accessed via the Overlay Editor WebUI page, is used to define what information you want on the captured images and where it should go. Once you have specified that information, you won't use the editor again until you want to change something in the overlay, which typically isn't done very often.</p> <p>The Overlay Module program is invoked every time an image is captured and places the information you specified in the Overlay Editor onto the image. This module is one of several modules   that can be invoked after every image is captured.</p> <p>In the Overlay Editor you specify what information you want to go where, and what it should look like. For example, you want the date and time the image was taken to be in blue, 12 point font in the upper left of the image and a compass rotated 20 degrees so it's pointing north in the upper right of the image. You also have a graph of weather information you want on the bottom of the image, but because it will hide some of the image you want it to be partially transparent.</p> <p>After Allsky captures an image it passes that image as well as information about the image to the Overlay Module, including the time the image was taken, the exposure length, the gain, and a lot more. This information is put into System Variables that can be used per you configuration in the Overlay Editor, which then:</p> <ul> <li>Replaces the system variables with their values and adds them to the overlay.  </li> <li>Replaces any other variables with their values and adds them to the overlay.  </li> <li>Adds any images you specified to the overlay.  </li> </ul>"},{"location":"allsky_guide/overlays/interface.html","title":"Interface","text":""},{"location":"allsky_guide/overlays/interface.html#editor-interface","title":"Editor Interface","text":"<p>The Overlay Editor web page consists of two key areas:</p> <ul> <li>The toolbar contains icons that perform actions or bring up dialog boxes.  </li> <li>The working area contains the overlay and the current image in the background.</li> </ul> <p>NOTE: The Overlay Editor will only start if Allsky is capturing images. If Allsky is not capturing a warning is displayed and the Overlay Editor will wait until Allsky start capturing.</p> <p>New fields are initially added to the upper left corner of the overlay but can be moved anywhere you want - just drag and drop! If you added a field by mistake, delete it by clicking on the  icon (4) before doing anything else.</p> <p></p> <p>The Overlay Editor toolbar</p> Number Function Description 1 Save The Current Configuration This is enabled and turns green when any changes have been made that require saving. The word \"Modified\" is also appended to the tab label, i.e., \"Overlay Editor - Modified\". 2 Add New Text Field Click to add a new field with text and/or variables to the overlay, including adding a variable 3 Add New Image Field Click to add an existing image to the overlay. The image must have previously been uploaded using the Image Manager. 4 Delete selcted field Click to delete the selected field. The \"del\" or \"delete\" keys on the keyboard can also be used. The icon is only enable turns green when a field is selected. 5 Variable manager Click to add a pre-defined field from the Variable Manager. See the Variable Manager section for more details. 6 Preview Click to preview each of the fields. This is useful to see what actual data will look like on the overlay so you can better align fields. 7 Group Fields Groups the selected fields 8 Un Group Fields Ungroups the selected group 9 Left Align Lest aligns the selected fields 10 Equal Vertical Space Equally distributes the selected fields between the first and last selected fields 11 Equal Horizontal Space Equally distributes the selected fields between the first and last selected fields 12 Zoom In Zooms into the overlay 13 Zoom Out Zooms out of the overlay 14 Full Size Views the overlay at full resolution 15 Fit Fits the overlay into the screen 16 Overlay Manager Displays the Overlay Manager 17 Overlay Errors Only displayed if any fields are detected that are off the screen. Selecting this icon will display the Overlay Errors dialog allowing the off-screen fields to be deleted or fixed. Fixing the field will move it into the visible portion of the overlay editor allowing you to move it to the exact position required. 18 Font Manageer Displays the Font Manager 19 Image Manager Displays the Image Manager 20 Settings Displays the Overlay Settings 21 Help Displays the overlay manager help"},{"location":"allsky_guide/overlays/interface.html#keyboardmouse","title":"Keyboard/Mouse","text":"<p>There are various keyboard and mouse shortcuts used by the overlay manager</p> <ul> <li>The Del or Delete key will delete a field if one is selected  </li> <li>A single mouse click will select the field</li> <li>Double clikcing a field will display its properties</li> <li>Once the properties window is visible clicking a field will switch to that fields properties</li> <li>Clicking the mouse and dragging around fields will select all of the fields</li> <li>Holding the alt key and dragging will draw a rectange</li> </ul>"},{"location":"allsky_guide/overlays/interface.html#variable-manager","title":"Variable Manager","text":"<p>The variable manager allows you to select variables and add them to overlays as a field. I also allows block of fields to be added</p> <p></p> <p>The Variable Manager Dialog</p> <ol> <li>Allows the columns displayed in the variable manager to be selected</li> <li>The available variables that can be added</li> <li>Display all variables, by default oly variables with a value are displayed</li> </ol> <p>To add a variable either double click it or single click it and click the 'Select' button</p> <p></p> <p>The Variable Manager Blocks Dialog</p> <p>This dialog allows blocks to be added to the overlay, blocks are a collection of fields in a predefined layout. </p> <ol> <li>Select he font details for the block. NOTE This must be selected BEFORE adding the block</li> <li>Click the add button to add the block</li> </ol>"},{"location":"allsky_guide/overlays/interface.html#overlay-manager","title":"Overlay Manager","text":"<p>The Overlay Manager is used to create and enable overlays for day and nighttime capture.</p> <p></p> <p>The Overlay Manager</p> <p>The Overlay Manager comes pre installed with several overlays for common cameras. The Allsky team maintain these overlays. During installation the most appropriate overlay for your camera will have been selected, the Overlay Manager allows you to use these overlays or create a new one.</p> <p>The Allsky maintained overlays cannot be edited, you must create a new overlay if you wish to edit it. The new overlay can be copied from any exising overlay.</p> <p>During an upgrade from a previous version of Allsky the Module Manager will attempt to convert any of your customised overlays into the module manager format.</p>"},{"location":"allsky_guide/overlays/interface.html#main-tab","title":"Main Tab","text":"<p>Field Details</p> <ol> <li>Selects the main overlay manager tab</li> <li>Displays the tab to allow overlays to be activated</li> <li>Selects the overlay to display/edit. When selecting an overlay the overlay will be displayed in the main overlay editor. If you select an overlay that cannot be edited then a warning is displayed in the main overlay editor.</li> <li>Adds a new overlay</li> <li>Deletes an overlay. NOTE: Allsky maintained overlays cannot be deleted</li> <li>The name of the overlay, this is used to identify the overlay in a human readable format</li> <li>The name of the overlay description</li> <li>The camera brand the overlay applies to</li> <li>The camera model the overlay applies to</li> <li>The width of the captured image, after any cropping</li> <li>The height of the captured image, after any cropping</li> <li>The Time of Day the overlay should be used for</li> </ol> <p>When making any changes in the overlay meta data section you must use the main save button on the Overlay Editor toolbar, this will be highlighted in green if there are any changes to save</p>"},{"location":"allsky_guide/overlays/interface.html#options-tab","title":"Options Tab","text":"<p>Field Details</p> <ol> <li>Selects the overlay to use when capturing daytime images</li> <li>Selects the overlay to use when capturing nightime images</li> </ol>"},{"location":"allsky_guide/overlays/interface.html#selecting-overlays","title":"Selecting Overlays","text":"<p>To select the overlays to use for day or night open the Overlay Manager and switch to the Options Tab. Here you can select the appropriate overlay to use.</p> <p>Overlays can be limited to daytime, nighttime capture or both. Only the available overlays for day / nighttime capture will be displayed in the drop downs</p>"},{"location":"allsky_guide/overlays/interface.html#create-new-overlay","title":"Create New Overlay","text":"<p>To create a new overlay click the + icon (4). A new dialog will be displayed allowing you to create the new overlay.</p> <p></p> <p>Add new overlay main tab</p> <ol> <li>Selects the overlay you wish to use as a starting point or select 'Blank Overlay' for an empty overlay</li> <li>Enter a Human Readable name for the overlay</li> <li>Enter a Human Readable name for the overlay</li> <li>Select the time of day you wish this overlay to be used in</li> <li>If selected then the overlay will be activated after it has been created. If not selected the overlay will be saved as a draft and you will have to manually activate it.</li> </ol> <p>By default when an overlay is created it is activated for day/night or both as defined by the 'Available For' dropdown. If you DO NOT want the overlay to be activated by default then select 'No' in the 'Activate After Creation' option.</p> <p></p> <p>Add new overlay advanced tab</p> <p>You will only need to make changes on this tab if you are creating an empty overlay. If you are copying an existing overlay then all of the fields will be defaulted from the copied overlay.</p> <ol> <li>This is for information only and is the filename of the overlay that will be used to store it on the Pi</li> <li>The camera brand the overlay applies to</li> <li>The camera model the overlay applies to</li> <li>The width of image the overlay applies to. This will default to the width of the last captured image</li> <li>The height of image the overlay applies to. This will default to the width of the last captured image</li> </ol> <p>Once you have completed the required fields in the dialog select the 'Ok' button and the new overlay will be displayed allowing you to edit it.</p>"},{"location":"allsky_guide/overlays/interface.html#delete-overlay","title":"Delete Overlay","text":"<p>To delete an overlay select the required overlay and click the delete buttton.</p> <p>NOTE: You cannot delete an overlay if it is currenty active. You must activate another overlay before deleting it.</p>"},{"location":"allsky_guide/overlays/interface.html#overlay-errors","title":"Overlay Errors","text":""},{"location":"allsky_guide/overlays/interface.html#font-manager","title":"Font Manager","text":"<p>The Font Manager allows you to manage fonts used in overlays. It supports all mainstream browser fonts and allows you to upload any TrueType font for use in text fields. You only need to use the Font Manager if you intend to use any non built in fonts.</p> <p>In version 2024.12.06_06 and before you were required to add fonts to the overlay in the Fonat Manager before they could be used. This is no longer a requirement and the fonts used in an overlay are automatically managed</p> <p></p> <p>The Font Manager Dialog</p> <ol> <li>Lists all the fonts that can be used. System Fonts are marked as such in the Path column.</li> <li>Deletes a font.</li> <li>Adds a font from daFont.com by entering a URL. See below.</li> <li>Uploads a zip file to install fonts. See below.</li> </ol> <ul> <li>It is not possible to delete a System Font and they will not have a delete icon as shown for the first several fonts above.</li> <li>If a font is in use when deleted then any fields using the font will revert to the default font as specified in the overlay settings.</li> </ul>"},{"location":"allsky_guide/overlays/interface.html#font-preview","title":"Font Preview","text":"<p>The Font Preview dialog allows you to preview any installed font, including system fonts.</p> <p></p> <p>The Font Manager Preview Dialog</p> <ol> <li>Selects the font you wish to preview</li> <li>Select the font size for the preview</li> <li>Enter some text to preview</li> <li>The previewd text</li> </ol>"},{"location":"allsky_guide/overlays/interface.html#image-manager","title":"Image Manager","text":"<p>The Image Manager allows you to upload images for use on overlays and create masks for certain functions such as star and meteor detection. Allsky comes with several basic images.</p> <p></p> <p>The Image Manager Dialog</p> <ol> <li>Adds the selected image to the overlay</li> <li>Deleted the selected image</li> <li>The image library</li> <li>Area to drop images onto to upload them, clicking this area will present an upload dialog</li> <li>Starte the Mask Editor</li> </ol>"},{"location":"allsky_guide/overlays/interface.html#the-mask-editor","title":"The Mask Editor","text":"<p>Some modules with Allsky benefit from having a mask applied to them prior to running the module. The Starcount module us a good example of this. To prevent false positives a mask is applied that removes the areas of the image you are not interested in counting stars in.</p> <p>Masks can also be used to mask out areas outside of the image circle thay mak have light leaks. This give syou a nice dark area to place th eoverlays on.</p> <p>Masks consist of two colours</p> <ul> <li>Black - Any black areas will be masked out of the image i.e. set to black</li> <li>White - Any white areas will be preserved</li> </ul> <p>For more complex masks its possible to blend the black to white transisiotn in the mask to prevent false positives in modules that may be looking for edges such as the Meteor detection module.</p> <p>The Mask Editor has two modes, Easy and Expert, the default is Easy mode. In Easy mode all you do is draw a white ellipse to capture the areas you wish to keep, when you ssave the mask the bacl areas will be automatically added. In Expert mode you have a series of drawing tools you can use to create much more detailed masks including blended edges on shapes to help with false positives on edge detection.</p> <p></p> <p>The Mask Editor Dialog</p> <ol> <li>Start creating a new mask</li> <li>Switch between easy and export mode</li> <li>In Expert mode select the type of drawing tool to use</li> <li>Undo and Redo buttons</li> <li>Sets the opactity of the mask being created, useful for fine details work where you need to see thru the mask</li> <li>Set the brightnedd of the background image</li> <li>For the brush tool set the thickness of the brush</li> <li>Zoom controls</li> </ol> <p>Once you are happy with the mask click the 'Save' button and you will be prompted to give the mask a name and it will then be saved. There are a few rules around names</p> <ol> <li>The name must be unique to all other images</li> <li>Do not use spaces in the name</li> </ol>"},{"location":"allsky_guide/overlays/interface.html#overlay-settings","title":"Overlay Settings","text":"<p>The overlay Editor has three tabs for settings</p> <ul> <li>Overlay Settings Settings that affect new fields added to an Overlay</li> <li>Editor Settings Settings that apply the the Overlay Editor</li> <li>Overlays - Available overlays to edit</li> </ul> <p></p> <p>The Overlay Settings</p> <ol> <li>The default opacity for new images.</li> <li>The default rotation for new images.</li> <li>The default font for new text fields.</li> <li>The default font size for new text fields.</li> <li>The default font opacity for new text fields.</li> <li>The default font color for new text fields.</li> <li>The default rotation for new text fields.</li> <li>The default colour used for the font stroke.</li> <li>The default expiration time in seconds for \"extra\" data files that do not specify an expiry time. This applies to all variables in .txt files and entries in .json files that don't have an \"expires\" attribute.</li> <li>The default text used when a field has expired.</li> </ol> <p></p> <p>The Overlay Editor Settings</p> <ol> <li>When enabled, displays a grid for easier alignment of fields on the overlay. The grid is used to 'snap' fields making their placement easier.</li> <li>The size of the grid in pixels. NOTE Changing the grid size on an existin glayout will not adjust any fields</li> <li>The colour to use for the grid.</li> <li>The grid brightness. Values range from 0 (lowest brightness) to 100 (brightest).</li> <li>When enabled, moving a field will cause a rectangle to be displayed showing where the field will snap to if dropped.</li> <li>The number of variables to show per page in the Variable Manager.</li> <li>When adding a new field all other fields will be set to this brightness to make the new field easier to see. Values range from 0 (darkest) to 100 (each field's full brightness).</li> <li>When selecting a field all other fields will be set to this opacity to make the new field easier to see. Values range from 0 (darkest) to 100 (each field's full brightness).</li> <li>When enabled, scrolling the mouse wheel will zoom the overlay.</li> <li>Brightness of the captured image being overlayed. Lower this if the captured image is bright to make it easier to see the overlay fields. Values range from 0 (black background) to 100 (full brightness of captured image).</li> </ol> <pre><code>When changing the brightness settings you may need to click somewhere in the overlay in order for the change to take affect.\n</code></pre> <p></p> <p>The Overlay Editor Overlays</p> <ol> <li>Displays a table showing all of the overlays available.</li> <li>This icon is displayed when the overlay is not editable, these are overlays provided by the Allsky team. Clicking the button will view the overlay but not allow it to be edited</li> <li>This icon is displayed when the overlay is editable. Clicking the button will view the overlay and allow it to be edited</li> </ol>"},{"location":"allsky_guide/overlays/overview.html","title":"Overview","text":"<p>An overlay is information that is added, i.e., overlayed, on top of each captured Allsky image. This often includes the time the image was taken, the sensor temperature, and the exposure length, but can include any other text or images you want.</p>"},{"location":"allsky_guide/overlays/overview.html#tldr","title":"TL;DR","text":"<ul> <li> <p> Yes, there are detailed instructions for the Overlay Manager\u2026 but if you\u2019d rather skip the homework and start clicking buttons like a caffeinated raccoon, go right ahead. It\u2019s surprisingly hard to break anything.</p> <ul> <li>Click the Variable Manager to add data to the overlay</li> <li>Click the Image icon to add an image (use the Image Manager to upload new images)</li> <li>Click a field to set its properties (font, size, etc.)</li> <li>Click the Preview button to preview the overlay \u2014 Allsky must be running</li> <li>Click and drag to select fields. Once selected:<ul> <li>Click the Group button to group fields</li> <li>Click the Left Align button to align the fields</li> </ul> </li> </ul> </li> </ul>"},{"location":"allsky_guide/overlays/overview.html#features","title":"Features","text":"<p>Almost any information can be added to a captured Allsky image. Some of the key features of Allsky's overlays include:</p> <ul> <li>Overlay Editor - this is the web page for creating and managing overlays and supports:  <ul> <li>Drag and Drop interface - Fields can be dragged around the screen to position them.  </li> <li>Customisable Interface - The Overlay Editor user interface can be highly customised.  </li> <li>Overlay Manager - Allows multiple overlays to be created and used in daytime / nighttime capture.  </li> <li>Font Manager - You can upload any TrueType font and use it in the overlays or use any font already on your Pi.  </li> <li>Variable Manager - Provides a library of fields that you can add to the image. You can also add your own fields.  </li> <li>Image Manager - Allows you to upload and manage images you wish to add to the image.  </li> <li>Blocks - Allows groups of fields to be added using a template  </li> <li>Field Grouping - Fields can be groupd to make moving and alignment easier  </li> <li>Field Alignment - Fields can be left aligned, spaced equally etc</li> </ul> </li> <li>Text Fields - This allows text to be added to the image. Key features include:  <ul> <li>Ability to add any data from Allsky to the image  </li> <li>Ability to add custom (extra) data to the image  </li> <li>Any TrueType font can be used  </li> <li>Text can be any colour or size  </li> <li>Text can be rotated  </li> </ul> </li> <li>Image Fields - This allows images to be added to the image:  <ul> <li>Any image can be uploaded  </li> <li>Images can be scaled and rotated and their opacity changed  </li> </ul> </li> <li>Shapes <ul> <li>Rectangles - You can draw on the overlay with a fill, border and transparency. This can be used to help highlight groupd of fields</li> </ul> </li> </ul>"},{"location":"allsky_guide/overlays/sunmoon.html","title":"Sun and Moon","text":"<p>In version v2024.12.06_06 and before there Overlay Manager allowed for the calculation of Solar System objects such as</p> <ul> <li>The Sun</li> <li>The Moon</li> <li>The Planets</li> <li>Any satellites you configure</li> </ul> <p>This functionality has moved to the Allsky Solar System module. </p>"},{"location":"allsky_guide/overlays/tips.html","title":"Tips","text":""},{"location":"allsky_guide/overlays/tips.html#best-practice","title":"Best Practice","text":"<p>Create separate overlys for day and night</p> <p>A lot of varibles make no sense in the daytime, for example a starcount. To make the overlays clearer in both daytime and nighttime create an overlay for each only displayng the required data.</p> <p>Use separate labels and variables.</p> <p>Whilst you can combine the label and variable into a single field this can make the layout of the overlay tricky. Since you can group and align fields its better to create to fields for each value you wish to display. One for the label and one for the value</p> <p>Group fields</p> <p>To make managing the overlay easy group logic filds together, this will make moving them far easier.</p> <p>Test The Overla</p> <p>Use the Preview option to check that the data is formatted as you expect</p> <p>Be Sinsible With Fonts</p> <p>Use fonts sparingly. Try to keep to a consisten font and use different weights of the same font for headings and data</p> <p>Ensure Images Are Optimised</p> <p>When uploading images ensure they are sized correctly. Whilst you can resize on image in the overlay you should not rely on this to reize very large images. Ading very large images to an overlay will significantly slow down the generation of the overlay</p>"},{"location":"allsky_guide/settings/allsky.html","title":"Allsky","text":"<p>After you install Allsky for the first time there are many settings you must modify via the WebUI's Allsky Settings page. If you are upgrading from a recent prior release those settings can optionally be brought to the new release. Settings that change the look and feel of an Allsky Website are described here  .</p> <p>The list of settings available in the WebUI depends on your camera model; settings specific to a camera type (e.g., RPi or ZWO) are indicated as such in the table below. Where appropriate, the WebUI displays the minimum, maximum, and default values when you hover over a value, and only displays settings the camera supports, like cooler temperature for cooled cameras.</p> <p></p> <p>The Allsky Settings Page</p> <p>AllskySettings</p> <p>Legend</p> <ul> <li>CD indicates the setting's default is Camera Dependent and is displayed in the WebUI by hovering your cursor over the value.</li> <li>AW indicates a setting who's value is uploaded to your Allsky Website(s) when changed.</li> </ul> WebUI Setting Default Description Daytime Settings Daytime Capture Yes Enable to capture images during the day. Daytime Save AW No Enable to save images during the day (they are always saved at night).             Only applies if Daytime Capture is enabled.           Auto-Exposure Yes Turns on/off Auto-Exposure, which delivers properly exposed images even if             the overall brightness of the sky changes due to cloud cover, sun, etc.           Max Auto-Exposure CD The maximum exposure in milliseconds when             Auto-Exposure is enabled.             Ignored if Auto-Exposure is disabled.                          When Auto-Exposure and             Consistent Delays Between Images are both on,             the time between the start of one image and the start of the next images is             the Max Auto-Exposure + Delay.        Manual Exposure 0.5 Manual exposure time in milliseconds.             If Auto-Exposure             is on this value is used as a starting exposure.                          The time between the start of one image and the start of the next images will be             the Manual Exposure + Delay,             regardless of the status of             Consistent Delays Between Images.           Mean Target 0.5 The target mean brightness level when             Auto-Exposure is on.             Ranges from 0.0 (pure black) to 1.0 (pure white).             Best used when both Auto-Exposure and             Auto-Gain are enabled.           Mean Threshold 0.1 When using Mean Target,             this specifies how close (plus or minus) the target brightness should be to the             Mean Target.             For example, if Mean Target is             <code>0.4</code> and             Mean Threshold is <code>0.1</code>             then the target brightness ranges from <code>0.3</code> to <code>0.5</code> Delay 5000 Time in milliseconds to wait between the end of one image and the start of the next. Auto-Gain No Turns on/off Auto-Gain which delivers properly exposed images even if             the overall brightness of the sky changes.             With RPi cameras, this should typically be turned on.             With ZWO cameras you'll probably want this off and use the lowest             gain possible since daytime images are bright and don't need any gain.           Max Auto-Gain CD Maximum gain when using Auto-Gain.             Ignored if Auto-Gain is off.           Gain CD Gain is similar to ISO on regular cameras.             When Auto-Gain is on, this value is used as a starting gain.             When Auto-Gain is off,             increasing this produces brighter images, but with more noise.             The default daytime gain is the minimum possible for the camera since             daytime images are normally bright and don't need any additional gain.           Stretch Amount 0 Stretching increases the contrast of an image without saturating the bright parts             or making the dark parts turn black.             It is most often used to lighten an image so isn't normally used during the day.             This setting determines how much to change the image:             3 is typical and 20 is a lot.             Set to 0 to disable stretching.                          See this page             for more information on stretching images.           Stretch Mid Point 10 Determines what brightness level in the image should be stretched:             0 stretches black pixels, 50 stretches middle-gray, etc.           Binning 1x1              Bin 2x2 collects the light from 4 pixels to form one larger pixel on the image.             Bin 3x3 uses 9 pixels, etc.             Increasing the bin results in smaller,             lower-resolution images and reduces the need for long exposure.             Look up your camera specifications to know what values are supported.             During the day this setting is usually only changed for testing.             Binning on CCD cameras normally produces brighter images.                CMOS camera may, or may not produce brighter images, depending on the camera model.              Auto White Balance No Sets daytime auto white balance.          When used, Red balance and          Blue balance are used as starting points. Red Balance CD The intensity of the red component of the image. Blue Balance CD The intensity of the blue component of the image. Frames To Skip 5 When starting Allsky during the day, skip up to this many images       while the auto-exposure software gets to the correct exposure.       Only applies if daytime Auto-Exposure is enabled.        Cooling No (ZWO cooled cameras only) Enable to use cooling on cameras that support it. Target Temp. 0 (ZWO cooled cameras only) Sensor's target temperature when cooler is enabled.       In degrees Celsius. Tuning File No (RPi on Bookworm and Bullseye only) Full path name of the optional daytime tuning file.       See the              Raspberry Pi Documentation for more information.              System-supplied tuning files on Raspberry Pi models prior to 5 are in       /usr/share/libcamera/ipa/rpi/vc4.       New Pi's files are in       /usr/share/libcamera/ipa/rpi/pisp.        Nighttime Settings              Unless otherwise specified, these setttings are the same as the Daytime ones.           Auto-Exposure Yes Max Auto-Exposure CD Manual Exposure 10000 Mean Target 0.2 Mean Threshold 0.1 Delay 10 Auto-Gain No With ZWO cameras enabling Auto-Exposure and             Auto-Gain together             can produce unpredictable results so testing is needed.           Max Auto-Gain CD Gain CD The default is one-half the maximum for the camera. Stretch Amount 0 Stretch Mid Point 10 Binning 1x1 Auto White Balance No Red Balance CD Blue Balance CD Frames To Skip 1 Only applies if nighttime Auto-Exposure is enabled. Cooling No (ZWO cooled cameras only) Target Temp. 0 (ZWO cooled cameras only) Tuning File No (RPi on Bookworm and Bullseye only) Both Day and Night Settings Days To Keep 14 Number of days of images and videos in       ~/allsky/images to keep.       Any directory older than this many days will be deleted at each end of night.       Set to 0 to keep ALL days' data;       you will need to manually manage disk space. Configuration File [none] Configuration file to use for settings.  Not currently used. Extra Parameters (RPi only) Any additional parameters to send to the       <code>libcamera-still</code> image capture program.       It supports a lot of settings that Allsky doesn't (e.g., auto-focus options),       and this field allows you to enter those settings.        Saturation CD (RPi only) Sets saturation from black and white to extra saturated. Contrast CD (RPi only) Changes the difference between blacks and whites in an image. Sharpness CD (RPi only) Changes the sharpness of an imgage.       Images that are too sharp look unnatural. Aggression 75% (ZWO only) Specifies how much of a calculated exposure change should be made       during auto-exposure. Lower numbers smooth out brightness changes but take longer to       react to changes. Gain Transition Time 15 (ZWO only) Number of minutes over which to increase or decrease       the gain when going from day-to-night or night-to-day images.       This helps smooth brightness differences.       Only works if nighttime Auto-Gain is off.       0 disables transitions. Image Type auto Image format: auto:       automatically picks the best type of image based on the camera.       If you have a color camera it will use RGB24;       mono cameras use RAW16 if the output file is a .png,       otherwise RAW8 is used.       RAW8: 8-bit mono. RGB24: color (red, green, blue), 8 bits per channel.       RAW16: 16-bit mono. Quality / Compression 95 For JPG images, this specifies the quality - 0 (low quality) to 100 (high quality).       Larger numbers produce higher-quality, but larger, files.       For PNG, this is the amount of compression - 0 for no compression (but quicker to save)       to 9 for highest compression (but slowest to save).       If you use very short delays between pictures you may want to play with these       numbers to get the quickest delay possible. Auto USB Bandwidth Yes (ZWO only) Automatically sets the USB bandwidth. USB Bandwidth CD (ZWO only) How much of the USB bandwidth to use. Filename AW image.jpg The name of the image file. Supported extensions are jpg and png. Rotation None (RPi on Bookworm and Bullseye only) How to rotate the image.       Choices are 0 and 180 degrees. Flip No flip How to flip the image (No flip, Horizontal, Vertical, or Both). Focus Mode No Enable to have images created and displayed as fast as possible,       to aid in focusing.       Other than adding the focus metric (see next setting) to each image,       no other post-processing is performed - no resizing,       no overlay or other modules are run, images aren't permanently saved or uploaded,       and there is no delay between images - as soon as an image is available and       the focus metric added, the next image is taken.       The WebUI's Live View       refreshes the image every second or so.       Because this happens so quickly, it's possible the Live View page will try to       read the image as it's being updated, so you may see occassional \"glitches\".        Record Focus No Enable to have the overall focus of the image determined and output via the 'FOCUS' variable, which can then be used in an overlay.  Unless you are focusing in \"Focus Mode\" (in which case this setting is enabled), it's not all that useful to see the metric since it can change depending on image brightness and other factors. Consistent Delays Between Images Yes Enabling this makes the time between the start of one auto-exposure       and the start of the next exposure a consistent length       (Max Auto-Exposure + Delay).       Timelapse video frames will be equally spaced.              For example, if the Max Auto-Exposure is       60 seconds and the Delay is 30 seconds,       the start of an exposure will be exactly 90 after the prior exposure's start time,       regardless of how long an individual frame's exposure is.       So if the first exposure was only 3 seconds,       the second exposure will still start 90 seconds after the first one.       <p>       Disabling this means the time between exposure starts varies depending on       the actual length of each exposure.       At nighttime when most exposure are at their maximum length this setting       doesn't make a difference,       but during the day or at twilight the exposure length is usually not at the maximum.       </p> <p>       Note that if manual exposure is used this setting doesn't apply       since the time between exposures       (Manual Exposure + Delay) is always the same.       </p> Time Format %Y%m%d %H:%M:%S Determines the format of the displayed time.       Run <code>man 3 strftime</code> to see the options. Temperature Units Celsius Determines what unit(s) the temperature will be displayed in (Celsius, Fahrenheit, or Both). Latitude AW Latitude of the camera.       Formats include: 123.4N, 123.4S, +123.4, or -123.4.       Southern hemisphere is negative.       The \"+\" is needed for positive numbers.        Longitude AW Longitude of the camera.       Formats include: 123.4E, 123.4W, +123.4, or -123.4.       West is negative.       The \"+\" is needed for positive numbers.              The actual values for latitude and longitude are not displayed on the map,       but users can zoom in to see exactly where your camera is.       If that bothers you, change the latitude and/or longitude values slightly.       Allsky itself only uses them to determine when daytime and nighttime begin so       you can change the values a fair amount and not impact anything.              When installing Allsky the first time,       the installation script will attempt to determine your rough       Latitude and       Longitude based on your IP address.       These values may be \"close enough\" in most cases but you may want to check them anyhow.        Angle AW -6 Altitude of the Sun above or below the horizon at which daytime and nighttime switch.       Can be negative (Sun below horizon) or positive (Sun above horizon).       <ul> <li>0 = Sunset       </li><li>-6 = Civil twilight       </li><li>-12 = Nautical twilight       </li><li>-18 = Astronomical twilight       </li></ul> Click here       for a more detailed description of Angle.        Take Dark Frames No Enable to take dark frames which are use to decrease noise in images.                          See the             in-depth explanation             of dark frames, including how to take and use them.           Dark Frame Upper Threshold 0.05 Any dark frame that has a mean brightness higher than this number is not saved.             If you're getting messages about \"bad images\" while taking dark frames,             first make sure your lens is FULLY covered and NO light is getting in.             If you are POSITIVE no light is getting in and your camera is noisy,             then increase this to <code>0.1</code> and see if it helps.             If not, then increase it more.           Use Dark Frames No Enable to perform dark frame subtraction at night.             Requires that you first took dark frames using the             Take Dark Frames setting.           Locale              The locale is used to determine what the thousands and decimal separators are             as well as the language to use for many non-Allsky commands.             If you have never set the locale in Allsky,             the installation script will display a list of locales installed on your Pi,             highlighting the current one.             If it's the correct one, press the TAB key until the cursor is             over <code>&lt;Ok&gt;</code>, then press ENTER.             <p> </p>                The locale only needs to be set once and won't change unless you reinstall the Pi OS.                Changing the locale requires a reboot, which must be done                before continuing the installation.              <p></p>             If the correct locale isn't in the list it needs to be installed,             so <code>&lt;Cancel&gt;</code> out of the installation and run             <code>sudo raspi-config</code>, selecting <code>Localisation Options</code>,             followed by the <code>Locale</code> option.             You will be shown a drop-down list with hundreds of locales; when you find the correct             one for your language and country, press the SPACE bar,             then TAB to the <code>&lt;Ok&gt;</code> button.             It will take a few seconds for the locale to be installed;             when done, re-run the installation script selecting the locale you just installed.           ZWO Exposure Type Snapshot              (ZWO only) Determines what type of exposures to take:             <ol> <li>Snapshot                   takes pictures one at a time like a \"normal\" camera.                   Note that Auto-Gain                   and Auto White Balance                   does not work when Snapshot is used.                </li> <li>Video Off                   takes pictures like a video camera that is turned off after every picture.                   This is the same as the old                   Version 0.8 exposure setting.                </li> <li>Video (original)                   takes pictures like a video camera that is always on.                   This is the original exposure method.                </li> </ol>             The first two types decrease the sensor temperature between 5 - 15 degrees Celsius.        Histogram Box 500 500 50 50 (ZWO only) X and Y size of histogram box in pixels and the middle point of             the box in percent.             This box is used to determine the average brightness of the image for auto-exposure             compensation.             If the Sun goes through the center of your image you may want to move the box.           Debug Level 1              Determines the amount of output in the Allsky log file:             <ul> <li>0 outputs error messages only.                </li><li>1 outputs \"what's happening\" type messages.                </li><li>2 outputs more \"what's happening\" messages.                </li><li>3 outputs debugging information.                   Use this level when debugging problems. </li><li>4 outputs a LOT of INFO messages.                   Use only if directed to by an Allsky developer.             </li></ul> Post Capture Settings Remove Bad Images Threshold Low 0.1 Images whose mean brightness is below this will be removed.             Useful values range from <code>0.01</code> to around <code>0.2</code>.             Set to <code>0</code> to disable this check.           Remove Bad Images Threshold High 0.9 Images whose mean brightness is above this will be removed.             Useful values range from <code>0.8</code> to around <code>0.95</code>.             Set to <code>0</code> to disable this check.           Remove Bad Images Threshold Count 5 Display a System Message when this many consecutive \"bad images\" are taken.             A notification image will also be displayed telling you how many consecutive bad images             there are.             Once a \"good\" image is taken, the notification image will be replaced by the good image.           Create Image Thumbnails Yes Create thumbnails of the images and save in ~/allsky/images?             If you never look at them via the WebUI's Images page,             consider changing this to \"No\".           Thumbnail Width 100 Sets the width of image and video thumbnails. Thumbnail Height 75              Sets the height of image and video thumbnails.             These numbers determine the size of the thumbnails in             ~/allsky/images             as well as any thumbnails created by the Allsky Website.                             Although changing these will change the size of the thumbnails,                no testing has been done to see if there are negative side effects.              Image Resize Width 0 The width to resize images to.             Large sensor cameras like the RPi HQ may need to be resized (i.e., shrunken)             in order for timelapses to work.             Resizing is done before cropping.             Must be an even number and             0 disables resizing.           Image ResizeHeight 0 Same as Image ResizeWidth             but for the image height.             Typically you'll want the             Width\u00a0/\u00a0Height             ratio to be the same as the sensor's width / height ratio,             otherwise images will be distorted.           Image CropTop 0 Number of pixels to crop off the top of an image.             This is often used to remove the dark areas around an image when using a fisheye lens.             All the Crop number should either             0 to disable cropping that side of an image,             or a positive number.           Image CropRight 0 Number of pixels to crop off the right side of an image. Image CropBottom 0 Number of pixels to crop off the bottom an image. Image CropLeft 0 Number of pixels to crop off the left side of an image. Timelapse Settings Daily Timelapse Generate Yes Enable to generate a timelapse video at the end of the night. Width 0 Changes the width of the generated timelapse; must be an even number.             0 uses the images's full size.             Large sensor cameras like the RPi HQ often need the timelapse to be shrunk             in order for timelapses to work (or the individual images need to be shrunk).           Height 0 Changes the height of the generated timelapse; must be an even number.             0 uses the images's full size.             If you change the width and height you'll probably want the resulting aspect ratio             to match the original images.           Bitrate 5000 Bitrate the timelapse video will be created with, in kilobytes.             Higher values produce better quality video but larger files.             Do NOT add a trailing k.           FPS 25 The timelapse video             Frames             Per             Second.             Higher numbers produce smoother, but shorter, videos.           Keep Sequence No Keep the sequence of symbolic links created when creating a timelapse?             Primarily used when debugging.           Extra Parameters Any additional timelapse parameters.             If video quality is poor or videos don't plan on Apple devices,             try adding -level 3.1.             Run <code>ffmpeg -?</code> to see the options.           Mini-Timelapse              Several of these settings are similar to the setting with the same             name for daily timelapses.             In those cases, only differences are noted.           Number Of Images 0 A \"mini-timelapse\" only includes the most recent images and is created often.             It's a good way to see \"recent\" activity.             This setting determines the number of images in the mini-timelapse.             Keep in mind the more images you have the longer it'll take to create the video.             30 is a good starting point.             0 disables mini-timelapse creation.             Note that each mini-timelapse overwrites the prior one. The following settings only apply if this settings is greater than 0.           Force Creation No Should a mini-timelapse be created even if             Number Of Images images             haven't been taken yet?             For example, you want 15 images in each mini-timelapse but only 5 have been taken;             should a mini-timelapse still be created?           Frequency 5              After how many images should the mini-timelapse be created?             Slower machines and machines with slow networks should use higher numbers.             3\u00a0-\u00a05 works well on a Pi 4 with 4 GB memory.             Every Frequency images a new             mini-timelapse is created using the last             Number Of Images images.             For example, every 5 frames a new mini-timelapse is created using the most recent 15 images.             <p> </p>                Be very careful when setting the                Number Of Images and                Frequency settings.                If either or both numbers are too high,                or the daytime or nighttime Delay is too short,                there may not be enough time to finish one mini timelapse creation before                the next one starts.                If this happens the second one will be aborted and you'll see a System Message in the WebUI                (you may need to refresh your browser page to see it).              <p></p> Width 0 Height 0 Bitrate 2000 This is normally smaller than a full timelapse to save on processing time. FPS 5 Mini-timelapses contain a small number of images so             this setting should be low to avoid very short videos.           Both Timelapses VCODEC libx264 Encoder used to create the timelapse video.             Rarely changed.                          Run <code>allsky-config encoders</code> for a (long) list.           Pixel format yuv420p Pixel format.             Rarely changed.                          Run <code>allsky-config pix_fmts</code> for a (long) list.           Log Level Warning Level of debugging information output when creating a timelapse.             Set to Info + Warnings + Errors for more output.             Primarily used for debugging or when tuning the algorithm.           Keogram and Startrails Settings Keograms Generate Yes Enable to generat a keogram image at the end of the night. Expand Yes Enable to expand keograms to the image width.             Same as the \"--image-expand\" and \"-x\" options.           Font Name Simplex Font name. Font Color #ffffff (white)              Color of the date/time label on the keogram.             Same as the \"--font-color\" and \"-C\" options.             The color can be specified using one of the following:             <ol> <li>Three comma- or space-separated numbers between                   <code>0</code> and <code>255</code>.                   where the numbers are in Red, Green, Blue order:                   <code>0,255,0</code> would be green and                   <code>255 0 1</code> would be red with a tiny bit of blue.                </li><li>A <code>#</code> followed by six hex digits between                   <code>00</code> and <code>ff</code>                   where the digits are in Red, Green, Blue order:                   <code>#00ff00</code> would be green and                   <code>#ff0001</code> would be red with a tiny bit of blue.                </li><li>A <code>#</code> followed by three hex digits between                   <code>0</code> and <code>f</code>                   where the digits are in Red, Green, Blue order:                   <code>#0f0</code> is equal to <code>#00ff00</code>                   and would be green and                   <code>#f00</code> is equal to <code>#ff0011</code>                   and would be red with a little bit of blue.             </li></ol>             Hex digits include: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, a, b, c, d, e, and f,             where hex <code>a</code> == decimal <code>10</code>,             b == 11, c == 12, d == 13, e == 14, and f == 15.             Hex <code>10</code> == decimal <code>16</code> and             hex <code>ff</code> == decimal <code>255</code>.                          The larger each number or hex digit, the more of that color is present, hence             <code>#000000</code> is pure black,             <code>255 255 255</code> is pure white,             and <code>128,128,128</code> is middle gray.           Font Size 2 Font size.             Same as the \"--font-size\" and \"-S\" options.           Font Line Thickness 3 Thickness of the font's line.             Same as the \"--font-line\" and \"-L\" options.           Extra Parameters Optional additional keogram creation parameters.             Execute <code>~/allsky/bin/keogram --help</code> for a list of options.           Startrails Generate Yes Enable to generate a startrails image at the end of night. Brightness Threshold 0.1 Average brightness level above which images are discarded             (moon, head lights, aurora, etc.).             If you are only getting very short trails, or none at all, adjust this number.             Values are 0.0 (pure black, filters out nothing)             to 1.0 (pure white, uses every image).           Extra Parameters Optional additional startrails creation parameters.             Execute <code>~/allsky/bin/startrails --help</code> for a list of options.           Websites and Remote Server Settings              Allsky supports uploading files to a local (i.e., on your Pi) Website,             a remote (i.e., not on your Pi) Website,             and/or a remote server that is NOT an Allsky Website.           Resize Uploaded Images Width 0 Set to an even number to resize images that will be uploaded.             This decreases the size of uploaded files and saves network bandwidth.             Further, images from cameras with large sensors won't fit on most monitors             at full resolution, so in effect it's a waste to have large images.             Set to 0 to disable resizing.           Resize Uploaded Images Height 0 Same as Resize Uploaded Images Width             but for the height.             If that setting is 0 this setting must be as well.           Upload Every X Images 1 How often should the current image be uploaded?             This is useful for slow or costly networks.             0 disables uploading images             Note that startrails, keograms, and timelapse videos have their own \"upload\" settings.           Upload Daily Timelapse Yes Enable to upload the timelapse video to an Allsky Website and/or remote server.             If not set, the timelapse videos can still be viewed via the             Images link on the WebUI.             Ignored if you you do not have an Allsky Website or remote server.           Upload Daily Timelapse Thumbnail Yes Enable to upload the timelapse video's thumbnail to your Allsky Website.             Many remote servers don't support thumbnail creation so the thumbnail needs to be             created on the Pi and uploaded.             Not needed if your only Allsky Website is on your Pi.           Upload Keogram Yes Enable to upload the keogram image to an Allsky Website and/or remote server. Upload Startrails Yes Enable to upload the startrails image to an Allsky Website and/or remote server. Upload Mini-Timelapse Yes Upload Mini-Timelapse Thumbnail Yes Display Settings No People sometimes ask others what settings they are using.             Enable this setting to add a link to your Allsky Website's right-side             popout that displays your settings.             This only works if you are running the Allsky Website.           Local Website Use Local Website No Enable to use a local Allsky Website.             No other settings are needed for a local Website.                          If you were using a local Website and disable it you will be asked if you             want to keep or remove the saved images, keograms, startrails, and timelapse videos.             Either way, the Website itself is not not removed nor are its settings so you can             easily re-enable it and pick up where you left off.           Days To Keep on Pi Website 14 Any image, video, or thumbnail older than this many days             will be deleted at each end of night.             0 disables the check and keeps ALL days' web data;             you will need to manually manage disk space.           Remote Website Use Remote Website No Enable to use a remote Allsky Website.             Enable the Website BEFORE you             install             it since the installation needs the settings below.           Image Directory              Name of the directory the current image should be uploaded to.                             This setting is a major cause of confusion for many users.                If you don't know what to enter,                ask the person or company supporting the server or look in the                                Troubleshooting -&gt; Uploads page for more information.              Protocol ftps              Specifies how files should be uploaded to the remote Website.             <ul> <li><code>ftps</code> -                   uses secure File Transfer Protocol (FTPs) to upload to a remote server.                </li><li><code>sftp</code> -                   uses SSH file transfer to upload to a remote server.                </li><li> <code>ftp</code> -                   uses (insecure) File Transfer Protocol (FTP) to upload to a remote server.                    <code>ftp</code> is unsecure;                      please use                      <code>ftps</code> or                      <code>sftp</code> instead.                    </li><li><code>scp</code> -                   uses secure cp (copy) to copy the file to a remote server.                </li><li><code>rsync</code> -                   uses rsync to copy the file to a remote server.                </li><li><code>s3</code> -                   copies the file to an Amazon Web Services (AWS) server.                </li><li><code>gcs</code> -                   copies the file to a Google Cloud Storage (GCS) server.             </li></ul> <p>Some of the settings below only apply to certain protocols.</p> Server Name Name of the remote server.             Note that this is normally NOT the same as the URL used to access the server.             If you don't know the name of the server,             ask the person or company supporting the server.           Port (ftp protocols only) Optional port required by the server.             This is rarely needed as the software can usually determine what port to use.           User Name The username of the login on the remote Website.           Password The password of the login on the remote Website.           FTP Commands (ftp protocols only) Optional command(s) to send to the ftp server prior to transfering files.             If you have problems uploading to an ftp server you'll often need to add             something to this field - see the             Troubleshooting -&gt; Uploads             page for more information.                          If you need to add multiple commands, separate them with a semi-colon.           SSH Public Key File              (scp and rsync protocols only) Path to the SSH public key file.             <p>                You need to set up SSH key authentication on your server.                First, generate a public SSH key on your Pi:             </p><pre>ssh-keygen -t rsa</pre>             When prompted, leave the default filename, and use an empty passphrase.             <p></p>             Then, copy the generated key to your server:             <pre>ssh-copy-id remote_username@remote_server</pre>             Replace <code>remote_username</code> with the login name on the remote server             and replace <code>remote_server</code> with the name or IP address of the remote server.             If you are prompted to <code>...continue connecting...</code>, enter <code>yes</code>.             <p>                The private SSH key will be stored in                ~/.ssh/id_rsa).             </p> <p>                If you are using SSH Key with Amazon's Lightsail,                copy the ssh-key.pem file to your Pi,                for example, in ~,                then execute <code>chmod 400 ~/ssh-key.pem</code> and set:             </p><ul> <li>Protocol to <code>sftp</code> </li><li>Server Name to <code>remote host name</code> </li><li>User Name to <code>remote user name</code> </li><li>Password to <code>n/a</code> </li><li>FTP Commands to                   <code>set sftp:connect-program 'ssh -a -x -i /home/pi/ssh-key.pem'</code> </li></ul> <p></p> AWS CLI Directory              (s3 protocol only) Directory on the Pi where the AWS Command-Line Interface (CLI)             tools are installed,             typically ${HOME}/.local/bin.             You need to install tools:             <pre>pip3 install awscli --upgrade --user\nexport PATH=\"${HOME}/.local/bin:${PATH}\"\naws configure\n</pre>             When prompted, enter a valid access key ID, Secret Access Key, and Default region name,             for example, \"us-west-2\".             Set the Default output format to \"json\" when prompted.           S3 Bucket (s3 protocol only) Name of the S3 bucket where files will be uploaded to             (must be in Default region specified above).             Suggested name is allskybucket.             You may want to turn off or limit bucket versioning to avoid consuming lots of             space with multiple versions of the \"image.jpg\" files.           S3 ACL private (s3 protocol only) S3 Access Control List (ACL).                          If you want to serve your uploaded files vis http(s),             change this to <code>public-read</code>.             You will need to ensure the S3 bucket policy is configured to allow public access to             objects with a <code>public-read</code> ACL.             You may need to set a CORS policy in S3 if the files are to be accessed by             Javascript from a different domain.           GCS Bucket (gcs protocol only) Name of the GCS bucket where files will be uploaded to.             Suggested name is allskybucket.                          You need to install the <code>gsutil</code> command which is part of the Google Cloud SDK.             See installation instructions             here.                          NOTE: The <code>gsutil</code> command must be installed somewhere in the standard ${PATH},             usually in /usr/bin.             Make sure you authenticate the cli tool with the correct user as well.           GCS ACL private (gcs protocol only) GCS Access Control List (ACL).             You can use any one of the predefined ACL rules found             here.             To access files over https, set this to <code>publicRead</code>.           Upload With Original Name No Determines the name of the uploaded image:             image.jpg (if No)             or image-YYYYMMDDHHMMSS.jpg (if Yes).             This is rarely used since changing the image name will make it unviewable.           Website URL              Your website's URL, for example             https://www.mywebsite.com/allsky.              <ul> <li>If a Website URL is specified,                      the Image URL must also be specified, and vice versa.                   </li><li>Both URLs must begin with                      http or https.                </li></ul> Image URL The URL to your allsky image, for example             https://www.mywebsite.com/allsky/image.jpg.             Normally this will be the Website URL followed by             <code>image.jpg</code>.             Use the more secure \"https\" over \"http\" if possible.           Remote Server              These settings are the same as for the Remote Website so are not described.           Use Remote Server No Enable to use a remote server which is NOT running the Allsky Website software.             Files will be copied to this server which normally will be a private website             where you want to display the most recent images along with other,             non-Allsky information.             For example, if you have an observatory website and want to show the latest image,             you would use the settings below.           Image Directory Protocol ftps Server Name Port User Name Password FTP Commands SSH Public Key File AWS CLI Directory S3 Bucket S3 ACL private GCS Bucket GCS ACL private Upload With Original Name No Unless you are using the remote server as a backup,             this is rarely used since changing the image name will make it unviewable.           Remote Video File Name allsky.mp4 Unless you are using the remote server as a backup,             this is usually used so the server knows the file name.           Remote Keogram File Name keogram.jpg Unless you are using the remote server as a backup,             this is usually used so the server knows the file name.           Remote Startrails File Name startrails.jpg Unless you are using the remote server as a backup,             this is usually used so the server knows the file name.           Allsky Map Settings              If you want your allsky camera's location to display on the             Allsky map,             the information in this section will be sent to the map server every other             morning to ensure it's fresh.             The server automatically removes old data.             Note that only a limited number of updates per day are allowed to catch bogus updates.           Show on Map No Enable to have your camera appear on the             Allsky map.             If off, the following settings are ignored. Location AW The location of your camera.             You can put any level of detail you want.           Owner AW The owner of the camera - your name, an association name, an observatory, etc. Lens AW The lens you're using on your camera, for example: Arecont 1.55. Equipment Info AW Any optional information you want to add about the equipment you are using.             For example, if you are using a camera with no infrared filter (a \"NoIR\" camera).           WebUI Configuration Images Sort Order Ascending Determines how the images for a day in the             the WebUI's Images page are displayed.             Ascending             sorts oldest image to newest.             Descending             sorts newest (i.e., most recent) image to oldest.           Show Updated Message Yes Determines whether or not the             Daytime images updated every...             message in the Live View page is shown.           Require WebUI Login Yes Determines if you need to log into the WebUI.             If you Pi is accessible on the Internet, do NOT disable this!! System Page Additions One or more colon-separated full path names to text files             that contain user-supplied data to display on the WebUI's             System page.             See              System Page Additions             for more information and an example of this setting.           Allsky Database Settings                 Only change the database settings if you know what you are doing.              Enable Database Yes Enables the Allsky database, which keeps information on images taken             like exposure time and a day/night flag.             Some Allsky modules update these records, for example, the meteor detection module             adds the number of meteors to each image's database record.                          The database allows capabilities like using only nighttime images in startrails.                          Disabling the database will keep many new features from working properly.           Database allsky The name of the database.           Database Type SQLite The type of database.             MySQL has more features but uses a lot more CPU and memory than SQLite.             It would typically only be used if you already have a MySQL database on your Pi,             which is extremely rare.           Database Host (MySQL only) The IP address or hostname of the server running the database.             By default the database runs on your Pi.           Database User (MySQL only) The username used to connect to the database.             Suggest using the same as your Pi login so you have one less thing to remember.           User Password              (MySQL only) The password used to connect to the database.                             Keep track of the User and Password - if the                ~/allsky/env.json file is accidently removed you'll                need to enter the User and Password in order for the database to work.              Camera Camera Type              The type of camera you are using: ZWO or RPi.             To select a camera of a different Camera Type:             <ol> <li>Select the Type.                </li><li>Save the change via the                   Save changes button.                </li><li>Update the Camera Model as desired.             </li></ol>             If you connect or disconnect a camera on the Pi,             select Refresh             to update the list of camera types and models.           Camera Model The model of camera you are using.             Note this list is only the models of             the current Camera Type."},{"location":"allsky_guide/settings/website.html","title":"Website","text":""},{"location":"developer_guide/available_fields.html","title":"Available Fields","text":""},{"location":"developer_guide/available_fields.html#available-fields","title":"Available fields","text":""},{"location":"developer_guide/available_fields.html#text-field","title":"Text field","text":"<p>This is the default field type and requires no extra values. This will display a text box allowing the user to enter detail</p> <pre><code>\"textfield\": {\n    \"required\": \"false\",\n    \"description\": \"Text Field\",\n    \"help\": \"Example help for the text field.\",\n    \"tab\": \"Field Types\"\n}\n</code></pre>"},{"location":"developer_guide/available_fields.html#select-field","title":"Select field","text":"<p>This displays a drop down list allowing the user to select a value. The only additional value required is the \u2018values\u2019 option which is a comma separated list of the values to display in the dropdown</p> <pre><code>\"select\" : {\n    \"required\": \"false\",\n    \"description\": \"Select Field\",\n    \"help\": \"Example help for a select field.\",\n    \"tab\": \"Field Types\",\n    \"type\": {\n        \"fieldtype\": \"select\",\n        \"values\": \"None,value1,value2,value3\"\n    }                \n}\n</code></pre>"},{"location":"developer_guide/available_fields.html#ajax-select-field","title":"Ajax select field","text":"<p>This field type is main intended for use by the core Allsky development team. It displays a dopdown list of values obtained from an ajax request.</p> <pre><code>\"ajaxselect\": {\n    \"required\": \"false\",\n    \"description\": \"Ajax Select\",\n    \"tab\": \"Field Types\",\n    \"help\": \"returns data from an AJAX request.\",\n    \"type\": {\n        \"fieldtype\": \"ajaxselect\",\n        \"url\": \"includes/moduleutil.php?request=Onewire\",\n        \"placeholder\": \"Select a One Wire device\"\n    }           \n}\n</code></pre>"},{"location":"developer_guide/available_fields.html#checkbox-field","title":"Checkbox field","text":"<p>This displays a \u2018switch\u2019 that can be used to turn a value on or off. This will be presented in the params data as a boolean</p> <pre><code>\"checkbox\" : {\n    \"required\": \"false\",\n    \"description\": \"Checkbox Field\",\n    \"help\": \"Example help for the checkbox field.\",\n    \"tab\": \"Field Types\",\n    \"type\": {\n        \"fieldtype\": \"checkbox\"\n    }          \n}\n</code></pre>"},{"location":"developer_guide/available_fields.html#number-field","title":"Number field","text":"<p>This uses the HTML5 spinner control to allow a number to be entered. You can set the min, max and step values</p> <pre><code>\"number\" : {\n    \"required\": \"true\",\n    \"description\": \"Number Field\",\n    \"help\": \"Example help for the number field.\",\n    \"tab\": \"Field Types\",\n    \"type\": {\n        \"fieldtype\": \"spinner\",\n        \"min\": 0,\n        \"max\": 1000,\n        \"step\": 1\n    }          \n}\n</code></pre>"},{"location":"developer_guide/available_fields.html#i2c-field","title":"I2c Field","text":"<p>This displays a dialog allowing the user to select an i2c address. The dialog will display all detected devices on bus zero. A library, courtesy of Adafruit, is also available.</p> <pre><code>\"i2c\": {\n    \"required\": \"false\",\n    \"description\": \"I2C Address\",\n    \"help\": \"Example field to select an i2c address.\",\n    \"tab\": \"Field Types\",           \n    \"type\": {\n        \"fieldtype\": \"i2c\"\n    }            \n}\n</code></pre> <p></p> <p>The i2c device selection dialog</p> <p>When Allsky is first installed the i2c database has to be built. The \u2018Update Database\u2019 button in the dialog will rebuild the database.</p>"},{"location":"developer_guide/available_fields.html#gpio-field","title":"GPIO Field","text":"<p>This field will allow the user to select a gpio pin using a graphical interface. The user simple needs to click on the pin they require.</p> <pre><code>\"gpio\": {\n    \"required\": \"false\",\n    \"description\": \"GPIO Field\",\n    \"help\": \"Example help for the GPIO field.\",\n    \"tab\": \"Field Types 2\",\n    \"type\": {\n        \"fieldtype\": \"gpio\"\n    }           \n}\n</code></pre> <p></p> <p>The GPIO pin selection dialog</p>"},{"location":"developer_guide/available_fields.html#image-field","title":"Image Field","text":"<p>This allows the user to select or upload an image. Typically this would be used where a module requires a mask. This will allow the user to select the mask from the image library</p> <pre><code>\"image\" : {\n    \"required\": \"false\",\n    \"description\": \"Image Field\",\n    \"help\": \"Example help for the image field.\",\n    \"tab\": \"Field Types 2\",            \n    \"type\": {\n        \"fieldtype\": \"image\"\n    }                \n}\n</code></pre> <p></p> <p>The image selection dialog</p>"},{"location":"developer_guide/available_fields.html#region-of-interest-roi-field","title":"Region of Interest (ROI) Field","text":"<p>This allows the user to select a region Of Interest (ROI) in the image. This will then be available to the module. Typically, this would be used for things like sky brightness detection where you only want to run the calculation on a portion of the image</p> <pre><code>\"roi\": {\n    \"required\": \"false\",\n    \"description\": \"Region of Interest field\",\n    \"help\": \"Example help for the region of interest field.\",\n    \"tab\": \"Field Types 2\",            \n    \"type\": {\n        \"fieldtype\": \"roi\"\n    }            \n}\n</code></pre> <p></p> <p>The RIO selection dialog</p>"},{"location":"developer_guide/available_fields.html#variable-field","title":"Variable Field","text":"<p>If you need the user to select another variable from within Allsky then this field type will display the variable manager allowing a variable to be selected. The \u2018selectmode\u2019 option has to options \u2018single\u2019 or \u2018multi\u2019. This controls if the user can select a single variable or multiple. Multiple variables will be presented as a comma separated list.</p> <pre><code>\"variable\": {\n    \"required\": \"false\",\n    \"description\": \"Allsky Variable\",\n    \"help\": \"Allows and Allsky variable to be selected.\",\n    \"tab\": \"Field Types 2\",         \n    \"type\": {\n        \"fieldtype\": \"variable\",\n        \"selectmode\": \"multi\"\n    }                             \n}\n</code></pre> <p></p> <p>The Variable selection dialog</p>"},{"location":"developer_guide/available_fields.html#position-field","title":"Position Field","text":"<p>This field allows the user to select a position from a map. There are three additional parameters required for this field, all refer to the name of the value in the arguments section</p> <p>lat \u2013 The name of the argument to store the latitude in lon \u2013 The name of the argument to store the longitue in height \u2013 The name of the argument to store the height in, note height may not always be available when selecting on the map.</p> <pre><code>\"position\": {\n    \"description\": \"Position\",\n    \"help\": \"Allows latitude, longitude, and altitude to be selected from a map.\",\n    \"tab\": \"Field Types 2\",\n    \"lat\": {\n        \"id\": \"observer_lat\"\n    },\n    \"lon\": {\n        \"id\": \"observer_lon\"                \n    },\n    \"height\": {\n        \"id\": \"observer_height\"                \n    },\n    \"type\": {\n        \"fieldtype\": \"position\"\n    }     \n}\n</code></pre> <p></p> <p>The Position fields on a module dialog</p> <p></p> <p>The map location selection dialog</p>"},{"location":"developer_guide/available_fields.html#url-field","title":"URL Field","text":"<p>This field allows a url to be entered and validate using a button. The validation will check to ensure the url can be connected to.</p> <pre><code>\"url\": {\n    \"required\": \"true\",\n    \"tab\": \"Field Types 2\",          \n    \"description\": \"Allows a url to be entered and then checked to see if it can be reached\",\n    \"help\": \"Select a url.\",\n    \"type\": {\n        \"fieldtype\": \"url\"\n    }          \n}\n</code></pre> <p></p> <p>The URL entry fields</p>"},{"location":"developer_guide/available_fields.html#host-field","title":"Host field","text":"<p>This field allows a host and port number to ben entered. There are two additional parameters required for this field, all refer to the name of the value in the arguments section</p> <p>url \u2013 The url or ip address of the host port \u2013 The port number of the host</p> <pre><code>\"host\": {\n    \"description\": \"Host\",\n    \"help\": \"Allows a host and port to be entered.\",\n    \"tab\": \"Field Types 2\",\n    \"url\": {\n        \"id\": \"influxhost\"\n    },\n    \"port\": {\n        \"id\": \"influxport\"                \n    },\n    \"type\": {\n        \"fieldtype\": \"host\"\n    }     \n}\n</code></pre> <p></p> <p>The Host entry fields</p>"},{"location":"developer_guide/available_fields.html#graph-field","title":"Graph field","text":"<p>This is a special field type that rather than display a field adds a new tab to the modules settings to display the history for this module.</p> <p>For this field to work there are a few criteria that have to be met</p> <ul> <li>The module must be saving data to the database  </li> <li>The module must have a \u2018main\u2019 chart, see the charts section for more details</li> </ul> <p><code>\"graph\": {     \"required\": \"false\",     \"tab\": \"Graph\",     \"type\": {         \"fieldtype\": \"graph\"     } }</code></p> <p></p> <p>The Module Graph</p>"},{"location":"developer_guide/available_fields.html#notice-field","title":"Notice field","text":"<p>This field is used to display text on the modules dialog settings. The \u2018alert\u2019 settings utilise bootstraps alerts.</p> <pre><code>\"notice\" : {\n    \"tab\": \"Home\",      \n    \"message\": \"This module provides centralised temperature, humidity, and pressure data to other modules. This should be used in favour of dedicated sensors in any other modules which will be removed in a future release.\",\n    \"type\": {\n        \"fieldtype\": \"text\",\n        \"style\": {\n            \"width\": \"full\",\n            \"alert\": {\n                \"class\": \"info\"\n            }\n        }\n    }             \n}\n</code></pre> <p></p> <p>The Notice field</p>"},{"location":"developer_guide/available_fields.html#html-field","title":"HTML Field","text":"<p>This field is used to display HTML in a modules dialog. There are a few additional settings available.</p> <p>Source \u2013 Either local, where the html is read from the \u2018html\u2019 value or \u2018file\u2019 where the html is read from a file on the server using the \u2018file\u2019 value to define the source</p> <pre><code>\"html\": {\n    \"tab\": \"Help\",\n        \"source\": \"local\",\n                    \"html\": \"&lt;h1&gt;This help text is defined within the module&lt;/h1&gt;&lt;blockquote&gt;This help is hard coded into the modules config. This is ok for very short text but not good for longer text. For longer text use the file option in the field&lt;/blockquote&gt;&lt;p&gt;Bacon ipsum dolor amet cow \u2026&lt;p&gt;\",\n    \"type\": {\n        \"fieldtype\": \"html\"\n    }\n},\n\"html1\": {\n    \"tab\": \"Help 1\",\n        \"source\": \"file\",\n                    \"file\": \"help.html\",\n    \"type\": {\n        \"fieldtype\": \"html\"\n    }\n}\n</code></pre> <p></p> <p>The HTML field</p>"},{"location":"developer_guide/blocks.html","title":"Blocks","text":"<p>Blocks are designed to simplify the adding of fields to the overlay. Some modules, the solar system moduloe for example, produce a lot of variables that can be added to the overlay. Manually adding each one can be tedious.</p> <p>Blocks are predefined groups of variables defined in a column/row layout that can be added to the overlay together.</p> <p>Blocks are accessed from the variable managier when editing an overlay</p> <p></p> <p>The blocks tab in the variable manager</p>"},{"location":"developer_guide/blocks.html#blocks-structure","title":"Blocks structure","text":"<p>Blocks are json files that define one or more blocks that are made available in the variable manager. The following example is taken from the allsk_solarsystem module and defines two blocks related ot the sun</p> <ul> <li>The first block defines the variables to display for the Sun's timings  </li> <li>The second block defines the variables to display the position of the Sun</li> </ul> <p>There is no limit on the number of columns or rows that can be created in a block.</p> <p>Field spacing</p> <p>If you define multiple columns when the fields are added to the overlay the width will be set to the widest variable name. This is not ideal as the data may be muc narrower than the variable name. To get around this after the block has been added the user should select the variables in each column and line them up as required.</p> <ul> <li>The key name for each block can be anything, given the file is json it must be unique within the file  </li> <li>The name is displayed within the variable manager  </li> <li>The description is displayed within the variable manager</li> <li>The fields section contains each row and column. The keys to the rows are abritrary and the convention for the columns is colXX </li> <li>You do not have to use multiple columns you could just create a single column in each row that contains the field labale and data. Generally its better</li> <li>Each row does not have to have the same number of columns, see the top 5 adsb aircraft below</li> </ul> <pre><code>{\n    \"suntimesblock\": {\n        \"name\": \"Sun Times\",\n        \"description\": \"List of sun time data\",\n        \"fields\": {\n            \"sunrow1\": {\n                \"col1\": {\n                    \"text\": \"Dawn:\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_SUN_DAWN}\"\n                }\n            },\n            \"sunrow2\": {\n                \"col1\": {\n                    \"text\": \"Sunrise:\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_SUN_SUNRISE}\"\n                }\n            },\n            \"sunrow3\": {\n                \"col1\": {\n                    \"text\": \"Noon:\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_SUN_NOON}\"\n                }\n            },\n            \"sunrow4\": {\n                \"col1\": {\n                    \"text\": \"Sunset:\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_SUN_SUNSET}\"\n                }\n            },\n            \"sunrow5\": {\n                \"col1\": {\n                    \"text\": \"Dusk:\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_SUN_DUSK}\"\n                }\n            }\n        }\n    },\n    \"sunpositionblock\": {\n        \"name\": \"Sun Position\",\n        \"description\": \"Position of the Sun\",\n        \"fields\": {\n            \"sunrow1\": {\n                \"col1\": {\n                    \"text\": \"Azimuth:\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_SUN_AZIMUTH}\"\n                }\n            },\n            \"sunrow2\": {\n                \"col1\": {\n                    \"text\": \"Elevation:\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_SUN_ELEVATION}\"\n                }\n            }\n        }\n    }    \n}\n</code></pre> <p>The block defining the Sun position and timings</p> <pre><code>{\n    \"closest\": {\n        \"name\": \"Top 5 Aircraft\",\n        \"fields\": {\n            \"ac1row1\": {\n                \"text\": \"${AS_LONGTEXT_AIRCRAFT1}\"\n            },\n            \"ac1row2\": {\n                \"col1\": {\n                    \"text\": \"${AS_SHORT_ROUTE_AIRCRAFT1}\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_MEDIUM_ROUTE_AIRCRAFT1}\"\n                }\n            },\n            \"ac1row3\": {\n                \"text\": \"${AS_LONGTEXT_AIRCRAFT2}\"\n            },\n            \"ac1row4\": {\n                \"col1\": {\n                    \"text\": \"${AS_SHORT_ROUTE_AIRCRAFT2}\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_MEDIUM_ROUTE_AIRCRAFT2}\"\n                }\n            },\n            \"ac1row5\": {\n                \"text\": \"${AS_LONGTEXT_AIRCRAFT3}\"\n            },\n            \"ac1row6\": {\n                \"col1\": {\n                    \"text\": \"${AS_SHORT_ROUTE_AIRCRAFT3}\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_MEDIUM_ROUTE_AIRCRAFT3}\"\n                }\n            },\n            \"ac1row7\": {\n                \"text\": \"${AS_LONGTEXT_AIRCRAFT4}\"\n            },\n            \"ac1row8\": {\n                \"col1\": {\n                    \"text\": \"${AS_SHORT_ROUTE_AIRCRAFT4}\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_MEDIUM_ROUTE_AIRCRAFT4}\"\n                }\n            },\n            \"ac1row9\": {\n                \"text\": \"${AS_LONGTEXT_AIRCRAFT5}\"\n            },\n            \"ac1row10\": {\n                \"col1\": {\n                    \"text\": \"${AS_SHORT_ROUTE_AIRCRAFT5}\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_MEDIUM_ROUTE_AIRCRAFT5}\"\n                }\n            }                                              \n        }\n    }\n}\n</code></pre> <p>The block defining the top 5 ADSB aircraft, note the differeing columns per row</p>"},{"location":"developer_guide/blocks.html#distributing","title":"Distributing","text":"<p>To include blocks with your module simply create the config and add them to the blocks folder withing the module repository. The installer will then copy the charts to the correct location within Allsky.</p>"},{"location":"developer_guide/charts.html","title":"Charts","text":"<p>Charts allows you to display data from Allsky and modules within the WebUI</p> <p></p> <p>The Web UI Charts Page</p> <p>You can provide custom charts for use with your module. There are a few prerequisites to doing this</p> <ul> <li>You must be saving data in the database  </li> <li>You should have a good understanding of Highcharts although it is entirley possible to copy and modify existing charts of all you need are basic ones</li> </ul> <p>There are several charts types available</p> <ul> <li>Line - A line graph  </li> <li>Spline - A smoothed line chart  </li> <li>Gauge - A guage  </li> <li>Yes/No - A chart that displays Yes or No</li> </ul> <p>There other charts types supported all of which are standard Highcharts so please refer to the Highcharts documentation for details</p>"},{"location":"developer_guide/charts.html#chart-types","title":"Chart Types","text":""},{"location":"developer_guide/charts.html#line-charts","title":"Line Charts","text":"<p>Single axis line chart </p> <p> </p> <p>Multi axis line chart </p>"},{"location":"developer_guide/charts.html#single-axis","title":"Single axis","text":"<p>The following defines a line chart showing the total number of aircraft seen by the adsb module.</p> field Description icon Any valid fontawesome icon group The group the chart belongs to, when using the Chart Manager charts will appear in these groups title The charts title type The type of chart main If true then this chart will be used in the module manager to display the history table The table the chart is getting data from yAxis Only set the 'text' to the title of the Y axis series Set the variable to the Allsky Variable containing the data to chart <p>The 'main' chart</p> <p>When creating charts for your module it is strongly suggested that you create a chart with main set to true. There must only be one chart within your module with main set to true</p> <pre><code>{\n    \"icon\": \"fas fa-chart-line\",\n    \"group\": \"ADSB\",\n    \"title\": \"Total Aircraft\",\n    \"type\": \"line\",\n    \"main\": true,\n    \"table\": \"allsky_adsb\", \n    \"yAxis\": [\n        {\n            \"title\": {\n                \"text\": \"Total Aircraft\"\n            }\n        }\n    ],\n    \"series\": [\n        {\n            \"name\": \"Aircraft\",\n            \"variable\": \"AS_TOTAL_AIRCRAFT\"\n        }\n    ]\n}\n</code></pre>"},{"location":"developer_guide/charts.html#multiple-axis","title":"Multiple axis","text":"<p>It is possible to create a chart with multiple Y axis.</p> <p>When using multiple axis there are a few things to bear in mind. The opposite setting in the yAxis forces the axis to the other axis. The yAxis value in the series defines which axis the data will appear against</p> <pre><code>{\n    \"icon\": \"fas fa-chart-line\",\n    \"group\": \"Environment\",\n    \"title\": \"Dew Heater Temp/Humidity\",\n    \"type\": \"line\",\n    \"table\": \"allsky_dewheater\",\n    \"main\": true,\n    \"yAxis\": [\n        {\n            \"title\": {\n                \"text\": \"Temperature\"\n            }\n        },\n        {\n            \"title\": {\n                \"text\": \"Humidity\"\n            },\n            \"opposite\": true\n        }\n    ],\n    \"series\": [\n        {\n            \"name\": \"Temperature\",\n            \"yAxis\": 0,\n            \"variable\": \"AS_DEWCONTROLAMBIENT\"\n        },\n        {\n            \"name\": \"Humidity\",\n            \"yAxis\": 1,\n            \"variable\": \"AS_DEWCONTROLHUMIDITY\"\n        }\n    ]\n}\n</code></pre>"},{"location":"developer_guide/charts.html#spline-charts","title":"Spline Charts","text":"<p>The configuration for a spline chart is identical to a line chart except the type is set to spline.</p>"},{"location":"developer_guide/charts.html#gauges","title":"Gauges","text":"<p>An example Gauge </p> <p>Gauges can be built using a very simple config as below.</p> <pre><code>{\n    \"title\": \"Dew Heater PWM %\",\n    \"icon\": \"fa-solid fa-gauge\",\n    \"type\": \"gauge\",\n    \"group\": \"Environment\",\n    \"table\": \"allsky_dewheater\",\n    \"series\": [\n        {\n            \"name\": \"PWM %\",\n            \"variable\": \"AS_DEWCONTROLPWMPERCENT\"\n        }\n    ]\n}\n</code></pre> <p>Gauges can also be overriden using Highcharts to customise the view</p> <p> </p> <p>An example custom Gauge </p> <p>The full extent of customisation is beyon the scope o this document. Please refer to the Highcharts documentation for details </p><pre><code>{\n    \"title\": \"Total Aircraft\",\n    \"icon\": \"fa-solid fa-gauge\",\n    \"type\": \"gauge\",\n    \"group\": \"ADSB\",\n    \"table\": \"allsky_adsb\",\n    \"hc\": {\n        \"yAxis\": [\n            {\n                \"min\": 0,\n                \"max\": 50,\n                \"tickInterval\": 10,\n                \"tickPosition\": \"inside\",\n                \"lineWidth\": 0,\n                \"labels\": {\n                    \"distance\": 20,\n                    \"style\": {\n                        \"fontSize\": \"12px\"\n                    }\n                },\n                \"plotBands\": [\n                    {\n                        \"from\": 0,\n                        \"to\": 200,\n                        \"color\": \"#2ecc71\",\n                        \"thickness\": 30\n                    }\n                ]\n            }\n        ],\n        \"pane\": {\n            \"startAngle\": -90,\n            \"endAngle\": 90,\n            \"center\": [\n                \"50%\",\n                \"75%\"\n            ],\n            \"size\": \"110%\",\n            \"background\": null\n        }\n    },\n    \"series\": [\n        {\n            \"name\": \"Total Aircraft\",\n            \"variable\": \"AS_TOTAL_AIRCRAFT\",\n            \"options\": {\n                \"tooltip\": {\n                    \"valueSuffix\": \"\"\n                },\n                \"dataLabels\": {\n                    \"format\": \"{y}\"\n                },\n                \"dial\": {\n                    \"radius\": \"80%\",\n                    \"baseWidth\": 16,\n                    \"baseLength\": \"0%\",\n                    \"rearLength\": \"0%\"\n                },\n                \"pivot\": {\n                    \"radius\": 8\n                }\n            }\n        }\n    ]\n}\n</code></pre><p></p>"},{"location":"developer_guide/charts.html#yesno-charts","title":"Yes/No Charts","text":"<p>These simply display text based upon a thruthy value.</p> <p> </p> <p>An example Yes / No Chart </p> <p>The important values here are the truetext, falsetext and the associated colour fields</p> <pre><code>{\n    \"icon\": \"fas fa-lightbulb\",\n    \"group\": \"Environment\",\n    \"title\": \"Dew Heater State\",\n    \"type\": \"yesno\",\n    \"table\": \"allsky_dewheater\",\n    \"hc\": {\n      \"yesNo\": {\n        \"trueText\": \"On\",\n        \"falseText\": \"Off\",\n        \"trueColor\": \"#2ecc71\",\n        \"falseColor\": \"#e74c3c\",\n        \"fontSize\": \"72px\"\n      }\n    },        \n    \"series\": [\n        {\n            \"name\": \"Heater State\",\n            \"yAxis\": 0,\n            \"variable\": \"AS_DEWCONTROLHEATERINT\"\n        }\n    ]\n}\n</code></pre>"},{"location":"developer_guide/charts.html#distributing","title":"Distributing","text":"<p>To include charts with your module simply create the config and add them to the charts folder withing the module repository. The installer will then copy the charts to the correct location within Allsky.</p>"},{"location":"developer_guide/contributing.html","title":"Contributing","text":""},{"location":"developer_guide/contributing.html#contributing","title":"CONTRIBUTING","text":"<p>Thank you for your interest in contributing to the Allsky Project. This document explains how to contribute to the repositories within the AllskyTeam GitHub organisation, including:</p> <ul> <li>allsky (the core server, backend, UI, and processing pipeline)</li> <li>allsky-modules (the official library of Allsky extra modules)</li> </ul> <p>Contributions of all kinds are welcome: bug fixes, new modules, documentation, UI improvements, or backend enhancements.</p>"},{"location":"developer_guide/contributing.html#1-repository-overview","title":"1. Repository Overview","text":""},{"location":"developer_guide/contributing.html#allsky","title":"allsky","text":"<p>Contains core Allsky and core modules.</p>"},{"location":"developer_guide/contributing.html#allsky-modules","title":"allsky-modules","text":"<p>Contains individual processing modules used by Allsky (post-processing, device control, AI tools, weather sensors, ADS-B, MQTT, etc.)</p> <p>If your contribution affects modules, submit it to allsky-modules. If your contribution affects the core server, UI, or module runner, submit it to allsky.</p>"},{"location":"developer_guide/contributing.html#2-how-to-contribute","title":"2. How to Contribute","text":""},{"location":"developer_guide/contributing.html#step-1-fork-the-repository","title":"Step 1: Fork the repository","text":"<p>Click \"Fork\" on GitHub, then clone your fork:</p> <pre><code>git clone https://github.com/&lt;your-username&gt;/&lt;repo&gt;.git\ncd &lt;repo&gt;\n</code></pre>"},{"location":"developer_guide/contributing.html#step-2-create-a-branch","title":"Step 2: Create a branch","text":"<pre><code>git checkout -b feature/my-feature\n</code></pre>"},{"location":"developer_guide/contributing.html#step-3-make-your-changes","title":"Step 3: Make your changes","text":""},{"location":"developer_guide/contributing.html#step-4-push-and-open-a-pull-request","title":"Step 4: Push and open a Pull Request","text":"<pre><code>git push origin feature/my-feature\n</code></pre>"},{"location":"developer_guide/contributing.html#3-coding-standards","title":"3. Coding Standards","text":""},{"location":"developer_guide/contributing.html#python","title":"Python","text":"<ul> <li>PEP8</li> <li>Type hints</li> <li>Google-style docstrings</li> </ul>"},{"location":"developer_guide/contributing.html#bash","title":"Bash","text":"<p>Use shellcheck to validate bash scripts</p>"},{"location":"developer_guide/contributing.html#javascript","title":"JavaScript","text":"<ul> <li>ES6+</li> </ul>"},{"location":"developer_guide/contributing.html#4-documentation-standards","title":"4. Documentation Standards","text":"<p>All new features must update docs under /docs.</p> <p>Example module README:</p> <pre><code># Module Name\n\n## Description\n...\n\n## Configuration\n| Setting | Description | Default |\n|--------|-------------|---------|\n\n## Example Output\n</code></pre>"},{"location":"developer_guide/contributing.html#5-testing","title":"5. Testing","text":""},{"location":"developer_guide/contributing.html#allsky_1","title":"allsky","text":"<ul> <li>Server starts</li> <li>API responds</li> <li>Overlay works</li> </ul>"},{"location":"developer_guide/contributing.html#allsky-modules_1","title":"allsky-modules","text":"<pre><code>python3 allsky_module_test.py --module &lt;name&gt;\n</code></pre>"},{"location":"developer_guide/contributing.html#6-pull-request-requirements","title":"6. Pull Request Requirements","text":"<ul> <li>Description</li> <li>Linked Issue</li> <li>Screenshots for UI changes</li> </ul>"},{"location":"developer_guide/contributing.html#7-security-reporting","title":"7. Security Reporting","text":"<p>Do not open public issues for vulnerabilities.</p>"},{"location":"developer_guide/contributing.html#8-thank-you","title":"8. Thank You","text":"<p>Thank you for contributing to Allsky.</p>"},{"location":"developer_guide/dependencies.html","title":"Dependencies","text":""},{"location":"developer_guide/dependencies.html#the-installerjson-file","title":"The installer.json file","text":"<p>This file allows you to configure dependencies and post installation scripts for the module.</p> <pre><code>{\n    \"requirements\": [\n        \"unidecode\"\n    ],\n    \"packages\": [\n        \"somepackage\"\n    ],\n    \"post-install\": {\n        \"run\": \"{install_data_dir}/tools/build_database.py\" \n    }\n}\n</code></pre> <p>There are three sections available in this file</p> <ul> <li>Requirements \u2013 Used to install any Python dependencies  </li> <li>Packages \u2013 Used to install any apt packages  </li> <li>Post-install \u2013 Any scripts to run after the installation is complete  </li> </ul> <p>These are covered in more detail in the following sections</p>"},{"location":"developer_guide/dependencies.html#python-dependencies","title":"Python Dependencies","text":"<p>If your module requires Python dependencies then first check if the dependencies are already available.</p> <p>If the dependencies are not available then inside your module folder create the installer.json file and add the dependencies to it.</p> <p>This file is passed to pip using the -r option so follows all of the normal conventions for installing python modules.</p> <p>Any installed dependencies will be added to the main Allsky virtual python environment, found in ~/allsky/venv</p> <p>numpy</p> <p>NEVER attempt to install numpy in your dependencies. Doing so may break Allsky. We use Numpy version 2 or above so you can not use any libraries that require numpy version 1</p> <p>Legacy Requirements file</p> <p>Some modules use a requirements.txt file \u2013 This is the legacy method for installing dependencies and must not be used.</p>"},{"location":"developer_guide/dependencies.html#apt-packages","title":"APT Packages","text":"<p>If your module requires addition apt packages to be installed then create or amend the installer.json file to add the packages</p> <p>The module installer will install these packages using apt so you can use the apt options for the packages, like setting versions etc</p> <p>Legacy Reqpackagesuirements file</p> <p>Some modules use a packages.txt file \u2013 This is the legacy method for installing dependencies and must not be used.</p>"},{"location":"developer_guide/dependencies.html#additional-data","title":"Additional Data","text":"<p>If your module requires additional data then create a folder inside the module folder with the same name as the module. Inside this folder place any data you require.</p> <p>The module installer will then copy this code into the main Allsky folder. You will need to construct the path to this folder yourself in your code.</p> <p>The allsky_adsb module is a good example to look at for this type of functionality.</p>"},{"location":"developer_guide/dependencies.html#install-scripts","title":"Install scripts","text":"<p>If you need to run any post installation code, so setup data for example then place details of the script to call int eh post-install section of the installer.json file.</p> <p>In the example above the script has been placed in the allsky_adsb/tools folder. This will be copied to the main Allsky folder during installation. The installer file references {install_data_dir} which the installer will replace with the real folder.</p>"},{"location":"developer_guide/dependencies.html#charts","title":"Charts","text":"<p>See the charts section for more details</p>"},{"location":"developer_guide/dependencies.html#blocks","title":"Blocks","text":"<p>See the blocks section for more details</p>"},{"location":"developer_guide/folder_structure.html","title":"Folder Strucuture","text":""},{"location":"developer_guide/folder_structure.html#module-folder-structure","title":"Module folder structure","text":"<p>There are two relevant folder structures, that used when developing a module and that used after a module has been installed.</p>"},{"location":"developer_guide/folder_structure.html#repository-structure","title":"Repository Structure","text":"<p>When developing a new module the following folder structure is required, this is taken from the Allsky ADSB module as an example</p> <pre><code>allsky_adsb                             Top level folder, the module name\n\u251c\u2500\u2500 allsky_adsb                         Data folder, copied into core Allsky. Named the same as the module\n\u2502   \u251c\u2500\u2500 adsb_data                       This can be any data thats needed folder name is only relevant to your code\n\u2502   \u2514\u2500\u2500 tools                           A folder to hold some post install tools\n\u2502       \u2514\u2500\u2500 build_database.py           The post install tool, referenced in the installer.json file\n\u251c\u2500\u2500 allsky_adsb.py                      The actual module itself\n\u251c\u2500\u2500 blocks                              Folder to hold blocks\n\u2502   \u251c\u2500\u2500 aircraft1.json\n\u2502   \u251c\u2500\u2500 aircraft2.json\n\u2502   \u251c\u2500\u2500 aircraft3.json\n\u2502   \u251c\u2500\u2500 aircraft4.json\n\u2502   \u251c\u2500\u2500 aircraft5.json\n\u2502   \u251c\u2500\u2500 closest.json\n\u2502   \u2514\u2500\u2500 top5.json\n\u251c\u2500\u2500 charts                            Folder to hold charts\n\u2502   \u251c\u2500\u2500 total_aircraft_chart.json\n\u2502   \u2514\u2500\u2500 total_aircraft_gauge.json\n\u251c\u2500\u2500 db                                Folder for database config\n\u2502   \u2514\u2500\u2500 db_data.json                  The database config, mainly handles how the database is purged\n\u251c\u2500\u2500 installer.json                    Installtion details file\n\u251c\u2500\u2500 reuirements.txt                   LEGACY file do not use\n\u251c\u2500\u2500 packages.txt                      LEGACY file do not use\n\u2514\u2500\u2500 README.md                         Readme file for people browsing the repo\n</code></pre>"},{"location":"developer_guide/folder_structure.html#installed-structure","title":"Installed structure","text":"<p>Once a module has been installed by the moduel installer the files are copied into the main Allsky folder. The base folder for extra modules is</p> <pre><code>~/allsky/config/myfiles/modules\n</code></pre> <pre><code>modules                                       The modules folder containing all extra modules\n\u251c\u2500\u2500 allsky_adsb.py                            The adsb module\n\u251c\u2500\u2500 moduledata                                Module data folder\n\u2502   \u251c\u2500\u2500 blocks                                Blocks folder, each module has its own folder\n\u2502   \u2502   \u2514\u2500\u2500 allsky_adsb                       The blocks for the adsb module\n\u2502   \u2502       \u251c\u2500\u2500 aircraft1.json\n\u2502   \u2502       \u251c\u2500\u2500 aircraft2.json\n\u2502   \u2502       \u251c\u2500\u2500 aircraft3.json\n\u2502   \u2502       \u251c\u2500\u2500 aircraft4.json\n\u2502   \u2502       \u251c\u2500\u2500 aircraft5.json\n\u2502   \u2502       \u251c\u2500\u2500 closest.json\n\u2502   \u2502       \u2514\u2500\u2500 top5.json\n\u2502   \u251c\u2500\u2500 charts                                Charts folder, each module has its own folder\n\u2502   \u2502   \u2514\u2500\u2500 allsky_adsb                       The charts for the adsb module\n\u2502   \u2502       \u251c\u2500\u2500 total_aircraft_chart.json\n\u2502   \u2502       \u2514\u2500\u2500 total_aircraft_gauge.json\n\u2502   \u251c\u2500\u2500 data                                  Data folder, each module has its own folder\n\u2502   \u2502   \u2514\u2500\u2500 allsky_adsb                       The data folder for the adsb module, copied from the repo\n\u2502   \u2502       \u251c\u2500\u2500 adsb_data\n\u2502   \u2502       \u2514\u2500\u2500 tools\n\u2502   \u2502           \u2514\u2500\u2500 build_database.py\n\u2502   \u251c\u2500\u2500 info\n\u2502   \u2502   \u2514\u2500\u2500 allsky_adsb\n\u2502   \u251c\u2500\u2500 installer                             Installer info for each module\n\u2502   \u2502   \u2514\u2500\u2500 allsky_adsb                       Installer info for the adsb module\n\u2502   \u2502       \u2514\u2500\u2500 installer.json\n\u2502   \u2514\u2500\u2500 logfiles                              Logs created during installation\n\u2502       \u2514\u2500\u2500 allsky_adsb\n\u2502           \u2514\u2500\u2500 dependencies.log\n\u2514\u2500\u2500 __pycache__                               Compiled python code\n</code></pre>"},{"location":"developer_guide/folder_structure.html#how-allsky-finds-modules","title":"How Allsky finds modules","text":"<p>Allsky ships with core modules which can then be extended by installing the extra modules. Once installed Allsky will search for modules in the following order</p> <ol> <li>The legacy custom modules folder <code>/opt/allsky/modules</code></li> <li>The new custom modules folder <code>~/allsky/config/myfiles/modules</code></li> <li>Core Allsky <code>~/allsky/scripts/modules</code></li> </ol> <p>This mechanism allows you to implement custom versions of the core Allsky modules should you wish to do so.</p> <p>Overriding Core Allsky Modules</p> <p>Before attempting to override a core module you must understand the existing functionality of the module. Failure to understand the modules could result in Allsky failing</p> <p>Legacy Module Locations</p> <p>version v2024.12.06_01 and prior of Allsky stored all modules and module data in the ``/opt/allsky/modules<code>folder. This has now been deprecated and all modules and associated data are stored with the</code>~/allsky``` folder.</p>"},{"location":"developer_guide/glossary.html","title":"Glossary","text":""},{"location":"developer_guide/glossary.html#glossary","title":"Glossary","text":"Item Description Module Python code used to extend the functionality of Allsky Event An event, daytime / nighttime image capture, day to night or night to day transition, periodic Flow A series of modules grouped together and triggered by an event Pipeline Same as a flow Block A small json file that defines the layout of variables on the overlay manager"},{"location":"developer_guide/introduction.html","title":"Introduction","text":""},{"location":"developer_guide/introduction.html#introduction","title":"Introduction","text":"<p>The Allsky system is designed to be modular, extensible, and developer-friendly \u2014 allowing you to add new capabilities without modifying the core software. Modules are self-contained units that integrate seamlessly with the Allsky environment, providing everything from hardware drivers (I\u00b2C sensors, focusers, LED displays) to data processors (star counting, meteor detection, image overlays, AI classification) and even UI extensions for the Allsky Web Portal.</p> <p>By developing modules, you can easily:</p> <ul> <li>Extend Allsky\u2019s functionality without touching its core codebase</li> <li>Integrate custom hardware, APIs, or image-processing pipelines</li> <li>Add new graphs, data outputs, or automation routines</li> <li>Reuse shared features like configuration management, logging, and database access</li> </ul> <p>The Allsky Module SDK provides ready-made helpers for:</p> <ul> <li>Logging and debugging \u2014 integrated with the main Allsky log system.</li> <li>Configuration management \u2014 read and write module-specific settings safely.</li> <li>Database access \u2014 use ALLSKYDATABASEMANAGER for structured data storage.</li> <li>Environment discovery \u2014 access paths, devices, and runtime state from environment variables.</li> <li>Graph and UI integration \u2014 register module outputs as live charts, overlays, or dashboard widgets.</li> </ul> <p>With these tools, creating a new module becomes as simple as defining its purpose, implementing your logic, and declaring how it interacts with the rest of the system. Whether you\u2019re adding a temperature sensor, experimenting with meteor detection algorithms, or building a smart autofocus routine \u2014 the Allsky module system provides a consistent, safe, and maintainable framework for innovation.</p> <p>Allsky is shipoped with a core set of modules, the exta modules when installed extend this functionality.</p>"},{"location":"developer_guide/meta_data_example.html","title":"Meta Data Example","text":""},{"location":"developer_guide/meta_data_example.html#example-meta-data","title":"Example Meta Data","text":"<pre><code>    meta_data = {\n        \"name\": \"ADS-B Aircraft Tracking Data\",\n        \"description\": \"Provide aircraft data for display on images\",\n        \"module\": \"allsky_adsb\",    \n        \"version\": \"v2.0.0\",\n        \"group\": \"Data Capture\",\n        \"events\": [\n            \"periodic\",\n            \"day\",\n            \"night\"\n        ],\n        \"enabled\": \"false\",    \n        \"experimental\": \"true\",\n        \"testable\": \"true\",  \n        \"centersettings\": \"false\",\n        \"extradatafilename\": \"allsky_adsb.json\", \n        \"extradata\": {\n            \"database\": {\n                \"enabled\": \"True\",\n                \"table\": \"allsky_adsb\",\n                \"pk\": \"id\",\n                \"pk_type\": \"int\",\n                \"include_all\": \"false\",       \n                \"time_of_day_save\": {\n                    \"day\": \"always\",\n                    \"night\": \"always\",\n                    \"nightday\": \"always\",\n                    \"daynight\": \"always\",\n                    \"periodic\": \"enabled\"\n                }      \n            },      \n            \"info\": {\n                \"count\": 20,\n                \"firstblank\": \"false\"\n            },\n            \"values\": {\n                \"AS_TOTAL_AIRCRAFT\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"number\",                \n                    \"description\": \"Total Aircraft\",\n                    \"dbtype\": \"int\",\n                    \"database\": {\n                        \"include\" : \"true\"\n                    }     \n                },\n                \"AS_DISTANCE_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"format\": \"{allsky}\",\n                    \"type\": \"distance\",            \n                    \"description\": \"Aircraft ${COUNT} distance\"\n                },    \n                \"AS_AZIMUTH_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"format\": \"{dp=2|deg}\",     \n                    \"type\": \"azimuth\",                \n                    \"description\": \"Aircraft ${COUNT} azimuth\"\n                },\n                \"AS_ELEVATION_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"format\": \"{dp=2|deg}\",     \n                    \"type\": \"elevation\",                \n                    \"description\": \"Aircraft ${COUNT} elevation\"\n                },\n                \"AS_ALTITUDE_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"format\": \"{flightlevel}\",\n                    \"type\": \"altitude\",                \n                    \"description\": \"Aircraft ${COUNT} altitude\"\n                },                        \n                \"AS_TYPE_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",                \n                    \"description\": \"Aircraft ${COUNT} type\"\n                },              \n                \"AS_OWNER_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",                \n                    \"description\": \"Aircraft ${COUNT} owner\"\n                },\n                \"AS_REGISTRATION_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",                \n                    \"description\": \"Aircraft ${COUNT} registration\"\n                },\n                \"AS_MANUFACTURER_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",                \n                    \"description\": \"Aircraft ${COUNT} manufacturer\"\n                },\n                \"AS_MILITARY_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"format\": \"{yesno}\",     \n                    \"type\": \"bool\",                \n                    \"description\": \"Aircraft ${COUNT} military flag\"\n                },\n                \"AS_TEXT_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",\n                    \"description\": \"Aircraft ${COUNT} short text (reg, bearing)\"\n                },\n                \"AS_LONGTEXT_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",                \n                    \"description\": \"Aircraft ${COUNT} medium text (reg, type, bearing, distance, alt, speed)\"\n                },\n                \"AS_SHORT_ROUTE_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",                \n                    \"description\": \"Aircraft ${COUNT} short route (ICAO -&gt; ICAO)\"\n                },\n                \"AS_MEDIUM_ROUTE_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",                \n                    \"description\": \"Aircraft ${COUNT} short route (City -&gt; CITY)\"\n                },\n                \"AS_LONG_ROUTE_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",                \n                    \"description\": \"Aircraft ${COUNT} long route (ICAO - City -&gt; ICAO - CITY)\"\n                }\n            }\n        },\n        \"arguments\":{\n            \"period\": 60,\n            \"data_source\": \"Local\",\n            \"aircraft_data\": \"local\",\n            \"aircraft_route\": \"true\",\n            \"distance_limit\": 50,\n            \"timeout\": 10,\n            \"local_adsb_url\": \"\",\n            \"observer_altitude\": 0,\n            \"opensky_username\": \"\",\n            \"opensky_password\": \"\",\n            \"opensky_lat_min\": 0,\n            \"opensky_lon_min\": 0,\n            \"opensky_lat_max\": 0,\n            \"opensky_lon_max\": 0,\n            \"airplaneslive_radius\": 50\n        },\n        \"argumentdetails\": {\n            \"data_source\" : {\n                \"required\": \"false\",\n                \"description\": \"Data Source\",\n                \"help\": \"The source for the ASB-D data.\",\n                \"tab\": \"Data Source\",\n                \"type\": {\n                    \"fieldtype\": \"select\",\n                    \"values\": \"Local,OpenSky,AirplanesLive,adsbfi\",\n                    \"default\": \"Local\"\n                }\n            },        \n\n            \"noticeal\" : {\n                \"tab\": \"Data Source\",      \n                \"message\": \"There are no settings required for AirplanesLive\",\n                \"type\": {\n                    \"fieldtype\": \"text\",\n                    \"style\": {\n                        \"width\": \"full\",\n                        \"alert\": {\n                            \"class\": \"info\"\n                        }\n                    }\n                },\n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"AirplanesLive\"\n                    ]\n                }                       \n            }, \n            \"noticefi\" : {\n                \"tab\": \"Data Source\",      \n                \"message\": \"There are no settings required for adsbfi\",\n                \"type\": {\n                    \"fieldtype\": \"text\",\n                    \"style\": {\n                        \"width\": \"full\",\n                        \"alert\": {\n                            \"class\": \"info\"\n                        }\n                    }\n                },\n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"adsbfi\"\n                    ]\n                }                       \n            },    \n            \"local_adsb_url\": {\n                \"required\": \"false\",\n                \"description\": \"Local ADS-B Address\",\n                \"help\": \"See the help for how to obtain this address.\",\n                \"tab\": \"Data Source\",\n                \"secret\": \"true\",\n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"Local\"\n                    ]\n                }             \n            },\n            \"opensky_username\": {\n                \"required\": \"false\",\n                \"description\": \"OpenSky Username\",\n                \"help\": \"Your Opensky Network username. See the module documentation for details on the API limits with and without a username.\",\n                \"tab\": \"Data Source\",\n                \"secret\": \"true\",    \n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"OpenSky\"\n                    ]\n                }            \n            },\n            \"opensky_password\": {\n                \"required\": \"false\",\n                \"description\": \"OpenSky Password\",\n                \"help\": \"Your Opensky Network password.\",\n                \"tab\": \"Data Source\",\n                \"secret\": \"true\",    \n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"OpenSky\"\n                    ]\n                }            \n            },        \n            \"opensky_lat_min\": {\n                \"required\": \"false\",\n                \"description\": \"Min latitude\",\n                \"help\": \"The minimum latitude of the bounding box. Use a site like http://bboxfinder.com/ to determine the bounding box.\",\n                \"tab\": \"Data Source\",\n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"OpenSky\"\n                    ]\n                }            \n            },\n            \"opensky_lon_min\": {\n                \"required\": \"false\",\n                \"description\": \"Min longitude\",\n                \"help\": \"The minimum longitude of the bounding box.\",\n                \"tab\": \"Data Source\",\n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"OpenSky\"\n                    ]\n                }            \n            },\n            \"opensky_lat_max\": {\n                \"required\": \"false\",\n                \"description\": \"Max latitude\",\n                \"help\": \"The minimum latitude of the bounding box.\",\n                \"tab\": \"Data Source\",\n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"OpenSky\"\n                    ]\n                }            \n            },\n            \"opensky_lon_max\": {\n                \"required\": \"false\",\n                \"description\": \"Max longitude\",\n                \"help\": \"The maximum longitude of the bounding box.\",\n                \"tab\": \"Data Source\",\n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"OpenSky\"\n                    ]\n                }            \n            },\n            \"aircraft_data\" : {\n                \"required\": \"false\",\n                \"description\": \"Aircraft Type Data Source\",\n                \"help\": \"The source for the aircraft data, see the documentaiton for details.\",\n                \"tab\": \"Settings\",\n                \"type\": {\n                    \"fieldtype\": \"select\",\n                    \"values\": \"Local,Hexdb\",\n                    \"default\": \"Local\"\n                }\n            },\n            \"aircraft_route\" : {\n                \"required\": \"false\",\n                \"description\": \"Get flight route\",\n                \"help\": \"Get the flight's route if possible.\",\n                \"tab\": \"Settings\",\n                \"type\": {\n                    \"fieldtype\": \"checkbox\"\n                }          \n            },\n            \"distance_limit\" : {\n                \"required\": \"true\",\n                \"description\": \"Limit Distance\",\n                \"help\": \"Only include aircraft inside this distance.\",\n                \"tab\": \"Settings\",                        \n                \"type\": {\n                    \"fieldtype\": \"spinner\",\n                    \"min\": 0,\n                    \"max\": 250,\n                    \"step\": 1\n                }\n            },         \n            \"observer_altitude\" : {\n                \"required\": \"true\",\n                \"description\": \"Altitude\",\n                \"help\": \"Your altitude in metres.\",\n                \"tab\": \"Settings\",                        \n                \"type\": {\n                    \"fieldtype\": \"spinner\",\n                    \"min\": 0,\n                    \"max\": 1000,\n                    \"step\": 10\n                }\n            },\n            \"period\" : {\n                \"required\": \"true\",\n                \"description\": \"Read Every\",\n                \"help\": \"Read data every x seconds. Be careful of any API limits when setting this.\",\n                \"tab\": \"Settings\",                          \n                \"type\": {\n                    \"fieldtype\": \"spinner\",\n                    \"min\": 60,\n                    \"max\": 1440,\n                    \"step\": 1\n                }\n            },\n            \"timeout\" : {\n                \"required\": \"true\",\n                \"description\": \"Timeout\",\n                \"help\": \"The number of seconds to wait for a response from the API before aborting.\",\n                \"tab\": \"Settings\",                        \n                \"type\": {\n                    \"fieldtype\": \"spinner\",\n                    \"min\": 1,\n                    \"max\": 20,\n                    \"step\": 1\n                }\n            },\n            \"graph\": {\n                \"required\": \"false\",\n                \"tab\": \"History\",\n                \"type\": {\n                    \"fieldtype\": \"graph\"\n                }\n            }                      \n        },\n        \"businfo\": [\n        ],\n        \"changelog\": {\n            \"v1.0.0\" : [\n                {\n                    \"author\": \"Alex Greenland\",\n                    \"authorurl\": \"https://github.com/allskyteam\",\n                    \"changes\": \"Initial Release\"\n                }\n            ],\n            \"v2.0.0\" : [\n                {\n                    \"author\": \"Alex Greenland\",\n                    \"authorurl\": \"https://github.com/allskyteam\",\n                    \"changes\": \"Updates for new module system\"\n                }\n            ]   \n        }\n    }\n</code></pre>"},{"location":"developer_guide/meta_data_structure.html","title":"Meta Data Structure","text":""},{"location":"developer_guide/meta_data_structure.html#the-meta_data-structure","title":"The meta_data Structure","text":"<p>The meta_data variable contains a complete definition of all of the features this module will provide. The structure is complex so we have broken it down into the main components. </p> <p>Some notes on the data</p> <ul> <li> <p>The structure is a Python dict that is also used as json</p> </li> <li> <p>All Boolean values must be quoted i.e. \u201ctrue\u201d NOT True</p> </li> </ul>"},{"location":"developer_guide/meta_data_structure.html#the-header-section","title":"The \u2018header\u2019 section","text":"<p>This section contains basic information about the module and how it should be displayed in the installer and module manager.</p> Name Description name The name of the module. Displayed in the module manager description Brief description of what he module does, this is displayed in the module installer and module manager module The module name allsky_XXXXX. Note the allsky_ must be present version The version of the module. This uses then MAJOR, MINOR,PATCH convention. i.e. v1.2.3 centersettings If the module has a large amount of settings then set this to \u201cfalse\u201d to display the module dialog at the top of the screen. Setting it to \u201ctrue\u201d will vertically center the module dialog testable If the module can be tested, see later then set this to \u201ctrue\u201d. NOTE: At present no modules that process images can be tested group This is the group the module belongs to, this is used in the module manager to group like modules together extradatafilename (Optional )This is the name of the extra data file that any data generated by the module will be saved in. By convention it\u2019s the module name with .json appended events These are the pipelines (flows) that this module can run in experimental (Optional) If set to \u201ctrue\u201d then the module will be flagged as experimental in the module manager deprecation This section allows control over the deprecation of a module. It can provide both warnings of an upcoming deprecation or a complete deprecation of a module fromversion (Optional) The version a deprecation will be advised from removein (Optional) The version the deprecation will happen in notes (Optional) Any notes related to the deprecation replacedby (Optional) The name of the module replacing the deprecated functionality deprecated \u201ctrue\u201d to deprecate a module, if \u201cfalse\u201d then the optional values above can be used"},{"location":"developer_guide/meta_data_structure.html#the-extra-data-section","title":"The \u2018Extra Data\u2019 section","text":"<p>This section defines what data the module will generate for use in the overlays. It also controls what data can be written to the database for use by the charting system.</p>"},{"location":"developer_guide/meta_data_structure.html#the-databases-section","title":"The \u2018databases\u2019 section","text":"Name Description database See the updating the database section for details enabled (Optional) \u201ctrue\u201d if this module will write data to the database table (Optional) If enable then this field IS required and contains the name of the table to write data to. The convention is the module name pk (Optional) If enable then this field IS required and contains the primary key for the database. This is either \u2018id\u2019 or an Allsky variable name pk_type (Optional) If enable then this field IS required and contains the primary key. Set this to \u2018int\u2019 Include_all (Optional) If enable then this field IS required and determines if all extra data values are written to the database. If \u201cfalse\u201d then you can specify which data is written against the time_of_day_save (Optional) Determines how  data is saved for each pipeline. info (Options) This section is reserved for use by the Allsky team. If you feel you need to use it please create a discussion on Gihub count (Optional) Some modules will write multiple versions of the same variable i.e. AS_FAN1, AS_FAN2. This determines how many of these will be created. Its an n-1 so setting to 5 will allow for 4 variables firstblank (Optional) If set to true then the first value will not have a suffix i.e. AS_FAN, AS_FAN1"},{"location":"developer_guide/meta_data_structure.html#the-values-section","title":"The \u2018values\u2019 section","text":"<p>This section defines all of the extra data that the module will generate for use in overlays. The information defined here is used throughout core Allsky to format and present the data. The section is a list of values, the table below just shows the available fields for a single value</p> Name Description Key The name of the variable, generally prefixed with AS_ name The variable as it will appear when added to an overly format The default format for the variable. See the section in the main Allsky documentation on formats for more details sample This is a sample value used in the Overlay manager, typically this is not needed as you can preview live data in the overlay manager group This the group the variable belongs to. This is used in the variable manager to group variables. description The description of the variable, used in the variable manager dbtype (Optional). If writing this field to the database this specifies the type of column created database Include_true If the database is enabled but include_all is \u2018false\u2019 then setting this to \u2018true\u2019 will write this value to the database"},{"location":"developer_guide/meta_data_structure.html#the-arguments-section","title":"The \u2018arguments\u2019 section","text":"<p>This is a list of all of the arguments the module requires along with their default values. This list MUST match the \u2018argumentdetails\u2019 section. If an entry exists in the \u2018argumentdetails\u2019 section but not here then It will not be available to the module.</p> <p>This is the \u2018params\u2019 variable passed into the module function when the module is run.</p>"},{"location":"developer_guide/meta_data_structure.html#the-argumentdetails-section","title":"The \u2018argumentdetails\u2019 section","text":"<p>This section defines all of the fields that are displayed in the module manager for a module.</p> <p>The boilerpate module is setup to display all of the field types allowing you to see how they work</p> <p>Each field has a type, this defines how  the field appears. The fields are documented in the Available Fields section</p> <p>The Boiler plate module implements each of the field types so can be used to see how they work.</p>"},{"location":"developer_guide/meta_data_structure.html#common-field-attributes","title":"Common field attributes","text":"<p>The following keys are available on all fields</p> Key Description required \u201ctrue\u201d or \u201cfalse\u201d to indicate the field must be filled in description The label used when displaying the field help Help text displayed under the field tab The tab the field is displayed on secret This indicates that the value in this field will contain sensitive information. Any details entered into a \u2018secret\u2019 field are stored in a separate file away from the pipeline json files. If the field is a text type field then the value will not be visible in the module manager. A button is displayed allowing the field value to be displayed or hidden"},{"location":"developer_guide/meta_data_structure.html#filtering","title":"Filtering","text":"<p>Filtering allows fields to be displayed or hidden based upon the value of another field. A good example of this is when selecting a sensor in the Environment module. Each sensor has different settings so rather than display all of them, which would make the modules dialog large and confusing only those relevant to the sensor are displayed.</p> <p>To utilise this feature add the \u2018filters\u2019 section to a field. The filters section contains the following values</p> <p>filter \u2013 The field that controls the filter</p> <p>filtertype \u2013 Either \u2018show\u2019 or \u2018hide\u2019 This determines if this field will be shown or hidden based upon the value of the \u2018filter\u2019 field</p> <p>values \u2013 A list of values from the \u2018filter\u2019 field that trigger the filtering on this field </p> <p>So in the example below the \u2018input\u2019 field will be shown if the \u2018type\u2019 field is either DHT22, DHT11 or AM2302</p> <pre><code>\"inputpin\": {\n    \"required\": \"false\",\n    \"description\": \"Input Pin\",\n    \"help\": \"The input pin for DHT type sensors, not required for i2c devices.\",\n    \"tab\": \"Core\",\n    \"type\": {\n        \"fieldtype\": \"gpio\"\n    },\n    \"filters\": {\n        \"filter\": \"type\",\n        \"filtertype\": \"show\",\n        \"values\": [\n            \"DHT22\",\n            \"DHT11\",\n            \"AM2302\"\n        ]\n    }            \n}\n</code></pre> <p>This is a very powerful feature and developer are encouraged to use it to keep the user interface easier for the end user.</p>"},{"location":"developer_guide/meta_data_structure.html#the-businfo-section","title":"The \u2018businfo\u2019 section","text":"<p>This section is optional and defines which buses on the Pi the module uses.</p> <pre><code>\"businfo\": [\n    \"i2c\"\n]\n</code></pre> <p>In this example the module uses the i2c bus</p> <pre><code>\"businfo\": [\n    \"i2c\",\n    \"onewire\"\n]  \n</code></pre> <p>In this example the module uses both the i2c bus and the onewire bus</p>"},{"location":"developer_guide/meta_data_structure.html#the-changelog-section","title":"The \u2018changelog\u2019 section","text":"<p>This section contains the changelog for the module. The latest version is at the end of the changelog. In this example there are several different types of entries in the changelog</p> <p>v1.0.0 \u2013 This is a dingle change made by one author v1.0.1 \u2013 This is multiple changes made by one author v1.0.2 \u2013 This is multiple changes made by one author and a single change made by another</p> <pre><code>\"changelog\": {\n    \"v1.0.0\" : [\n        {\n            \"author\": \"Alex Greenland\",\n            \"authorurl\": \"https://github.com/allskyteam\",\n            \"changes\": \"Initial Release\"\n        }\n    ],\n    \"v1.0.1\" : [\n        {\n            \"author\": \"Alex Greenland\",\n            \"authorurl\": \"https://github.com/Mr-Groch\",\n            \"changes\": [\n                \"Change 1\",\n                \"Change 2\"\n            ]\n        }\n    ],\n    \"v1.0.2\" : [\n        {\n            \"author\": \"Alex Greenland\",\n            \"authorurl\": \"https://github.com/allskyteam\",\n            \"changes\": [\n                \"Change 1\",\n                \"Change 2\"\n            ]\n        },            \n        {\n            \"author\": \"Andreas Schminder\",\n            \"authorurl\": \"https://github.com/Adler6907\",\n            \"changes\": \"Change 1\"\n        }\n    ],\n    \"v1.0.3\" : [\n        {\n            \"author\": \"Alex Greenland\",\n            \"authorurl\": \"https://github.com/allskyteam\",\n            \"changes\": [\n                \"Updated for new module structure\",\n                \"Another change\"\n            ]\n        }\n    ]                             \n}\n</code></pre>"},{"location":"developer_guide/module_structure.html","title":"Module Structure","text":""},{"location":"developer_guide/module_structure.html#module-structure","title":"Module Structure","text":""},{"location":"developer_guide/module_structure.html#anatomy-of-a-module","title":"Anatomy of a module","text":"<p>Modules can be implemented in a number of ways but only the preferred method is documented here. A module is essentially a Python script consisting of two methods</p> <ul> <li>A method that is called by Core Allsky to actually run the module</li> <li>A method that is called by Core Allsky when the module is removed from a pipeline, this allows the module to clearup any data</li> </ul> <pre><code>import allsky_shared as allsky_shared\nfrom allsky_base import ALLSKYMODULEBASE\n\nclass ALLSKTUTORIAL(ALLSKYMODULEBASE):\n    meta_data = {\n    }\n\n    def run(self):\n        result = \"\"\n        return result\n\ndef tutorial(params, event):\n    allsky_tutorial = ALLSKTUTORIAL(params, event)\n    result = allsky_tutorial.run()\n    return result \n\ndef tutorial_cleanup():\n    moduleData = {\n        \"metaData\": ALLSKTUTORIAL.meta_data,\n        \"cleanup\": {\n            \"files\": {\n                ALLSKTUTORIAL.meta_data[\"extradatafilename\"]\n            },\n            \"env\": {}\n        }\n    }\n    allsky_shared.cleanupModule(moduleData)\n</code></pre> <p>Breaking this down we have</p>"},{"location":"developer_guide/module_structure.html#two-imports-that","title":"Two imports that","text":"<ul> <li>Import the allsky_shared module, this is a library of functions that a module can use.</li> <li>Import of the base module. The is a base class providing helper functions for a module</li> </ul>"},{"location":"developer_guide/module_structure.html#a-class-definition-allskytutorial","title":"A class definition (ALLSKYTUTORIAL)","text":"<p>that extends the base module (ALLSKYBASE) we imported. Note that the class can be called anything but as a convention its ALLSKY plus the module name all in upper case</p> <p>A meta_data variable. This is described later and contains all of the definitions required for the module</p> <p>A run function, this is the convention we use to run a module. This function must return the result of the module as a string, this is displayed in the module debug dialog.</p>"},{"location":"developer_guide/module_structure.html#the-module-entry-point-tutorial","title":"The module entry point (tutorial)","text":"<p>Every module requires this function. This is the function called by core Allsky to start the module.</p> <p>There are two parameters provided to this function</p> <p>params \u2013 These are the values the user has set for the module in the module manager</p> <p>event \u2013 This is the pipeline(flow) the module was called from</p> <p>In this function we would create a new instance of the module class passing the params and event variables then call the run method</p> <p>Your class does not need a constructor, that\u2019s handled by the base class. If for some reason you do need a constructor then you must ensure that base class constructor is also called</p>"},{"location":"developer_guide/module_structure.html#the-module-cleanup-entry-point-tutorial_cleanup","title":"The module cleanup entry point (tutorial_cleanup)","text":"<p>This function is called by core Allsky when a module is remove from a pipeline. This is to allow the module to cleanup any data required. A core function is provided that you can call that will handle all of the cleanup.</p> <p>This entry point is optional. If the module does not create any extra data for the overlays then there is no need to provide this function.</p>"},{"location":"developer_guide/overview.html","title":"Overview","text":""},{"location":"developer_guide/overview.html#overview","title":"Overview","text":""},{"location":"developer_guide/overview.html#what-are-modules","title":"What Are Modules","text":"<p>Modules are Python components that extend the functionality of Allsky. They typically fall into one of several categories:</p> <ul> <li>Data-enhancement modules \u2014 These add extra information that can be used in overlays. For example, the Solar System module provides details about celestial objects such as the Moon\u2019s position.</li> <li>Hardware-control modules \u2014 These interact with external devices. A common example is the Dew Heater module, which reads sensor data and automatically adjusts the dew heater.</li> <li>Image-processing modules \u2014 These operate on the captured images. Some modify the image itself (such as the Mask module), while others analyse the image to generate additional overlay data, such as the Star Count module.</li> </ul>"},{"location":"developer_guide/overview.html#available-pipelines-flows","title":"Available Pipelines (flows)","text":"<p>There are 5 pipelines available in Allsky.</p> Pipeline Description Daytime Used whilst Allsky is capturing images during the day Nightime Used whilst Allsky is capturing images during the night Day to Night Used when Allsky transitions from Daytime to Nighttime capture Night to Day Used when Allsky transitions from Nighttime  to Daytime capture Periodic Run periodically outside of the main Allsky capture process <p>Each pipeline can run a series of modules in sequence. By default, the Daytime and Nighttime pipelines include the core modules that load and save the captured image; these core modules cannot be removed. All other pipelines start empty. You can use the Module Manager to add additional modules to any pipeline as needed.</p> <pre><code>flowchart TB\n    A[\"Capture Image\"] --&gt; B[\"Remove Bad Images\"]\n    B --&gt; C[\"Resize\"] &amp; A\n    C --&gt; D[\"Crop\"]\n    D --&gt; E[\"Stretch\"]\n    E --&gt; F{\"Flow Type\"}\n    F -- Daytime Pipeline --&gt; FDL[\"Load Image\"]\n    FDL --&gt; FDM[\"Load Modules\"]\n    FDM --&gt; FDR[\"Run Modules\"]\n    FDR --&gt; FDS[\"Save Image\"]\n    FDS --&gt; P[\"Create Thumb\"]\n    F -- Nighttime Pipeline --&gt; FNL[\"Load Image\"]\n    FNL --&gt; FNM[\"Load Modules\"]\n    FNM --&gt; FNR[\"Run Modules\"]\n    FNR --&gt; FNS[\"Save Image\"]\n    FNS --&gt; P\n    PTE[\"Perodic Timer\"] -- Periodic Pipeline --&gt; FPM[\"Load Modules\"]\n    FPM --&gt; FPR[\"Run Modules\"]\n    F -- End Of Night Pipeline --&gt; FEONM[\"Load Modules\"]\n    FEONM --&gt; FEONR[\"Run Modules\"]\n    FEONR --&gt; FEONCS[\"Create Startrails\"]\n    FEONCS --&gt; FEONCT[\"Create Timelapse\"]\n    FEONCT --&gt; FEONCK[\"Create Keogram\"]\n    FEONCK --&gt; FEONU[\"Upload Images / Videos\"]\n    FEONU --&gt; A\n    F -- Start Of Day Pipeline --&gt; FEODM[\"Load Modules\"]\n    FEODM --&gt; FEODR[\"Run Modules\"]\n    FEODR --&gt; P\n    P --&gt; Q[\"Create Mini Timelapse\"]\n    Q --&gt; R[\"Upload Image\"]\n    R --&gt; A</code></pre>"},{"location":"developer_guide/shared_libraries.html","title":"Shared Libraries","text":""},{"location":"developer_guide/shared_libraries.html#the-allsky-base-module","title":"The Allsky Base Module","text":"<p>Every module class must extend this base class. The base class does the following In the constructor;</p> <ul> <li>saves the params and event into class variables  </li> <li>Determines if the module is running in debug mode (i.e. from the test button in the module manager)  </li> <li>Converts any legacy meta data structures to the new meta data structure</li> </ul> <p>It also provides the following functions that the module class should use;</p>"},{"location":"developer_guide/shared_libraries.html#get_parm","title":"get_parm","text":"<p>This function is used to get a parameter from the module settings. Whilst this can be accessed in the params variable this is not encouraged. The function  accepts the following parameters</p> Parameter Description param The parameter to get, this is the name of the value in the arguments section default The default value for the parameter target_type The Python type of the variable to return Use_default_if_blank If the target_type is a string (str) and the found value for the param is an empty tring then use the default value if this parameter is True"},{"location":"developer_guide/shared_libraries.html#log","title":"log","text":"<p>This function logs data to either the console or Allsky debug logs. The function  accepts the following parameters</p> Parameter Description level The Allsky log level, below this nothing wil be logged message The message to log preventNewLine (Optional) If True no newline will be added at the end of the log message exitCode (Optional) Exit code \u2013 Not normally used sendToAllsky (Optional) \u2013 Not normally used <p>Detailed SDK</p> <p>For more details on these functions see the SDK Reference</p>"},{"location":"developer_guide/shared_libraries.html#the-allsky-shared-module","title":"The Allsky Shared Module","text":"<p>The shared module provides a huge library of functions that can assist module developers.</p> <p>Detailed SDK</p> <p>For more details on these functions see the SDK Reference</p>"}]}